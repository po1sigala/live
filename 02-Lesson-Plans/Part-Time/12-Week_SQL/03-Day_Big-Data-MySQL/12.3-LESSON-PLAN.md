# 12.3 Part-Time Lesson Plan: Big Data

## Overview 

Today's lesson will delve further into SQL queries. Students will be introduced to prepared statements, aggregate functions, and joins. Students will also collaborate on a mini-project that reinforces SQL concepts and challenges them to build a command line application that incorporates a SQL database with an Express.js server.

## Instructor Notes

* In this lesson, students will complete activities `21-Ins_Prepared-Statements` through `28-Stu_Mini-Project`.

* In today's Stoking Curiosity, you will use MySQL's sample employee database to demonstrate to the students the real-world application of SQL. If you have not done so, be sure to [download the sample database](https://dev.mysql.com/doc/employee/en/) and unzip it. You can also [download it directly from the GitHub repo](https://github.com/datacharmer/test_db).

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

* If the students struggle with the `Everyone Do: Git` activity, walk through it with the students using the talking points provided. Otherwise, support the students as they do the activity and do a brief review at the end. 

## Learning Objectives

By the end of class, students will be able to:

* Write a SQL query that joins two tables together

* Implement `?` prepared statements in conjunction with `INSERT`, `UPDATE`, and `DELETE`

* Use aggregate functions to perform a calculation on a set of values.

## Time Tracker

| Start   | #   | Activity Name                          | Duration |
|---      |---  |---                                     |---       |
| 10:00AM | 1   | Instructor Do: Stoke Curiosity         | 0:10     |
| 10:10AM | 2   | Instructor Demo: Prepared Statement    | 0:05     |
| 10:15AM | 3   | Student Do: Prepared Statement         | 0:15     |
| 10:30AM | 4   | Instructor Review: Prepared Statement  | 0:10     |
| 10:40AM | 5   | Instructor Demo: Count                 | 0:05     |
| 10:45AM | 6   | Student Do: Count                      | 0:15     |
| 11:00AM | 7   | Instructor Review: Count               | 0:10     |
| 11:10AM | 8   | Instructor Demo: Join                  | 0:05     |
| 11:15AM | 9   | Student Do: Join                       | 0:15     |
| 11:30AM | 10  | Instructor Review: Join                | 0:10     |
| 11:40AM | 11  | Everyone Do: Git                       | 0:20     |
| 12:00PM | 12  | BREAK                                  | 0:40     |
| 12:40PM | 13  | Instructor Demo: Mini-project          | 0:05     |
| 12:45PM | 14  | Student Do: Mini-project               | 0:60     |
| 1:45PM  | 15  | Instructor Review: Mini-project        | 0:10     |
| 1:55PM  | 16  | Introduce Homework                     | 0:05     |
| 2:00PM  | 17  | END                                    | 0:00     |

> **Important**: If this lesson occurs on a weekday, you'll follow a different schedule to accommodate for the shorter class time. The `Stoke Curiosity` section is shortened by 5 minutes, the break by 25 minutes, and the `Student Do: Mini-project` by 10 minutes, and the `Everyone Do: Git` activity is omitted completely.

<details>
  <summary>Click to show the adjusted time tracker</summary>

| Start  | #   | Activity Name                          | Duration |
|---     |---  |---                                     |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity         | **0:05** | 
| 6:35PM | 2   | Instructor Demo: Prepared Statements   | 0:05     |
| 6:40PM | 3   | Student Do: Prepared Statement         | 0:15     |
| 6:55PM | 4   | Instructor Review: Prepared Statements | 0:10     |
| 7:05PM | 5   | Instructor Demo: Aggregate Functions   | 0:05     |
| 7:10PM | 6   | Student Do: Aggregate Functions        | 0:15     |
| 7:25PM | 7   | Instructor Review: Aggregate Functions | 0:10     |
| 7:35PM | 8   | Instructor Demo: Join                  | 0:05     |
| 7:40PM | 9   | Student Do: Join                       | 0:15     |
| 7:55PM | 10  | BREAK                                  | **0:15** |
| 8:10PM | 11  | Instructor Review: Join                | 0:10     |
| 8:20PM | 12  | Instructor Demo: Mini-project          | 0:05     |
| 8:25PM | 13  | Student Do: Mini-project               | **0:50** |
| 9:15PM | 14  | Instructor Review: Mini-project        | 0:10     |
| 9:25PM | 15  | Introduce Homework                     | 0:05     |
| 9:30PM | 16  | END                                    | 0:00     |
</details>

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* If you have not yet downloaded the MySQL Sample Database, [download the database from the MySQL documentation here](https://dev.mysql.com/doc/employee/en/employees-installation.html) and unzip it. The database can also be [downloaded directly from the GitHub repo](https://github.com/datacharmer/test_db).

* Congratulate the students. At this point, they have learned the basic tools needed to design a relational SQL database capable of handling large amounts of data.

* Note that designing a database, though, is just the beginning. SQL Developers must also be able to manipulate large amounts of data to find answers to real-world questions. 

* Stress that database queries start with a question -- posed in plain language -- that can be solved using our data and the SQL query language. 

* Open the `test_db/` directory in your command line to demonstrate the following:

  * For example, on the job, we may want to find out the first and last names of all employees born in March. To answer this question, we have to find a way to query a database that contains thousands of records to get the results -- and only the results -- we need. 

  * We start by opening our MySQL Shell.

    ```bash
    mysql -uroot -p 
    ```
  
  * Next, we import the schema and check to make sure the `employees` database is in use. 

    ```sql
    SOURCE employees.sql;
    SELECT DATABASE();
    ```

  * Now, let's take a look at the tables to find which table is likely to hold the data we need.  We use the `SHOW` command to show the tables and the `DESCRIBE` command to show the columns used in the `employees' table.

    ```sql
    SHOW TABLES;
    DESCRIBE employees;
    ```

  * The `employees` table has a column for `birth_date` that has a data type of DATE. as well as columns for both the employee's first and last name. Querying this table should get us the answer we need. 
   
  * We start writing our query by using `SELECT` to select the columns we want to use from our table. Since we need the names of all the employees we include the `first_name` and `last_name` columns as well as the `birth_date`. 

    ```sql
    SELECT first_name, last_name, birth_date FROM employees
    ```

  * Next, we add a `WHERE` clause to include only the employees who have a birthday in March. The DATE data type includes a handy `MONTH()` method that makes selecting by month easy.

    ```sql
    WHERE MONTH(birth_date) = 3
    ```

  * Before testing to see if our query answers our question, we do one more thing. Since this is a big company, there are probably thousands of employees who have a birthday in March. So, we use `LIMIT` to provide a small sample of the results for testing. 

    ```sql
    LIMIT 25;
    ```

  * When we enter the test query into the MySQL Shell, it looks like we have the information we need: a list of 25 employees born in March that includes their first and last names. We can remove the limit to provide a list that includes all employees with a birthday in March. 

    ```sql
    SELECT first_name, last_name, birth_date FROM employees WHERE MONTH(birth_date) = 3 Limit 25;
    ```

  * SQL developers are frequently asked to solve questions -- both mundane and complex -- with data. During today's class, we will focus on ways we can access large amounts of data to get get the results needed and then put our skills to work building and querying our database. 

### 2. Instructor Demo: Prepared Statement (5 min) 

* Navigate to `21-Ins_Prepared-Statements` in your command line and run `npm install` and `node server.js` to demonstrate the following:

  * ğŸ”‘ We can execute a query directly in the Express.js server to delete a single row from the table. 

* Open `21-Ins_Prepared-Statements/server.js` in your IDE and explain the following: 

  * ğŸ”‘ To delete a single row, we use the `DELETE` command with a `WHERE` clause.

    ```sql
    DELETE FROM course_names WHERE id = 3;
    ```

  * ğŸ”‘ Hardcoding works if we only want to delete a particular row. To make the query more durable, we can use a prepared statement. 

  * ğŸ”‘ The prepared statement is a parameterized query uses a `?` as a placeholder for the id's value: 

    ```sql
    DELETE FROM books WHERE id = ?
    ```

  * ğŸ”‘ For the `DELETE` to work, we then provide the value we want inserted in place of the `?` placeholder as the second parameter of the `query()` function. 

    ```js
    db.query(`DELETE FROM course_names WHERE id = ?`, 3, (err, result) => {
      if (err) {
        console.log(err);
      }
      console.log(result);
    });
    ```

  * When the query is executed, the value will be inserted as the parameter into the query and the row with the `id` of `3` will be removed. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ Why use a prepared statement?

  * ğŸ™‹ A prepared statement is a way to make our queries more durable. In place of hardcoding a value, we use a `?` placeholder. Then, we provide the `?` a value as a parameter to the `query()` function. By doing this, we can use a single query to handle multiple points of data just by reassigning the `?`. 

  Prepared statements also make our code safer by preventing SQL injection, a vulnerability that allows an attacker to interfere with queries to a database and gain access to data. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `22-Stu_Prepared_Statements/README.md`.

### 3. Student Do: Prepared Statements (15 min) 

* Direct students to the activity instructions found in `22-Stu_Prepared_Statements/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ› Query Not Deleting Row from Table

  Work with a partner to resolve the following issue(s):

  * As a developer, I want to be able to delete a specific row from the `favorite_books` table. 

  ## Expected Behavior

  When I run `server.js`, the row with the `id` of `2` should be deleted from the table and the updated table displayed in the console.

  ## Actual Behavior

  When I run `server.js`, an `ER_PARSE_ERROR` error is returned and the table is not updated. 

  ## Steps to Reproduce the Problem

  1. In the MySQL Shell, execute the `db/schema.sql` file. 

  2. Next, execute the `db/seeds.sql` file. 

  3. Run `node server.js` to start the Express server. The results of the query and the table are shown in the console. 

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![Image of Successful Console Log](./assets/image_1.png)

  ---

  ## ğŸ’¡ Hints

  What does the `?` represent in a prepared statement? 

  ## ğŸ† Bonus 

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can you set user-defined values using a MySQL statement? 

  Use [Google](https://www.google.com) or another search engine to research this.

  
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Prepared Statements (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with prepared statements? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* âœ”ï¸ prepared statements

* Open `22-Stu_Prepared-Statements/Solved/server.js` in your IDE and explain the following: 

  * ğŸ”‘ We use a prepared statement to insert a parameter (represented by a `?` placeholder) into the query:

    ```sql
    DELETE FROM favorite_books WHERE id = ?
    ```

  * ğŸ”‘ To execute the `DELETE`, we must supply the prepared statement with a value. We assign the `deletedRow` variable a value of `2`:
  
    ```js
    let deletedRow = 2;
    ```
    
  * ğŸ”‘ To execute the query, we add the variable name as the second argument for the query function. This will set the `id = 2` when the query is executed:

    ```js
    db.query(`DELETE FROM favorite_books WHERE id = ?`, deletedRow, (err, result) => {
      if (err) {
        console.log(err);
      }
     console.log(result);
    });
    ```
* Navigate to `22-Stu_Prepared-Statements/Solved/` in your command line and run `npm install` and `node server.js`.

  * Now that we have added the variable name as the second argument, when the query function is executed, the row with the id of `2` is deleted.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What does the question mark represent in a prepared statement? 

  * ğŸ™‹ The question mark is a placeholder for a value in a query. For the query to execute, a value must be provided. 

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [MySQL documentation on prepared statements](https://dev.mysql.com/doc/refman/8.0/en/sql-prepared-statements.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Aggregate Functions (5 min) 

* Navigate to `23-Ins_COUNT-GROUPBY` in your command line and enter `mysql -uroot -p` to start the MySQL Shell to demonstrate the following: 

   * Sometimes, we want a quick way to provide summary information about our data. Aggregate functions allow us to perform simple calculations.

  * We execute our schema file and seeds to create and populate our database.

    ```sql
    SOURCE db/schema.sql;
    SOURCE db/seeds.sql;
    ```

  * To check that our tables are populated and to take a look at the data, we select all from the `course_names` table.

    ```sql
    SELECT * FROM course_names;
    ```

  * Aggregate functions give us a way to see summary data about the data in a table. Using an aggregate function in a query, we can find the total count and sum of a column. 

    ```sql
    SOURCE db/queries.sql;
    ```

* Open `23-Ins_COUNT-GROUPBY/db/queries.sql` in your IDE and demonstrate the following:

  * To select all from the `course_names` table, we use `SELECT *`.

    ```sql
    SELECT *
    FROM course_names;
    ```

  * To see how many rows of data we have in the `course_names` table, we use the aggregate function COUNT() to count the number of `id` entries. `COUNT()` returns the total number of rows that are not `null`. 

    ```sql
    SELECT department, COUNT(id) AS number_courses
    FROM course_names; 
    ```

  * We can also count the numbers of data in a group of data by adding the `GROUP BY` clause. This will provide the total count for each department.

    ```sql
    SELECT department, COUNT(id) AS number_courses
    FROM course_names
    GROUP BY department;
    ```

  * To return the sum of a column of numbers, we use the aggregate function `SUM()`. When calculating the total, `SUM()` ignores null values. 

    ```sql
    SELECT department, SUM(total_enrolled AS total_enrolled
    FROM course_names
    GROUP BY department;  
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What information can aggregate functions provide? 

  * ğŸ™‹ Aggregate functions can provide summary data for the entire table or a group of data from the table. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `24-Stu_COUNT-GROUPBY/README.md`.

### 6. Student Do: Aggregate Functions (15 min) 

* Direct students to the activity instructions found in `24-Stu_COUNT-GROUPBY/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ“ Add Comments to Implementation of Aggregate Functions in MySQL Queries

  Work with a partner to add comments describing the functionality of the code found in [server](./Unsolved/server.js).

  ## ğŸ“ Notes

  Refer to the documentation: 

  [MySQL Docs on Aggregate Functions](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html)

  ---

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What other aggregate functions can we use in our MySQL queries?

  Use [Google](https://www.google.com) or another search engine to research this.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Aggregate Functions (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with aggregate functions? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ COUNT()

  * âœ”ï¸ GROUP BY

  * âœ”ï¸ SUM()

* Open `24-Stu_COUNT-GROUPBY/Solved/db/schema.sql` in your IDE and demonstrate the following:

  * The `favorite_books` table has an `id` column that is a primary key. We can use a primary key, or another unique identifier, to count all the rows in the table because each row has a unique value and is not 

    ```sql
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    ```

  * The `in_stock` column is a boolean that returns a value of `true` or `false`. We can use this column to create a grouping of books that are in-stock and those that are not. 

    ```sql
    in_stock BOOLEAN
    ```

  * The quantity column is an integer. We can use that column to get a sum of all the favorite_books.

    ```sql
    quantity INT NOT NULL
    ```

* Open `24-Stu_COUNT-GROUPBY/Solved/server.js` in your IDE and demonstrate the following:

  * ğŸ”‘ To count all the rows of the table, we use the aggregate function `COUNT()` to count each `id` value. We use `AS` to provide an alias column name for our counts. 

    ```sql
    SELECT COUNT(id) AS total_count 
    ```

  * ğŸ”‘ Since we want to count the number of books in-stock and out of stock, we add a `GROUP BY`. This will give us the total count of books with an in-stock value of `true` and the total count of books with the in-stock value of `false`. 

    ```sql
    GROUP BY in_stock
    ```

  * ğŸ”‘ To get a sum of all of the quantities of books in each department, use the `SUM()` aggregate function to tally the quantity column. 

    ```sql
    SUM(quantity)
    ```

   * ğŸ”‘ To get the maximum quantity of all books in each department, use the `MAX()` aggregate function.

    ```sql
    MAX(quantity)
    ```

  * ğŸ”‘ To get the minimum quantity of all books in each department, use the `MIN()` aggregate function.

    ```sql
    MAX(quantity)
    ```

   * ğŸ”‘ To get the average quantity of all books in each department, use the `AVG()` aggregate function.

    ```sql
    AVG(quantity)
    ```

  * To execute the queries inside our Express server, we call the `query()` method on our database instance. 

    ```sql
    db.query('SELECT COUNT(id) AS total_count FROM favorite_books GROUP BY in_stock', function (err, results) {
      console.log(results);
      });
    ```

* Navigate to `24-Stu_COUNT-GROUPBY/Solved` in your command line and enter `mysql -uroot -p` to start the MySQL Shell.

  * To execute our queries, we first execute our schema and seed our data.

    ```sql
    SOURCE db/schema.sql;
    SOURCE db/seeds.sql;
    ```
   
  * We can then exit the shell and enter `npm install` and `node server` to spin up our Express server. The results of our queries print to the command line showing the aggregate values.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How can we use aggregate functions to get summary data for our tables? 

  * ğŸ™‹ We use the aggregate functions to operate on sets of values. Some of the aggregate functions we use are COUNT(), SUM(), MIN(), MAX() and AVG().

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [MySQL documentation on aggregate functions](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Joins (5 min) 

* Navigate to `25-Ins_Join/` in the command line and demonstrate the following:

  * ğŸ”‘ We initialize the MySQL Shell by typing `mysql -u root -p` and the MySQL password. Make sure that your MySQL Server is running!

    ```sh
    mysql -u root -p
    ```

  * ğŸ”‘ We set up the database and tables by typing `source db/schema.sql` in the MySQL Shell.

    ```sql
    SOURCE db/schema.sql;
    ```

  * ğŸ”‘ We seed the database by typing `source db/seeds.sql`.

    ```sql
    SOURCE db/seeds.sql;
    ```

  * ğŸ”‘ We join the `department` and `course names` data together by executing a query in `db/query.sql`.

* Navigate to `25-Ins_Join/db/shema.sql` in the command line and demonstrate the following:

  * We use a primary key to set a unique identifer for each row of data in the 'department' table.

    ```sql
    CREATE TABLE department (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(30) NOT NULL
    );
    ```

  * We then use a foreign key to establish a relationship. In the `course_names` table, the foreign key `department` will point to another table's primary key -- in this case the `department` table's id.  This relationship will allow us to join the table.

    ```sql
    CREATE TABLE course_names (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(30) NOT NULL,
      department INT,
      FOREIGN KEY (department)
      REFERENCES department(id)
      ON DELETE SET NULL
    );
    ```

* Navigate to `25-Ins_Join/db/query.sql` in the command line and demonstrate the following:

  * To make a join, we start by selecting data from the `course_names` table. 

    ```sql
    SELECT *
    FROM course_names
    ```

  * Then, we join the `department` table based on the shared relationship we established with the primary and foreign keys. 

    ```sql
    JOIN department ON course_names.department = department.id;
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ First we will use primary and foreign keys to set a relationship between the tables. Then we will write a query that uses the `JOIN` clause. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `26-Stu_Join/README.md`.

### 9. Student Do: Join (15 min) 

* Direct students to the activity instructions found in `26-Stu_Join/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ—ï¸ Implement Join Clause to Combine Two Tables

  Work with a partner to implement the following user story:

  * As a developer, I want to select records that have matching values from two tables.

  ## Acceptance Criteria

  * It's done when the matching values in the `book_prices` and `favorite_books` tables are combined and a new table is returned. 

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![Table showing combined data from both tables](./assets/image_1.png)

  ---

  ## ğŸ’¡ Hints

  What is the relationship between the two tables? 

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What is a many-to-many relationship?

  Use [Google](https://www.google.com) or another search engine to research this.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. Instructor Review: JOINS (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with SQL Joins? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (ğŸ”‘) points:

  * âœ”ï¸ `SELECT AS`

  * âœ”ï¸ `JOIN` clause

  * âœ”ï¸ `ON` clause

* Open `24-Stu_Joins/Solved/db/query.sql` in your IDE and explain the following: 

  * ğŸ”‘ We select the columns we want to appear in the joined table by using the `SELECT` command. Because we are working with two tables, we use dot notation to enter the name of the table, followed by the name of the column:

    ```sql
    SELECT
    favorite_books.book_name
    ```
  
  * ğŸ”‘ We use the `AS` clause to rename the columns. This alias will appear as the column name at the top of the table: 

    ```sql
    SELECT
    favorite_books.book_name AS name, book_prices.price AS price
    ```
  
  * We use `FROM` to select the `books` table. The `books` table references the `price` table with a foreign key: 

    ```sql
    FROM favorite_books
    ```
    
  * ğŸ”‘ We then join the book_price table using the `JOIN` clause:

    ```sql
    JOIN book_prices
    ```
    
   * ğŸ”‘ We use the `ON` clause to show the relationship between the two tables. In the `schema`, the `books` price column references the `prices` id column:
   
     ```sql
     JOIN book_prices ON favorite_books.book_price = book_prices.id;
     ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What's the purpose of a `JOIN` clause?

  * ğŸ™‹ To combine data from two different but related tables.

  * â˜ï¸ Why is it important to include an `ON` clause?

  * ğŸ™‹ The `ON` clause specifies the relationship between the tables that we want to join. 

  * â˜ï¸ What can you do if you don't completely understand this?

  * ğŸ™‹ We can refer to the lesson plan, read the [MySQL documentation on the JOIN clause](https://dev.mysql.com/doc/refman/5.7/en/join.html), and stay for Office Hours to ask for hel

* Answer any questions before proceeding to the next activity.

### 11. Everyone Do: Git (20 min)

* Open [Git docs](https://git-scm.com/docs/Cherry-Picking) in your browser and explain the following:

  * As developers, you will find that some of the code that you are working on may have already been fixed or completed in another commit by another developer. Git cherry-pick allows you to pull in one or multiple commits into your branch if you desire

* Direct students to the activity instructions found in `27-Evr_Git-Cherry-Picking/README.md`.

* While everyone is working on the activity, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

* Open your command line and demonstrate the following:

  * When we cherry-pick, we are pulling a particular commit into our branch. So to start, let's make a new branch in our repo so we can pull in a commit. 

    ```sh
    git checkout main
    git checkout -b feature/mybranch
    ```

  * ğŸ”‘ Now, we can make a second branch. This is the branch where we are going to cherry-pick from. 

    ```sh
    git checkout main
    git checkout -b feature/notifications
    ```

  * We open that branch in our IDE and add an index.html file. 

    ```sh
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Git Cherry-Pick!</title>
      </head>
      <body>
       <script src="app.js"></script>
       <code>Git Cherry-Pick ğŸ’</code>
      </body>
     </html>
  ```

 * We then commit our changes. 

   ```sh
   git add -A
   git commit -m "Add index.html file to notifications branch." 
   ```

* Each time we commit a file, we get a hashcode. To see the hashes, we can use Git Log.

  ```sh
  git log
  ```

* We are going to use that hashcode to cherry pick the commit. We go back to the branch where we want to pull in the commit.

  ```sh
  git checkout feature/mybranch
  ```

* While in the branch where we want our changes to be pulled into, we use the `cherry-pick` command plus the hash.

  ```sh
  git cherry-pick <hash>
  ```

* Answer any questions before students go on break.

### 12. BREAK (40 min)

### 13. Instructor Demo: Mini Project (5 min) 

* Open `28-Stu_Mini-Project/` from the command line and run `mysql -uroot` to open the MySQL Shell.

  * We use the `SOURCE` command to create and seed the database.

    ```sql
    SOURCE db/schema.sql;
    SOURCE db/seeds.sql;
    ```

* Exit MySQL Shell and run `npm install` and `node server.js`.

* Navigate to `localhost:3001/api/movie-reviews` in your browser to demonstrate the following:

  * ğŸ”‘ When we enter a GET route in the browser, the results of the query are displayed. 

  * While we can enter a GET route into the browser, to test other routes, we will need to use Insomnia.

* Navigate to Insomnia to demonstrate the following:

  * We select `PUT` and enter `localhost:3001/api/movies` to test our route.

  * To add the name of our new movies, we click on JSON and add a new key-pair, making sure we match our column name exactly.

    ```json
    {
      "movie_name": "Hello, World!"
    }
    ```

  * Then, we click 'SEND' to send our request.

  * To see that our movie has been added, we select a GET route `localhost:3001/api/movies` and click `SEND`. If successful, our new movie will be added to the database. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ First, we need to create a database. Then, we will use `mysql2` to connect the database to an Express server. Finally, we will build routes in Express to query our data. 

* Answer any questions before allowing students to start the mini project.

### 14. Student Do: Mini Project (60 min)

* Direct students to the activity instructions found in `28-Stu_Mini-Project/README.md`.

* Break your students into groups that will work together on this activity.

  ```md
  # Unit 12 Mini-Project: Movie Database

  In this mini-project, you will build Rest API routes for creating, retrieving, and deleting movies from a MySQL database.

  ## User Stories

  * As a user, I want to create a new database. 

  * As a user, I want to store movie names and reviews in the database in two separate tables.

  * As a user, I want to see a list of all movies.

  * As a user, I want to be able to create and delete a movie. 

  * As a user, I want to return a list of all the reviews and the associated movie name. 

  ## Acceptance Criteria

  * It's done when the `movie_db` is created and contains a `movies` and `reviews` table.

  * It's done when the `movie_db` has been seeded with data. 

  * It's done when the `/api/movies` route renders a list of all movies.

  * It's done when the `/api/add-movie` route successfully adds a movie when tested using Insomnia. 

  * It's done when the `/api/update-review` route successfully updates a movie when tested using Insomnia. 

  * It's done when the `/api/movie/:id` route deletes a route when tested using Insomnia. 

  ---

  ## Assets

  Design the following database schema containing two tables:

  ![Image of schema containing two tables](./assets/image_1.png)

  ---

  ## Notes

  To test your routes you will use Insomnia. If you have not already, you will need to [download Insomnia](https://insomnia.rest/download).

  Refer to the documentation: 

  [Insomnia Docs on Getting Started](https://support.insomnia.rest/category/152-using-insomnia)

  [Express Docs on Routing](https://expressjs.com/en/guide/routing.html)

  [MySQL Docs on Joins](https://dev.mysql.com/doc/refman/8.0/en/join.html)

  [NPM Docs on MySQL2](https://www.npmjs.com/package/mysql2)

  ## ğŸ’¡ Hints

  * How can you link your `movies` and `reviews` tables?

  * How can you execute a query in an Express server using the MySQL2 NPM package? 

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can you add a route to update a review?

  ---
  
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 15. Instructor Review: Mini Project (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with this mini-project? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ schema.sql

  * âœ”ï¸ seeds.sql

  * âœ”ï¸ createConnection()

  * âœ”ï¸ Query

  * âœ”ï¸ query()

* Open `28-Stu_Mini-Project/main/db/schema.sql` in your IDE and explain the following: 

  * We start by creating a schema that describes the tables and data we want to store.

  * ğŸ”‘ We link the two tables using a foreign key. The foreign key references the `movie_id` column from the movies table. 

    ```sql
    CREATE TABLE reviews (
      id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
      movie_id INT,
      review TEXT NOT NULL,
      FOREIGN KEY (movie_id)
      REFERENCES movies(id)
      ON DELETE SET NULL
    );
    ```

* Open `28-Stu_Mini-Project/main/db/seeds.sql` in your IDE and explain the following: 

  * ğŸ”‘ We insert data to seed the database using the `INSERT INTO` command.

    ```sql
    INSERT INTO movies (movie_name)
      VALUES ("Lion King"),
        ("The Godfather"),
        ("West Side Story"),
        ("Parasite"),
        ("The Wizard of Oz");

    INSERT INTO reviews (movie_id, review)
      VALUES (1, "Zazu is underrated. Give that hornbill a sequel!"),
        (2, "I'm gonna make him an offer you can't refuse, watch this movie"),
        (1, "Scar is the lion everyone loves to hate"),
        (3, "Ten years of ballet and three years of tap to join a gang in this neighborhood"),
        (5, "The tin man gave a metallic, hollow performance"),
        (1, "Hakuna matata"),
        (5, "Those flying monkeys are nightmare fuel!");
      
    ```

  * ğŸ”‘ To create our routes, we start by writing a query to access our data. It is a good idea to check our query works using the MySQL Shell.

    ```sql
    INSERT INTO movies (movie_name)
    VALUES (?);
    ```

  
* Open `28-Stu_Mini-Project/main/server.js` in your IDE and explain the following: 

  * We use the Node package `mysql2` to connect our database tn an express server.

    ```js
    const mysql = require('mysql2');
    ```

  * ğŸ”‘ Then, we create a connection to our database using `createConnection()`.

    ```js
    const db = mysql.createConnection(
      {
        host: 'localhost',
        user: 'root',
        password: '',
        database: 'movies_db'
      },
      console.log(`Connected to the movies_db database.`)
    );
    ```

 * ğŸ”‘ Now, that we have a connection, we can query the database directly from the Express environment. We use the `query()` method to execute our query on our database. 

    ```js
    db.query(sql, params, (err, result) => {
      if (err) {
        res.status(400).json({ error: err.message });
        return;
      }
      res.json({
        message: 'success',
        data: body
      });
    ```

  * ğŸ”‘ Finally, we wrap our query in an Express route. The paths define the endpoints at which requests can be made. When a route is requested, the query will be executed. 

    ```js
    app.post('/api/new-movie', ({ body }, res) => {
      const sql = `INSERT INTO movies (movie_name)
      VALUES (?)`;
      const params = [body.movie_name];
  
     db.query(sql, params, (err, result) => {
      if (err) {
        res.status(400).json({ error: err.message });
        return;
      }
      res.json({
        message: 'success',
        data: body
      });
      });
     });
    ```  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How can we use a route to execute a query in Express? 

  * ğŸ™‹ First, we connect our database using `mysql2`. Then, we use the `query()` method to execute the query and wrap the method in a valid Express route. 

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Express documentation on routing](https://expressjs.com/en/guide/routing.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 16. Instructor Demo: Introduce Homework (5 min)

* Open `12-SQL/02-Homework/Main/` from the command line and run `mysql -uroot` to open the MySQL Shell.

  * We use the `SOURCE` command to create and seed the database.

    ```sql
    SOURCE db/schema.sql;
    SOURCE db/seed.sql;
    ```

* Exit MySQL Shell and run `npm install` and `npm start` to demonstrate the following: 

  * From the command line, we can run a number of queries to add, select, and delete employees.

  * We click on `View ALl Employees` to select all of the employees.

  * We can also select employees by department or even delete an employee. Each time we make a selection, a query is executed on the database and the results are displayed. 

  * To complete this project, you will have to design a database capable of handling the queries needed as well as use your skills to perform queries that rely on one or more tables.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What are we learning?

  * ğŸ™‹ We are learning to build a database, perform queries and join tables. 

  * â˜ï¸ How does this project build off or extend previously learned material?

  * ğŸ™‹ To successfully complete this project, we will have to use the skills learned this week including creating a schema, seed a database, writing queries, and performing JOINS. 

  * â˜ï¸ How does this project relate to your career goals?

  * ğŸ™‹ SQL is an in-demand skill used in many workplaces. 

* Ask TAs to direct students to the Homework Requirements found in `12-SQL-dev/02-Homework/README.md`.

* Answer any questions before ending the class.

### 17. END (0 min)

How did todayâ€™s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

 Â© 2021 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
 
