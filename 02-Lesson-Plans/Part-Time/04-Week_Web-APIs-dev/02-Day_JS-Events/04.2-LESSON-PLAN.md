# 4.2 Lesson Plan - Event Listeners

## Overview

In today's class, students will learn to add event listeners to a DOM element, cancel default events, and stop event propogation. Students will also use the Window's local storage property to store data locally in the browser. 

## Instructor Notes

* In this lesson, students will complete activities `11-Ins_Click-Event` through `20-Stu_Local-Storage`.

* Today's class is focused on providing students with additional exposure to the DOM, this time focusing on events. The primary focus of today should be to ensure that students feel comfortable setting up event listeners and using their callbacks to manipulate the DOM.

* Be ready to view and edit local storage key-value pairs in Chrome DevTools. If you need a quick refresher, refer to [View And Edit Local Storage With Chrome DevTools](https://developers.google.com/web/tools/chrome-devtools/storage/localstorage).

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

* By the end of class students will be able to:

  * Handle click events using `.addEventListener()`

  * Prevent default behavior with `event.preventDefault()`.

  * Stop the propagation of events using `event.stopPropagation()`

  * Work with keyboard events `keyup` and `keydown`

  * Store values using `localStorage`

## Time Tracker

| Start  | #   | Activity Name                          | Duration |
|---     |---  |---                                     |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity         | 0:10     |
| 6:40PM | 2   | Instructor Demo: Event Listener        | 0:05     |
| 6:45PM | 3   | Student Do: Event Listener             | 0:15     |
| 7:00PM | 4   | Instructor Review: Event Listener      | 0:10     |
| 7:10PM | 5   | Instructor Demo: Preventing Default    | 0:05     |
| 7:15PM | 6   | Student Do: Preventing Default         | 0:15     |
| 7:30PM | 7   | Instructor Review: Preventing Default  | 0:10     |
| 7:40PM | 8   | Instructor Demo: Keyboard Events       | 0:05     |
| 7:45PM | 9   | Student Do: Keyboard Events            | 0:15     |
| 8:00PM | 10  | BREAK                                  | 0:15     |
| 8:15PM | 11  | Instructor Review: Keyboard Events     | 0:10     |
| 8:25PM | 12  | Instructor Demo:  Event Bubbling       | 0:05     |
| 8:30PM | 13  | Student Do: Event Bubbling             | 0:15     |
| 8:45PM | 14  | Instructor Review: Event Bubbling      | 0:10     |
| 8:55PM | 15  | Instructor Demo: Local Storage         | 0:05     |
| 9:00PM | 16  | Student Do: Local Storage              | 0:15     |
| 9:15PM | 17  | Instructor Review: Local Storage       | 0:15     |
| 9:30PM | 18  | END                                    | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Congratulate the class on how much they've learned up to this point and stress that while learning to manipulate the DOM may seem tricky at first, it is an essential skill for any developer who wants to build fully interactive web applications.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What are some ways we have already learned to manipulate the DOM using JavaScript?

  * üôã We have learned to create and append elements to the document, use `setAttribute()` to add styles to specific elements, and implement timers using `setInterval()` and `clearInterval()`.

* Explain that in today's class we are going to build on our DOM skills by learning how to use JavaScript to react to a user or browser action. These actions are called events. 

* Open the [Event Target Example](https://mdn.github.io/learning-area/javascript/building-blocks/events/useful-eventtarget.html) in your browser and explain the following:

  * The MDN Web Docs team built this demo to showcase how an event -- in this case a click -- can trigger a JavaScript reaction.

  * When we open the browser, we see a red block.

  * When we click on an area inside block, the area we clicked changes to a new color.

  * When we click on the area again, the color changes to a different color.

* Note that we have already learned most of the skills needed to achieve this color change reaction. 

* We can use `setAttribute()` or the element's `.style` property to add or change an element's color.

* We can use the document methods `.querySelector()` or `.getElementbyId()` to access the element we want to change.

* Explain that in today's class, we will learn how to attach a method to an HTML element that listens for an event and then reacts by executing a block of code.

### 2. Instructor Demo: Event Listener (5 min) 

* Open `Ins_Event-Listener/index.html` in your browser and demonstrate the following:

  * üîë  When we open the browser window, the background is in dark mode.

  * üîë  When we click on the toggle switch, the background switches to light mode.

  * üîë  When we click on the toggle switch again, the background returns to dark mode.

* Open `Ins_Event-Listener/assets/js/script.js` in your IDE and demonstrate the following:

  * üîë  We add the `.addEventListener()` method to the toggle switch element to listen for an event.

  ```js
  themeSwitcher.addEventListener()
  ```

   * üîë The `.addEventListener()` method takes two parameters. The first is the type of event. We set that to `click` since we want something to happen when a user clicks on the toggle switch.

   ```js
   themeSwitcher.addEventListener("click", )
   ```

   * üîë The second parameter is the action that we want performed when a user clicks.

   ```js
   themeSwitcher.addEventListener("click", function() {
   ```

  * üîë If the mode is dark when a user clicks, we use `.setAttribute()` to change the background to a light color.

  ```js
  if (mode === "dark") {
    mode = "light";
    container.setAttribute("class", "light");
  }
  ```

 * üîë Else when a user clicks, we set the background to a dark color by adding the class `dark`.

 ```js
  else {
    mode = "dark";
    container.setAttribute("class", "dark");
  } 
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

 * ‚òùÔ∏è Where have we used conditional statements before?

  * üôã We used conditional statements to add decision making to our Rock, Paper, Scissors project. In fact, all the code used to perform the triggered action is code we learned before. Using the `.addEventListener()` is just adding a new layer to our JavaScript skills.

  * ‚òùÔ∏è The `.addEventListener()` needs two parameters to execute. What are the two parameters?

  * üôã The `.addEventListener()` method takes that name of the event as the first parameter the action that will be executed as the second parameter.  

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `12-Stu_Event-Listener/README.md`.

### 3. Student Do: Event Listener (15 min) 

* Direct students to the activity instructions found in `12-Stu_Event-Listener/README.md`.

* Break your students into pairs that will work together on this activity.

```md

```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Event Listener (10 min) 

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with event listeners? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `.querySelector()`

  * ‚úîÔ∏è `.addEventListener()`

* Open `12-Stu_Event-Listener/Solved/assets/js/script.js` in your IDE and explain the following: 

  * üîë We use `.querySelector()` to select the button elements. 

  ```js
  var incrementEl = document.querySelector("#increment");
  var decrementEl = document.querySelector("#decrement");
  ```

  * üîë We use `.addEventListener()` and set the type of event to be a `click`.

  ```js
  incrementEl.addEventListener("click", function() {
  ```

  * üîë We add the action we want executed as the `.addEventListener()` method's second parameter. This function increments the count by `1` and  calls the `setCounterText()` function to update the HTML. 

  ```js
  function() {
    count++;
    setCounterText();
  }
  ```

  * We repeat the process for the decrement button except use the decrement operator `--` to decrease the count. We add a conditional statement so the action is performed only if the count is greater than `0`.

  ```js
  decrementEl.addEventListener("click", function() {
    if (count > 0) {
      count--;
      setCounterText();
    }
  });
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How can we listen for an event on an HTML element and then perform an action?

  * üôã We use the document method `.addEventListener()`. We set the method's first parameter to the type of event we want to listen for and the second parameter is the action we want performed when an event, like a click, happens.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [MDN Web Docs on EventTarget.addEventListener()](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 5. Instructor Demo: Prevent Default (5 min) 

* Open `13-Ins/Preventing-Default/index.html` in your browser and demonstrate the following:

* üîë When we enter information and click on the submit button on this form, a message appears.

* üîë The message includes the information that we entered in the text fields.

* Open `13-Ins/Preventing-Default/assets/js/script.js` in your IDE and demonstrate the following:

  * üîë Sometimes, we want to prevent a default action from occurring in response to an event.

  * üîë When we click on button inside a `<form>` element, the information in all text fields is cleared out by default.

  * üîë To prevent that action from happening, we use `event.preventDefault()`. This allows us to retain the information inputted to the text box after the click so we can print the message.

  ```js
  function showResponse(event) {
    event.preventDefault();
    console.log(event);
    var response = "Thank you for your submission " + nameInput.value + "! We will reach out to you at " + emailInput.value + ".";
    submissionResponseEl.textContent = response;
  }
  ```

  * üîë The action we want peformed when a user clicks on an element has been separated into its own, named function. We add it as the second parameter of the `.addEventListener()` method by using the name of function.

  ```js
  submitEl.addEventListener("click", showResponse);
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How do we prevent a default action from occurring when an event fires?

  * üôã We use `event.preventDefault()`. This is useful when we click on an submit button in a form. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `14-Stu_Prevent-Default/README.md`.


### 6. Student Do: Prevent Default (15 min) 

* Direct students to the activity instructions found in `14-Stu_Prevent-Default/README.md`.

* Break your students into pairs that will work together on this activity.

```md
@TODO ADD INSTRUCTIONS
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.





### 6. Instructor Do: Demo event.preventDefault (10 min)

* We will be spending some more time with forms. We will be learning about how to prevent some of the default form behavior so that we can manipulate data before sending it to a server.

* Ask the class the following question(s):

  * "What do you remember about forms?"

  * There are several type of inputs including check boxes, text fields, radio buttons, and select.

  * Forms also have default behaviors that occur on submission.

* Explain that if a button inside a `<form>` element is clicked, the information in all texts fields within the page is cleared out. This is default behavior that the browser enforces with all buttons within the form.

* Ask the students why this may be a problem.

  * We may want to retain that information on the page after the form has been submitted.

  * We could have other buttons within the form that should not submit the results.

* To avoid this default behavior, we use method called prevent default. 

* Open [12-Ins_Preventing_Default_Events/script.js](../../../../01-Class-Content/04-web-apis/01-Activities/12-Ins_Preventing_Default_Events/script.js) in your IDE.

  * We pass the callback to `addEventListener`, which has a parameter that represents the event object.

  ```js
  submitEl.addEventListener("click", function(event) {
    event.preventDefault();

    console.log(event);
    
    var response = "Thank you for your submission " + nameInput.value + "! We will reach out to you at " + emailInput.value + ".";
    submissionResponseEl.textContent = response;
  });
  ```

* Open [12-Ins_Preventing_Default_Events/index.js](../../../../01-Class-Content/04-web-apis/01-Activities/12-Ins_Preventing_Default_Events/index.html) in your browser and open the dev tools. 

  * Enter values into the input fields and click on the submit button.

  * Demonstrate that the entire click object appears in the console.

  * In the console, expand the `event` object and let students know that the event object is a large object that contains lots of data about the mouse event.

* Ask the class the following question(s):

  * What are these properties are used for?"

  * `ctrlKey` and `altKey` are booleans used to describe whether or not the user was holding down the key while they clicked.

  * If students ask about properties that you're unsure about, demonstrate that we can find out how they work by searching the [Mouse Event section of Mozilla's Documentation](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent).

* The event object contains metadata about a users interaction with the webpage. While the event we just observed is a mouse event, there are also keyboard events, mouse scroll events, and more.

* Return to [12-Ins_Preventing_Default_Events/script.js](../../../../01-Class-Content/04-web-apis/01-Activities/12-Ins_Preventing_Default_Events/script.js) in your IDE and comment out the `event.preventDefault()` line. 

* With the console open submit values again.

  * We click the button and we submit the form. 
  
  * When this happens, the event object appears in the console for a brief moment and all inputs are cleared. 
  
  * This is the default behavior for form submissions. In order to prevent this default behavior, we use the `event.preventDefault` method.

* Answer any questions before moving onto the next activity.

### 7. Student Do: Tip Calculator (15 min)

* Direct students to the next activity, found in[13-Stu_Preventing_Default_Events/Unsolved](../../../../01-Class-Content/04-web-apis/01-Activities/13-Stu_Preventing_Default_Events/Unsolved)

```md
# Preventing Default Events

In this activity, we are going to create a form that calculates a suggested tip amount based off of the total of the bill.

## Instructions

* In a file called `index.html`, create a form with the following elements:

1. An input for the total price of the meal

2. An input for the tip percentage

3. A button to calculate the tip

* In a file called `script.js`, create an event listener that utilizes the values from the input fields to calculate the reccommended tip and the new total of the bill with tip included.

* Once these values are calculated, display them on the page.

## Bonus 

* Add a feature that gives users the option to evenly split the total between any number of people. Make sure to add code to ensure that the split total will be rounded to two decimal places. 

## Hint

* In JavaScript, we have a function that rounds a number to a given point called `toFixed()`. For more information, visit the docs at [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed)
```

### 8. Instructor Do: Review Tip Calculator (5 min)

* Navigate to [13-Stu_Preventing_Default_Events/Solved/index.html](../../../../01-Class-Content/04-web-apis/01-Activities/13-Stu_Preventing_Default_Events/Solved/index.html) and open it in your browser.

* Enter a total into the input field and click the `Calculate Tip` button. 

* Click the `I'm feeling lucky` button and point out that the tip changes with every click.

* Split the tip between any number of people and point out that the input field has increment and decrement buttons built in.

  * The built in buttons are due to the attribute `type=number`. The input field also has the attribute `min=0` which prevents the user from decrementing once they reach zero.

* Open [13-Stu_Preventing_Default_Events/Solved/script.js](../../../../01-Class-Content/04-web-apis/01-Activities/13-Stu_Preventing_Default_Events/Solved/script.js) in your IDE and point out the following:

  * No functions are actually executed until the bottom of the file. 

* Some students may have chosen to write the callback function inline. This is completely fine. 

* Ask the class the following question(s):

  * "Why might it be helpful to write a separate function for that code?

  * Writing a named function helps separate the logic from the event listener.

  * Creating a named function also allows the function to be reused throughout the program. Any other function could call `addTip` if needed.

  ```js
  submitEl.addEventListener("click", addTip);
  ```

  * We still have access to the click event inside `addTip` since it is being called as a callback in the `addEventListener` function.

  ```js
  function addTip() {
  event.preventDefault();
  ```

  * We get the values from the total and tip percentage input fields, then call `calculateTip`. Remind the students that the value from input fields of `type=text` are always strings.
  
  ```js
  var tipPercentage = tipEl.value;
  var total = totalEl.value;
  var tipAmount = calculateTip(total, tipPercentage);
  ```

  * `toFixed(n)` is a number prototype method that returns a number and rounds it to the *nth* decimal place. Here, `n` is a variable that we use to describe an unspecified number in a series of numbers. We use this method because we want our total to be rounded to the nearest cent.

  * Even though `total` and `tipPercentage` are strings, we can still multiply them. This is because in JavaScript, the `*` operator coerces both arguments from strings into numbers before multiplying them. This is also the case for all arithmetic operators *except* for addition.

  ```js
  function calculateTip(total, tipPercentage) {
    var roundedResult = (total * tipPercentage).toFixed(2);
    return roundedResult;
  }
  ```

  * Since both `total` and `tipAmount` are strings, we need to convert them into numbers before adding them. Remind students that the `+` operator concatenates strings.

  * To do this, we use a global method called `parseFloat()` which takes a string as an argument and returns a decimal number, or floating point number. 
  
  * If any student asks what a floating point number is, simply explain that it is a number that contains a fraction. We use the term `float` to differentiate from the other type of number, `Integer`.

  ```js
  function calculateTotal(total, tipAmount) {
    return parseFloat(total) + parseFloat(tipAmount);
  }
  ```

  * Next point out that the bonus can be achieved by taking the text content of the `total` element and dividing it by the value from a field that describes how many people to split the bill between.

  * Lastly, `toFixed` should be used to ensure that the split amount only contains two decimal places.

  * Remind the students that they must use `event.preventDefault` to stop the form from automatically attempting to submit when the `split` button is clicked.

  ```js
  function splitTotal() {
    event.preventDefault();

    var total = document.querySelector("#new-total").textContent;
    var numPeople = document.querySelector("#num-people").value;
    
    var newTotal = (total / numPeople).toFixed(2);
    document.querySelector("#split-total").textContent = newTotal;
  }
  ```

* Briefly open [13-Stu_Preventing_Default_Events/Solved/index.html](../../../../01-Class-Content/04-web-apis/01-Activities/13-Stu_Preventing_Default_Events/Solved/index.html) in your browser and point out the following.
  
  * We query the elements `num-people`, `split`, and `split-total` in our JavaScript file.

  * We can add the attributes `type="number"` and `min="0"`. This means that the value from the input field will now be a number and will increment by whole numbers if the user uses the small arrow buttons to increase or decrease the value.

  * üóí Note that this does not replace validation and will not prevent users from manually entering a number smaller than zero.

  ```html
  <h2>
    Bonus:
  </h2>
  <h4>
    Split between <input id="num-people" type="number" min="0" /> people
  </h4>
  <button id="split" >
    Split
  </button>
  <h2>Each person will pay: <span id="split-total"></span></h2>
  ```

### 9. Instructor Do: Demo Key Events (5 min)

* Open [14-Ins_Other_Events/index.html](../../../../01-Class-Content/04-Web-APIs/01-Activities/14-Ins_Other_Events/index.html) in your browser.

* Demonstrate that the application works as intended by switching the typeface.

  * Select serif, then go back to sans-serif. 

  * Type some random text in the textarea.

* Open `index.html` and point out the following:

  * The form element only needs `<select>`, a `<textarea>`, and a `<button>` to clear the text.

```html
<form>
  <select id="typeface">
    <option value="serif">
      serif
    </option>
    <option value="sans-serif">
      sans-serif
    </option>
  </select>
  <div style="margin-top: 50px;">
    <textarea id="textarea" placeholder="Your input" ></textarea>
    <div>
      <button id="clear">Clear</button>
    </div>
  </div>
</form>
```

* Open [14-Ins_Other_Events/script.js](../../../../01-Class-Content/04-Web-APIs/01-Activities/14-Ins_Other_Events/script.js) and point out the following: 

  * We use `querySelector` to gather all of the elements we would like to target into variables.

  ```js
  var typefaceEl = document.querySelector("#typeface");
  var clearEl = document.querySelector("#clear");
  var h1El = document.querySelector("#h1");
  var h2El = document.querySelector("#h2");
  var h3El = document.querySelector("#h3");
  var pEl = document.querySelector("#p");
  var textAreaEl = document.querySelector("#textarea");
  ```
  * We create an array of elements so that we can later loop over them.
  
  ```js
  var elements = [
    h1El, h2El, h3El, pEl
  ];
  ```

  * We add a listener to the typeface `<select>` element. A *change* listener will execute its callback every time the value of the `<select>` element is changed. This is how we get our desired behavior of updating the CSS every time the font typeface is changed.

  ```js
  var typeface;

  typefaceEl.addEventListener("change", function(event) {
    event.preventDefault();
    typeface = typefaceEl.value;
    document.querySelector(".container").style.fontFamily = typeface;
  });
  ```

  * In our textarea, we've added an event listener to the keydown event. First we use a conditional to make sure that the key is a letter, number, or space. We use the `key` property since `keyCode` and `charCode` have been deprecated.

  * We create an array of all alphanumeric characters, then we use `Array.includes` to make sure that the key pressed is alphanumeric. 

  * Once we've determined that the key being pressed is a valid choice, we append the string to each element in our `elements` array.

  ```js
  textAreaEl.addEventListener("keydown", function(event) {
    event.preventDefault();
    var key = event.key.toLowerCase();
    var alphabetNumericCharacters = "abcdefghijklmnopqrstuvwxyz0123456789 ".split("");
    if (alphabetNumericCharacters.includes(key)) {
      elements.forEach(function(element) {
        element.textContent += event.key;
      });
    }
  });
  ```

  * Lastly, we add a `clear` function that will clear out the `textContent` of each element when its button is pressed.

  ```js
  clearEl.addEventListener("click", function(event) {
    event.preventDefault();
    textAreaEl.value = "";
    elements.forEach(function(element) {
      element.textContent = "";
    });
  });
  ```

### 10. Student Do: Listening For Other Events (15 min)

* Direct students to the next activity, found in [15-Stu_Other_Events/Unsolved](../../../../01-Class-Content/04-web-apis/01-Activities/15-Stu_Other_Events/Unsolved)

```md
# Listening For Other Events

## Instructions

* In this activity, we are going to create a webpage that will allow us to view some meta data about different kinds of events.

* Open the `index.html` file in your browser and take a moment to study the application.

* Take a moment to study the code in `index.html` then add the following functionality to the application:

  1. The select element should trigger the `toggleDisplay` function in `script.js`.

  2. If `key` is selected, the event's code, key, and status (keydown or keyup) should be displayed in the `#key-events` div when the user presses a key anywhere on the document.

  3. If `click` is selected, the text content of the event's target, and the cursor's x and y coordinates should be displayed in the `#click-events` div when the user clicks the anywhere on document.

## Bonus

* If time permits, take a moment to research some other JavaScript events.
```

### 11. Instructor Do: Review Other Events (5 min)

* Open [15-Stu_Other_Events/Solved/index.html](../../../../01-Class-Content/04-web-apis/01-Activities/15-Stu_Other_Events/Solved/index.html) in your browser.

* Demonstrate that the application works by holding down a key for a couple of seconds, then releasing it.

* Select the *click events* option and click on an html element or two.

  * Point out that if we click the on a spot that doesn't have an html element, the `textContent` from each element on the page is appending to the `target` span.

* Ask students why clicking on a blank spot on the page adds the entire page to `target`.

  * This is because the `textContent` property returns **all** text content from the DOM node and its children.

* Next open [15-Stu_Other_Events/Solved/script.js](../../../../01-Class-Content/04-web-apis/01-Activities/15-Stu_Other_Events/Solved/script.js) and go over the solution.

  * We grab the `key` and `code` properties and append them to their respective span elements on the page.

  * Since this function is only ran if the keydown activity, we can explicitly set the status text content to be `KEYDOWN Event`.

  * Remind students that although we did not write this function inline with the event listener, we still have access to its  

  ```js
  function keydown(event) {
    var keyPress = event.key;
    var keyCode = event.code;
    document.querySelector("#key").textContent = keyPress;
    document.querySelector("#code").textContent = code;
    var status = document.querySelector("#status");
    status.textContent = "KEYDOWN Event";
  }
  ```

* Ask the class the following question(s):

  * 'What other types of user interactions might we want to capture?'

  * Hover/mouseover events

  * onChange events

  * onLoad events

* Answer any remaining questions and let students out for break.

- - -

### 12. Everyone Do: BREAK (15 min)

- - -

### 13. Instructor Do: Demo Event Bubbling and Propagation (10 min)

* Open [16-Ins_Event_Bubbling/index.html](../../../../01-Class-Content/04-web-apis/01-Activities/16-Ins_Event_Bubbling/index.html) in your IDE and point out the following: 

  * Each `div` has an event listener set up that will change its background color to the color specified. 

* Ask the class the following question(s):

  * "What will happen when the innermost button is clicked?"

  * We will see that every `div` changes colors

* Refresh the page and click the middle `div`. Point out the following: 

  * We only see the two outer divs change colors.

* Ask the class the following question(s):

  * "Why are we seeing this behavior."

  * Many students may think that this behavior happens because a parent event triggers the same event on all of its children.

  * We have instantiated an event listener on a div that has parent elements which also have event listeners. 

  * When an event occurs on an element with an event listener, it **bubbles** up through each of its parent DOM nodes until it reaches the top. We can prevent this behavior by using a method called `event.stopPropagation`.

* Open [16-Ins_Event_Bubbling/script.js](../../../../01-Class-Content/04-web-apis/01-Activities/16-Ins_Event_Bubbling/script.js) and give the students a minute to observe the code. 

* Then uncomment every `stopPropagation()` function call and click each button in the same order as previously demonstrated.

  * This is a good moment to reiterate that `stopPropagation` is taking the click event and preventing it from bubbling *up*.

  * If students are having a tough time grasping this concept, try commenting out every `stopPropagation` call except for the second from outermost call. Then open the page in your browser and click on the innermost button.

### 14. Student Do: Event Bubbling (20 min)

* Direct students to the next activity, found in [17-Stu_Event_Bubbling/Unsolved](../../../../01-Class-Content/04-web-apis/01-Activities/17-Stu_Event_Bubbling/Unsolved)

```md
# Event Bubbling

In this activity, we are going to create an image carousel that allows us to cycle through images. 

## Instructions

* In a file called `index.html`, create a div that contains two buttons: `previous` and `next`. The carousel should support the following features: 

  1. When the `next` button is clicked, the image should change to the next image in the array. If the image has reached the end of the array, the image should start over at the start of the array.

  2. When the `previous` button is clicked, the image should change to the previous image in the array. If the image has reached the start of the array, the image should start over at the end of the array.

  3. When the user clicks on an image, they will be navigated to the url that hosts that image.
```

### 15. Instructor Do: Review Event Bubbling (5 min)

* Open [17-Stu_Event_Bubbling/Solved/index.html](../../../../01-Class-Content/04-web-apis/01-Activities/17-Stu_Event_Bubbling/Solved/index.html) in the browser.

* Demonstrate that the application works by clicking through the images four times, then clicking on an image.

  * Point out that the user is only navigated away if they click on the image.

* Open [17-Stu_Event_Bubbling/Solved/script](../../../../01-Class-Content/04-web-apis/01-Activities/17-Stu_Event_Bubbling/Solved/script.js) in your IDE

  * First, we initialize our element variables and create an array to hold the links to the images. We also initialize our background image.

  ```js
  box.style.backgroundImage = "url('https://picsum.photos/300/200')";
  var index = 0;
  var images = [
    "https://picsum.photos/300/200",
    "https://picsum.photos/300/201",
    "https://picsum.photos/300/202",
    "https://picsum.photos/300/203"
  ];
  ```

  * When the image container is clicked, we use `window.location.href` to navigate the browser to the url that hosts the image.

  ```js
  box.onclick = function(event) {
    window.location.href = images[index];
  };
  ```

  * Next, we set up the `navigate` function, which handles click events on both the `previous` and `next` buttons. Alternatively, students may have created two separate functions to handle each button click.

  ```js
  function navigate(direction) {
    index = index + direction;
    if (direction === -1 && 
        index < 0) { 
      index = length - 1; 
    }
    if (direction === 1 && 
        !images[index]) { 
      index = 0;
    }
    current = "url('" + images[index] + "')";
    box.style.backgroundImage = current;
  }
  ```

  * We add an event listener to each button, calling `event.stopPropagation();` to prevent the click event from bubbling up to our image container.

  * If students are still struggling to grasp the importance of `event.stopPropagation()`, comment it out in both callbacks. Then click on the `next` button and explain that without `event.stopPropagation()`, the click event from the button bubbles up and triggers the click event on `box`.

  ```js
  next.addEventListener("click", function(event){
    event.stopPropagation();
    navigate(1);
  });
  prev.addEventListener("click", function(event) {
    event.stopPropagation();
    navigate(-1);
  });
  navigate(0);
  ```

### 16. End (0 min)

### Lesson Plan Feedback

How did today‚Äôs lesson go? Your feedback is important. Please take 5 minutes to complete this anonymous survey.

[Class Survey](https://forms.gle/nYLbt6NZUNJMJ1h38)
