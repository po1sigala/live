# 13.3 Part-Time Lesson Plan: Relationships with Sequelize

## Overview 

Today's lesson focuses on how to relate data between SQL tables using Sequelize associations and how to model one-to-one, one-to-many, and many-to-many relationships. Students will also learn how to write SQL sub-queries with Sequelize literals, incorporate ESLint in a project and understand why it's used, and deploy their application to Heroku with a MySQL database. 

## Instructor Notes

* Complete activities `21-Ins_One-to-One` through `28-Stu_Mini-Project`

* Check out the [Sequelize docs on associations](https://sequelize.org/master/manual/assocs.html) to learn how to create relationships. They provide limited real-world examples, so be sure to look at how they are implemented in the activities and mini project prior to class.

* All of the activities will be using Insomnia Core to test the routes, instead of relying on a front end. Be sure to have it installed and ready for all activities.

* To speed up demonstrations and activity reviews, perhaps run `npm install` and create the database for every activity before class starts. Don't forget to recreate the database or use `.sync({force: true})` to drop the tables between activities. 

* All activities will require changing the `.env.EXAMPLE` file to `.env` and filling it with your MySQL credentials, instruct students that arrive early to class to go ahead and fill out that information ahead of time so they can focus on the activity at hand.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live code the solutions to the activities. If not, no worries. Use the solutions provided and follow the prompts and talking points for review. 

* Let students know that the Bonus for each activity is meant to give them "food for thought". Rather than extra coding practice, it is a self-study on related topics that are beyond the scope of this unit for those who want to dig deeper and further their knowledge on this topic.

* If the students struggle with the `Everyone Do: Eslint` activity, walk through it with the students using the talking points provided. Otherwise, support the students as they do the activity and do a brief review at the end. 

## Learning Objectives

By the end of class, students will be able to:

* Implement and know when to use different Sequelize associations to relate data for one-to-one, one-to-many, and many-to-many relationships.

* Use a combination of Sequelize methods and plain SQL syntax to perform sub-queries.

* Enforce code styling for an application using ESLint.

* Deploy an application with a MySQL database to Heroku.

## Time Tracker
| Start  | #   | Activity Name                      | Duration |
|---     |---  |---                                 |---       |
| 10:00AM| 1   | Instructor Do: Stoke Curiosity     | 0:10     |
| 10:10AM| 2   | Instructor Demo: One-to-One        | 0:05     |
| 10:15AM| 3   | Student Do: One-to-One             | 0:15     |
| 10:30AM| 4   | Instructor Review: One-to-One      | 0:10     |
| 10:40AM| 5   | Instructor Demo: One-to-Many       | 0:05     |
| 10:45AM| 6   | Student Do: One-to-Many            | 0:15     |
| 11:00AM| 7   | Instructor Review: One-to-Many     | 0:10     |
| 11:10AM| 8   | Instructor Demo: Literals          | 0:05     |
| 11:15AM| 9   | Student Do: Literals               | 0:15     |
| 11:30AM| 10  | Instructor Review: Literals        | 0:10     |
| 11:40AM| 11  | Everyone Do: ESLint                | 0:20     |
| 12:00PM| 12  | BREAK                              | 0:40     |
| 12:40PM| 13  | Instructor Demo: Mini Project      | 0:05     |
| 12:45PM| 14  | Student Do: Mini Project           | 0:60     |
| 1:45PM | 15  | Instructor Review: Mini Project    | 0:10     |
| 1:55PM | 16  | Introduce Homework                 | 0:05     |
| 2:00PM | 17  | END                                | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Remind students that one of the main offerings of SQL is that we can connect two or more tables of data together to create relationships between data. 

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What are some examples of data we could relate using SQL? 

  * üôã Artists and albums/tracks, pet owners and their pets, almost any relationship that exists in real life can be represented in a SQL database.

  * ‚òùÔ∏è Why would we want to represent these real-world relationships in our applications?

  * üôã These types of relationships are what make up our everyday lives, both in person and on the web. Think about all of the social networks we belong to and online stores that know our personal preferences; these are all digital representations of characteristics and relationships that exist in real life.

  * ‚òùÔ∏è Using plain SQL, how do we establish these relationships?

  * üôã We define a relationship between tables by creating a foreign key column that holds a reference to the primary key of the related data.

  * ‚òùÔ∏è Do we think we can build the same type of relationships using Sequelize?

  * üôã You bet! 

* Explain that today will be about learning how Sequelize allows us to more clearly define relationships between data, as well as learn some other interesting tools to help us be better developers.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: One-to-One (5 min) 

* Navigate to `21-Ins_One-to-One` and run `npm install` from the command line. Be sure to change the `.env.EXAMPLE` file into your own `.env` file with your credentials.

* Run `npm start` from the command line and walk through the following in the command line console: 

  * üîë By default, Sequelize logs what commands it performs on the SQL server, even on load:

  ```bash
  Executing (default): CREATE TABLE IF NOT EXISTS `driver` (`id` INTEGER NOT NULL auto_increment , `name` VARCHAR(255) NOT NULL, `address` VARCHAR(255) NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB;
  Executing (default): SHOW INDEX FROM `driver`
  Executing (default): CREATE TABLE IF NOT EXISTS `license` (`id` INTEGER NOT NULL auto_increment , `license_number` CHAR(36) BINARY, `is_donor` TINYINT(1) DEFAULT true, `driver_id` INTEGER, PRIMARY KEY (`id`), FOREIGN KEY (`driver_id`) REFERENCES `driver` (`id`) ON DELETE CASCADE ON UPDATE CASCADE) ENGINE=InnoDB;
  Executing (default): SHOW INDEX FROM `license`
  ```

  * üîë Notice in these statements that create the tables, the `license` table stores a reference to the `driver` table as a foreign key. 

* Ask the class the following question (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Why would we want license data to have a reference to a driver?

  * üôã Driver's licenses are property of a driver, so we need to know which driver holds this license.

* Open `21-Ins_One-to-One/models` in your IDE and explain the following:

  * üîë In `Driver.js`, there's nothing that indicates ownership of a License.

  * üîë In `License.js`, however, there is a column created that specifically references the `driver` model:

  ```js
  // This column will store a reference of the `id` of the `Driver` that owns this License
  driver_id: {
    type: DataTypes.INTEGER,
    references: {
      // This references the `driver` model, which we set in `Driver.js` as its `modelName` property
      model: 'driver',
      key: 'id',
    },
  },
  ```

  * üîë In `index.js`, however, we instruct Sequelize to create a relationship between the models and details of that relationship:

  ```js
  // Define a Driver as having one License to create a foreign key in the `license` table
  Driver.hasOne(License, {
    foreignKey: 'driver_id',
    // When we delete a Driver, make sure to also delete the associated License.
    onDelete: 'CASCADE',
  });

  // We can also define the association starting with License
  License.belongsTo(Driver, {
    foreignKey: 'driver_id',
  });
  ```

  * It's important that we import the models into `index.js` before establishing any associations between them.

  * Ask the class the following question (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What do we think the `.hasOne()` method does here?

  * üôã A driver should only have one driver's license!

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `22-Stu_One-to-One/README.md`.

### 3. Student Do: One-to-One (15 min) 

* Direct students to the activity instructions found in `22-Stu_One-to-One/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìê Add Comments to Implementation of a One-to-One Association

  Work with a partner to add comments describing the functionality of the code found in the following files: 

  * [Unsolved/models/index.js](./Unsolved/models/index.js)

  * [Unsolved/models/LibraryCard.js](./Unsolved/models/LibraryCard.js)

  * [Unsolved/routes/api/readerRoutes.js](./Unsolved/routes/api/readerRoutes.js)

  * [Unsolved/routes/api/libraryCardRoutes.js](./Unsolved/routes/api/libraryCardRoutes.js)

  ## üìù Note(s)

  * Refer to the documentation: 

    * [Sequelize docs on associations](https://sequelize.org/master/manual/assocs.html)

  ---

  ## üèÜ Bonus

  * If you have fully completed the above tasks, here is something you and your partner can work through as an added challenge to further your knowledge:

    * What is an Entity Relationship Diagram (ERD)?

  * Use [Google](https://www.google.com) or another search engine to research the above.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students that need extra help while circulating through room.

### 4. Instructor Review: One-to-One (10 min)  

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with one-to-one relationships in Sequelize? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (üîë) points:

  * ‚úîÔ∏è Foreign key columns

  * ‚úîÔ∏è Sequelize association methods

  * ‚úîÔ∏è Perform JOIN with `include` option

* Open `22-Stu_One-to-One/Solved` in your IDE and explain the following: 

  * üîë In `models/LibraryCard.js`, we create a foreign key column to reference the library card's `Reader`

  ```js
  reader_id: {
    type: DataTypes.INTEGER,
    references: {
      model: 'reader',
      key: 'id',
    },
  },
  ```

  * üîë In `models/index.js`, we import both models, associate them to one another, and export them as an object:

  ```js
  const Reader = require('./Reader');
  const LibraryCard = require('./LibraryCard');

  Reader.hasOne(LibraryCard, {
    foreignKey: 'reader_id',
    onDelete: 'CASCADE',
  });

  LibraryCard.belongsTo(Reader, {
    foreignKey: 'reader_id',
  });

  module.exports = { Reader, LibraryCard };
  ```

  * In both of our API route files, we import both models through destructuring:

  ```js
  const { LibraryCard, Reader } = require('../../models');
  ```

  * üîë Also in our API route files, our `GET` routes use the `include` option to perform a SQL JOIN:

  ```js
  const readerData = await Reader.findAll({
    include: [{ model: LibraryCard }],
  });
  ```

* If time allows, demonstrate what this looks like by seeding the database, running the app, and using Insomnia Core to demonstrate:

  * We can now create a library card and associate it with its reader by running a POST request to `/api/cards` with a JSON body of:

  ```json
  {
    "reader_id": 1
  }
  ```

  * We can query a reader and get their associated library card as well by running a GET request to `/api/readers`.  

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What would happen if a reader tried to create a second card? 

  * üôã It would fail, as we've run into what's known as a "Foreign Key Constraint"

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Sequelize docs on one-to-one relationships](https://sequelize.org/master/manual/assocs.html#one-to-one-relationships), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: One-to-Many (5 min) 

* Navigate to `23-Ins_One-to-Many` and run `npm install` from the command line. Be sure to change the `.env.EXAMPLE` file into your own `.env` file with your credentials. To speed things up, run `node seeds/seed.js` as well to seed the database tables.

* Run `npm start` from the command line and use Insomnia Core to demonstrate the following: 

  * üîë When we perform a GET request to `/api/drivers/1`, we get a response that includes not only the driver's licence data, but also an array of their owned cars:

  ```json
  {
    "id": 1,
    "name": "Sal",
    "address": "200 Response St",
    "license": {
      "id": 1,
      "license_number": "bea06fda-0543-4cc7-82e9-3743fccf566b",
      "is_donor": true,
      "driver_id": 1
    },
    "cars": [
      {
        "id": 2,
        "make": "Honda",
        "model": "Accord",
        "mileage": 30000,
        "driver_id": 1
      },
      {
        "id": 4,
        "make": "Toyota",
        "model": "Camry",
        "mileage": 60000,
        "driver_id": 1
      },
      {
        "id": 6,
        "make": "Subaru",
        "model": "Outback",
        "mileage": 20000,
        "driver_id": 1
      }
    ]
  }
  ```

* Open `23-Ins_One-to-Many` in your IDE and demonstrate the following:

  * üîë In `models/Car.js`, we create a model with a column to reference the `id` of the driver that owns it.

  ```js
  driver_id: {
    type: DataTypes.INTEGER,
    references: {
      model: 'driver',
      key: 'id',
    },
  },
  ```

  * üîë In `models/index.js`, not only to drivers have one license, but they also now have many cars and cars belong to one driver:

  ```js
  Driver.hasMany(Car, {
    foreignKey: 'driver_id',
    onDelete: 'CASCADE',
  });

  Car.belongsTo(Driver, {
    foreignKey: 'driver_id',
  });
  ```

  * üîë In `routes/api/driverRoutes.js`, our GET route queries use the `include` option to perform a JOIN to retrieve associated driver's license and cars:

  ```js
  const driverData = await Driver.findByPk(req.params.id, {
    include: [{ model: License }, { model: Car }],
  });
  ``` 

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Are we able to create a new driver's license or car without a driver? 

  * üôã Nope! The nature of this relationship is that a driver owns these things, so their owner needs to exist before they can be created. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `24-Stu_One-to-Many/README.md`.

### 6. Student Do: One-to-Many (15 min) 

* Direct students to the activity instructions found in `24-Stu_One-to-Many/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üèóÔ∏è Implement One-to-Many Association Between Reader and Book Models

  Work with a partner to implement the following user story:

  * As a book owner, I want to see what books belong in my collection.

  ## Acceptance Criteria

  * It's done when the MySQL table for book data has a foreign key referencing the reader table.

  * It's done when the response of a GET request to `/api/readers` or `/api/readers/:id` includes a reader's owned books, like this JSON code shows:

    {
      "id": 1,
      "name": "Lernantino",
      "email": "lernantino@gmail.com",
      "password": "$2b$10$AcbPGE6mNk3aZAnFCan1XeVVbuDYhQiHxOQ/gIG/PSUj2WoOR2pGC",
      "library_card": {
        "id": 2,
        "card_number": "8342e78a-7265-4060-9834-81a19c76c041",
        "reader_id": 1
      },
      "books": [
        {
          "id": 4,
          "title": "The Pragmatic Programmer: Your Journey To Mastery",
          "author": "David Thomas",
          "isbn": "978-0135957059",
          "pages": 352,
          "edition": 2,
          "is_paperback": false,
          "reader_id": 1
        },
        {
          "id": 6,
          "title": "Algorithms of Oppression: How Search Engines Reinforce Racism",
          "author": "Safiya Umoja Noble",
          "isbn": "978-1479837243",
          "pages": 256,
          "edition": 1,
          "is_paperback": true,
          "reader_id": 1
        }
      ]
    }
    

  ---

  ## üí° Hint(s)

  * When associating these models, would users have books or would books have users? 

  ## üèÜ Bonus

  * If you have fully completed the above tasks, here is something you and your partner can work through as an added challenge to further your knowledge:

    * As a JavaScript developer using Sequelize, why is it still important to know SQL?

  * Use [Google](https://www.google.com) or another search engine to research the above.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students that need extra help while circulating through room.

### 7. Instructor Review: One-to-Many (10 min)  

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with one-to-many relationships? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (üîë) points:

  * ‚úîÔ∏è The foreign key column

  * ‚úîÔ∏è The `.hasMany()` method

  * ‚úîÔ∏è The `include` option

* Open `24-Stu_One-to-Many/Solved` in your IDE and explain the following: 

  * üîë In `models/Book.js`, we add a column to store a reference to the reader that owns the book: 

    ```js
    reader_id: {
      type: DataTypes.INTEGER,
      references: {
        model: 'reader',
        key: 'id',
      },
    },
    ```

  * üîë In `models/index.js`, we create the relationship between readers and books by declaring that readers have many books and a book belongs to one reader:

  ```js
  Reader.hasMany(Book, {
    foreignKey: 'reader_id',
    onDelete: 'CASCADE',
  });

  Book.belongsTo(Reader, {
    foreignKey: 'reader_id',
  });
  ```

  * üîë In `routes/api/readerRoutes.js`, we use the `include` option to perform a JOIN: 

  ```js
  const readerData = await Reader.findAll({
    include: [{ model: LibraryCard }, { model: Book }],
  });
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What happens to the books or library cards owned by a reader if that reader is deleted?

  * üôã They will also be deleted, because we set `onDelete: 'CASCADE'`.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Sequelize docs on one-to-many relationships](https://sequelize.org/master/manual/assocs.html#one-to-many-relationships), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Sequelize Literals (5 min) 

* Navigate to `25-Ins_Literals` and run `npm install` from the command line. Be sure to change the `.env.EXAMPLE` file into your own `.env` file with your credentials. To speed things up, run `node seeds/seed.js` as well to seed the database tables.

* Run `npm start` from the command line and use Insomnia Core to demonstrate the following: 

  * üîë When we perform a GET request to `/api/drivers/2`, we get a response that includes everything from before, but also a total sum of the mileage of all cars owned by the driver:

  ```json
  {
    "id": 2,
    "name": "Lernantino",
    "address": "404 Express Blvd",
    "totalMileage": "150000",
    "license": {
      "id": 2,
      "license_number": "54f17c3c-aef2-49ac-b68a-b66f8645222d",
      "is_donor": true,
      "driver_id": 2
    },
    "cars": [
      {
        "id": 1,
        "make": "Ford",
        "model": "Mustang",
        "mileage": 40000,
        "driver_id": 2
      },
      {
        "id": 4,
        "make": "Toyota",
        "model": "Camry",
        "mileage": 60000,
        "driver_id": 2
      },
      {
        "id": 5,
        "make": "Toyota",
        "model": "Corolla",
        "mileage": 50000,
        "driver_id": 2
      }
    ]
  }
  ```


* Open `25-Ins_Literals` in your IDE and demonstrate the following:

  * üîë In `routes/api/driverRoutes.js`, we update our query to include a new attribute called `totalMileage` that has a value of the output of a SQL function:

  ```js
  const driverData = await Driver.findAll({
    include: [{ model: License }, { model: Car }],
    attributes: {
      include: [
        [
          // Use plain SQL to add up the total mileage
          sequelize.literal(
            '(SELECT SUM(mileage) FROM car WHERE car.driver_id = driver.id)'
          ),
          'totalMileage',
        ],
      ],
    },
  });
  ```

  * üîë Since we need to perform a SQL query on our database connection, we import our Sequelize instance at the top of the file:

  ```js
  const sequelize = require('../../config/connection');
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Why would we want to use regular SQL with Sequelize?

  * üôã Sequelize provides a lot, but sometimes it's easier to just use plain SQL when it comes to a more complicated query.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `26-Stu_Literals/README.md`.

### 9. Student Do: Sequelize Literals (15 min) 

* Direct students to the activity instructions found in `26-Stu_Literals/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üêõ Users Route is Missing Data

  Work with a partner to resolve the following issue(s):

  * As a user, I want to see the books I own and a total count of how many books are short novels.

  ## Expected Behavior

  When a request is made for user data, the response includes a `shortBooks` property that totals the number of books with a page count between 100 and 300.

  ## Actual Behavior

  The user data in the response does not include a `shortBooks` property.

  ## Steps to Reproduce the Problem

  1. Run `node seeds.js` from the command line to seed the database.

  2. Run `npm start` to start the server.

  3. In Insomnia Core, make a GET request to `/api/readers/1`.

  4. Note that the response data does not include a `shortBooks` property.

  ---

  ## üí° Hint(s)

  * How could you obtain this short novel count using a regular SQL query?

  ## üèÜ Bonus

  * If you have fully completed the above tasks, here is something you and your partner can work through as an added challenge to further your knowledge:

    * How would you build a many-to-many relationship using Sequelize?

  * Use [Google](https://www.google.com) or another search engine to research the above.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students that need extra help while circulating through room.

### 10. Instructor Review: Sequelize Literals (10 min)  

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with using regular SQL queries in Sequelize? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (üîë) points:

  * ‚úîÔ∏è The `attribute` query option.

  * ‚úîÔ∏è The use of `sequel.literal()`

  * ‚úîÔ∏è SQL function `COUNT()`

* Open `26-Stu_Literals/Solved/routes/api/readerRoutes.js` in your IDE and explain the following: 

  * üîë For our GET routes, we add the `attributes` option to instruct Sequelize to include or exclude any columns or fields:

  ```js
  const readerData = await Reader.findAll({
    include: [{ model: LibraryCard }, { model: Book }],
    attributes: {
      include: [
        [
          // Use plain SQL to get a count of all short books
          sequelize.literal(
            '(SELECT COUNT(*) FROM book WHERE pages BETWEEN 100 AND 300 AND book.reader_id = reader.id)'
          ),
          'shortBooks',
        ],
      ],
    },
  });
  ```

  * üîë In the `include`, we add an array with the `sequelize.literal()` query first and the attribute name we'll use second. 

  * üîë The SQL `COUNT()` function will return a number of how many books have between 100 and 300 pages.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Is there any way we can make this code easier to read in our route's callback function?

  * üôã Yes, we can create a static Sequelize method to perform on the model.

  * ‚òùÔ∏è Why does our SQL query have to explicitly mention where `book.reader_id = reader.id`?

  * üôã If we didn't include that, it would count ALL books and not just the books owned by this reader.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Sequelize docs on Sub Queries](https://sequelize.org/master/manual/sub-queries.html), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `27-Evr_Eslint/README.md`.

### 11. Everyone Do: ESLint (20 min)

* Open the [ESLint docs](https://eslint.org/) in your browser and explain the following:

  * ESLint is a tool we can use in our applications to help enforce code styling and consistency.

* Direct students to the activity instructions found in `27-Evr_Eslint/README.md`:

  ```md
  # üêõ Code Not Following ESLint Rules

  Work with a partner to resolve the following issue(s):

  * As a developer on a team, I want my team's codebase to follow the same formatting and styling using rules ESLint provides.

  ## Expected Behavior

  The code in [Unsolved/example.js](Unsolved/example.js) should pass all tests and rules listed in [Unsolved/.eslintrc.json](Unsolved/.eslintrc.json) and not have red underlines.

  ## Actual Behavior

  The code in [Unsolved/example.js](Unsolved/example.js) does not pass most rules listed in [Unsolved/.eslintrc.json](Unsolved/.eslintrc.json) and have red underlines.

  ## Steps to Reproduce the Problem

  * Install the [VS Code Eslint Extension](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint).

  * Run `npm install` from the command line in the [Unsolved](./Unsolved) folder.

  * Open [Unsolved/example.js](Unsolved/example.js) in your code editor. If you were able to complete the previous steps correctly, you should see red annotations under different parts of the code. Hovering over each displays a popover with an ESLint rule being broken.

    * Alternatively, you can run `npm run test` to get a list of where code styling errors occur and what errors they are.

  ---

  ## üí° Hint

  * How can we better understand the rules in [Unsolved/.eslintrc.json](Unsolved/.eslintrc.json) using the [ESLint documentation](https://eslint.org/docs/rules/)?

  ## üèÜ Bonus

  * If you have fully completed the above tasks, here is something you and your partner can work through as an added challenge to further your knowledge:

    * How can we ensure our code passes all ESLint checks before merging a GitHub pull request? 

  * Use [Google](https://www.google.com) or another search engine to research the above.

  ```

* While everyone is working on the activity, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students that need extra help while circulating through room.

* Navigate to `27-Evr_Eslint/Unsolved` on the command line and run `npm install` so we can demonstrate the following:

  * üîë If we run `npm run test`, ESLint will check all of our JavaScript files for code styling issues by comparing it to both its internal base rules and what rules are present in `.eslintrc.json`

* Open `27-Evr_EsLint/Unsolved` in your IDE to demonstrate the following:

  * üîë The ESLint extension for Visual Studio Code also allows us to open a file like `example.js` and view what's wrong. We can highlight over underlined code to get a dialog of what's wrong and how we can fix it.

  * The `.eslintrc.json` file is where we can tell ESLint how to handle certain rules and formats.

  * In `package.json`, we use `npm run test` to run `npm run lint`, a convention used in the development field so we have more meaningfully named commands to run.

  * The `npm run lint` script uses `npx` to temporarily download ESLint as an executable command and run it on all files that match the extension of `.js`:

  ```json
  "lint": "npx eslint **/*.js --quiet; exit 0",
  ``` 

* Answer any questions before students go on break.

### 12. BREAK (40 min)

### 13. Instructor Demo: Mini Project (5 min) 

* Navigate to `25-Ins_Literals/Solved` and run `npm install` from the command line. Be sure to change the `.env.EXAMPLE` file into your own `.env` file with your credentials. To speed things up, run `node seeds/seed.js` as well to seed the database tables.

* Run `npm start` from the command line and use Insomnia Core to demonstrate the following: 

  * üîë When we perform a GET request to `/api/travellers/:id` (pick an `id`), we get back data for a traveller along with the locations they plan on visiting and more information for that trip:

  ```json
  {
    "id": 2,
    "name": "Lernantino",
    "email": "lernantino@gmail.com",
    "trip_locations": [
      {
        "id": 4,
        "location_name": "Miami",
        "trip": {
          "id": 4,
          "trip_date": null,
          "traveller_amount": 3,
          "traveller_id": 2,
          "location_id": 4
        }
      }
    ]
  }
  ```

  * üîë When we perform a GET request to `/api/locations/:id` (pick an `id`), we get back data about a location and what travellers have planned trips there.

  * üîë This data is spread across three tables, where travellers can visit many locations and locations can have many travellers through trips. A trip can only be created if there is a traveller and a location that already exists.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Would this be considered a one-to-one association, a one-to-many association, or is it a different type of relationship?

  * üôã It's a different type of relationship known as "many-to-many", where data in either table isn't necessarily owned by an entity but rather shared. An example of this is "A blog post can have many tags and tags can belong to many blog posts".

* Answer any questions before allowing students to start the mini project.

### 14. Student Do: Mini Project (60 min)

* Direct students to the activity instructions found in `28-Stu_Mini-Project`.

* Break your students into groups that will work together on this activity.

  ```md
  # Unit 13 Mini Project: Travel Planner

  In this mini project, you will work with a group to build an API using Node, Express, MySQL, and Sequelize and deploy it to Heroku.

  ## User Stories

  * As a traveller, I want to be able to create an account.

  * As a traveller, I want to be able to create a new trip for myself using a location from a list.

  * As a traveller, I want to be able to create and view location data.

  * As a traveller, I want to be able to view all of the trips I'm taking along with their locations.

  ### Acceptance Criteria

  * It's done when the GET route `/api/travellers` returns all traveller data without associated trips in Insomnia Core.

  * It's done when the POST route `/api/travellers` successfully creates traveller data and returns a successful response in Insomnia Core.

  * It's done when the GET route `/api/travellers/:id` returns a single traveller's data with their associated trips and a list of locations in Insomnia Core. 

  * It's done when the DELETE route `/api/travellers/:id` successfully removes a traveller, any trips associated with it, and returns a successful response in Insomnia Core.

  * It's done when the GET route `/api/locations` returns all location data in Insomnia Core.

  * It's done when the POST route `/api/locations` successfully creates location data and returns a successful response in Insomnia Core.

  * It's done when the GET route `/api/locations/:id` returns a single location's data with its associated trips in Insomnia Core. 

  * It's done when the DELETE route `/api/locations/:id` successfully removes a location, any trips associated with it, and returns a successful response in Insomnia Core.

  * It's done when the POST route `/api/trips` successfully creates trip data between associated travellers and locations.

  * It's done when the DELETE route `/api/trips/:id` successfully removes a trip and returns a successful response in Insomnia Core.

  * It's done when the API is successfully deployed to Heroku with a MySQL database.

  ## Specifications 

  * Database models should have these fields and associations:

    * `Traveller`
      * `id`: primary key
      * `name`
      * `email`

    * `Location`
      * `id`: primary key
      * `name`

    * `Trips`
      * `id`: primary key
      * `trip_budget` 
      * `traveller_amount`
      * `traveller_id`: foreign key that references `Traveller.id`
      * `location_id`: foreign key that references `Location.id`

    * Travellers have many Trips and Trips belong to a Traveller (One-To-Many association)

      * If a Traveller is deleted, all associated Trips are also deleted.

    * Locations have many Trips and Trips belong to a Location (One-To-Many association)

      * If a Location is deleted, all associated Trips are also deleted.

    * Travellers have many Locations and Locations have many Travellers through Trips (Many-To-Many association)

  ## üìù Notes

  Refer to the documentation: 

    * [Sequelize docs on One-To-Many relationships](https://sequelize.org/master/manual/assocs.html#one-to-many-relationships)

    * [Sequelize docs on Many-To-Many relationships](https://sequelize.org/master/manual/assocs.html#many-to-many-relationships)

    * [@TODO: Link to soon to exist Heroku JawsDB deploy guide]()

  Use this sample data as the request body POST `/api/trips` route:

      ```json
      {
        "trip_budget": 2000.50,
        "traveller_amount": 6,
        "traveller_id": 1,
        "location_id": 2
      }
      ```

  ---

  ## üí° Hints

  * What model association option can we set to automatically deleted associated data? 

  * How can we use the data in `Develop/seeds` to provide starter data for Locations and Travellers and not have to create it ourselves? 

  * If we're deploying this to Heroku, can we work on this from within the class repository or should we make a new GitHub repo?

  ## üèÜ Bonus

  If you have fully completed the above tasks, here is something you and your group can work through as an added challenge to further your knowledge:

    * Add validations to all of the model data.

    * Create a password hashing and login system for travellers.

  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students that need extra help while circulating through room.

### 15. Instructor Review: Mini Project  (10 min)  

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with this mini-project? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points below to review the following key (üîë) points:

  * ‚úîÔ∏è Through table (Trip) holds two foreign keys

  * ‚úîÔ∏è Use of `.belongsToMany()` and the `through` option

  * ‚úîÔ∏è Using `include` with a through table

  * ‚úîÔ∏è The JawsDB environment variable for production

* Open `28-Stu_Mini-Project/Solved` in your IDE and explain the following: 

  * üîë In the `models` folder we create a `Trip` model to be our joining, or "through" (in Sequelize terms), table between locations and travellers, so we create foreign key columns for both:

    ```js
    traveller_id: {
      type: DataTypes.INTEGER,
      references: {
        model: 'traveller',
        key: 'id'
      }
    },
    location_id: {
      type: DataTypes.INTEGER,
      references: {
        model: 'location',
        key: 'id'
      }
    }
    ```

  * üîë In `models/index.js`, we associate locations and travellers to one another through trips:

  ```js
  Traveller.belongsToMany(Location, {
    through: Trip,
    // Define an alias for when data is retrieved
    as: 'planned_trips',
    foreignKey: 'traveller_id'
  });

  Location.belongsToMany(Traveller, {
    through: Trip,
    // Define an alias for when data is retrieved
    as: 'location_travellers',
    foreignKey: 'location_id'
  });
  ``` 

  * üîë In our GET routes, we use `include` with the `through` option to perform a many-to-many JOIN:

  ```js
  // From`travellerRoutes.js`
  const travellerData = await Traveller.findByPk(req.params.id, {
    // JOIN with locations, using the Trip through table
    include: [{ model: Location, through: Trip, as: 'planned_trips' }]
  });
  ```

  * We don't use the `include` option in our routes that retrieve all data because typically we wouldn't need that data until we're viewing a single item's detailed data.

  * üîë In `config/connection.js`, we use `process.env.JAWSDB_URL` as a placeholder value that will be used in production by Heroku:

  ```js
  if (process.env.JAWSDB_URL) {
    sequelize = new Sequelize(process.env.JAWSDB_URL);
  } else {
    sequelize = new Sequelize(
      process.env.DB_NAME,
      process.env.DB_USER,
      process.env.DB_PASSWORD,
      {
        host: 'localhost',
        dialect: 'mysql',
        port: 3306
      }
    );
  }
  ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è With this many-to-many relationship, can multiple travellers create a trip to the same location?

  * üôã Yes! The idea of many-to-many relationships is that that there can be multiple connections to a single set of data. The "through" table serves as a means to store those pairings and avoid any duplicate data being formed.

  * ‚òùÔ∏è Can we use our local machine's MySQL database instead of the one through Heroku?

  * üôã Yes, but that means we'd have to leave our machines on all the time, so we shouldn't! 

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Sequelize docs on many-to-many relationships](https://sequelize.org/master/manual/assocs.html#many-to-many-relationships), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 16. Instructor Demo: Introduce Homework (5 min)

* Navigate to `02-Homework/Main` and run `npm install` from the command line. Be sure to change the `.env.EXAMPLE` file into your own `.env` file with your credentials. To speed things up, run `node seeds/seed.js` as well to seed the database tables.

* Run `npm start` from the command line and use Insomnia Core to demonstrate the following: 

  * We're going to build an e-commerce application back end that works with products, categories, and tags.

  * When we perform a GET request to `/api/products`, we get all products and their associated categories and tags.

* Open `02-Homework/Develop` in your IDE and explain the following:

  * This application's structure is already in place, we just need to create the models and finish the routes.

  * Use the comments in the files to help provide context as to what's needed.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What are we learning?

  * üôã How a basic e-commerce database can be structured and used.

  * ‚òùÔ∏è How does this project build off or extend previously learned material?

  * üôã We will use Sequelize to build one-to-many and many-to-many relationships and perform CRUD actions on our database using RESTful API endpoints.

  * ‚òùÔ∏è How does this project relate to your career goals?

  * üôã It will deepen our knowledge in back end technologies using a common situation in development where we need to establish relationships between data.

* Ask TAs to direct students to the Homework Requirements found in `02-Homework/README.md`.

* Answer any questions before ending the class.

### 17. END (0 min)

How did today‚Äôs lesson go? Your feedback is important. Please take 5 minutes to complete [this anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
¬© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand.  Confidential and Proprietary.  All Rights Reserved.