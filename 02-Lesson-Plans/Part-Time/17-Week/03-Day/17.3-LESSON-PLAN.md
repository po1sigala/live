## 17.3 Lesson Plan - IndexedDB (10:00 AM) <!--links--> &nbsp; [‚¨ÖÔ∏è]() &nbsp; [‚û°Ô∏è]()

## Overview

This lesson introduces IndexedDB.

## Instructor Notes

* Complete activities `18-27`.

* Ensure that...

* If students continually question why they are learning IndexedDB...

## Learning Objectives

* Explain the pros and cons of storing client side data with cookies and IndexedDB.

* Request an IndexedDB instance.

* Create an object store and add data with the `add` method.

* Search for an item by keyPath with the `get` method.

* Create and search by index with the `getAll` method.

* Utilize Cursors to iterate through and update object store data.

* Complete the mini project.

## Slides

[]()

## Time Tracker

[]()

- - -

### 1. Instructor Do: Intro To IndexedDB (10 mins)

* Welcome students to class. Explain that today will be an introduction to a client side storage database called IndexedDB.

* Ask the class the following question(s): 

  * ‚òùÔ∏è How do we store data client-side? 

  * üôã Cookies, local storage, session storage.

  * ‚òùÔ∏è What is a cookie?

  * üôã A cookie is a small piece of data sent from a website and stored on the user's computer by the user's web browser.

  * ‚òùÔ∏è What are some of the issues we encounter storing data client-side? 

  * üôã String value pairs, objects must be stringified and strings must be converted to JSON. Size limits.

  * ‚òùÔ∏è What is IndexedDB and why should we use it?

  * üôã From the name, IndexedDB, we can guess that it is a database (DB) accessed by Index in the client! Like MongoDB, it is object-oriented, meaning we can store anything in it! Large amounts of data, offline experience and improved performance.

### 2. Instructor Do: Creating an IndexedDB Connection (5 mins)

* Use the prompts and talking points below to demonstrate the following key point(s):

  * ‚úî We access `indexedDB` via the `window` object.

  * ‚úî We create a new IndexedDB connection using the `open` method and pass it a name for the DB and a version number.

  * ‚úî Our request returns a result that we can then manipulate.

  ```js
  const request = indexedDB.open("firstDatabase", 1);
  
  request.onsuccess = event => {
    console.log(request.result);
  };
  ```

* Open [18-Ins_Opening_IndexedDB](../../../../01-Class-Content/17-nosql/01-Activities/18-Ins_Opening_IndexedDB/index.html) in your browser and open your Chrome Developer tools and navigate to `Application` then `IndexedDB`.

@TODO Screenshot of DB here.

* We navigate into the `18-Ins_Opening_IndexedDB` directory and open `index.html` from the command line. Inside the `IndexedDB` tab we see that we now have a new database connection called `firstDatabase`.

* Ask the class the following question(s): 

  * ‚òùÔ∏è How many arguments does the `open` method take and what are they for?

  * üôã Two and the first one is the DB name, the second is the version number.

### 3. Student Do: Creating an IndexedDB Connection (10 mins)

* Direct students to the activity instructions found in [19-Stu_Opening_IndexedDB](../../../../01-Class-Content/17-nosql/01-Activities/19-Stu_Opening_IndexedDB/Unsolved):

```md
# Requesting an IndexedDB Database

In this activity, you will create a request for an indexedDB database and console.log the name of the db to the screen. 

## Instructions

* Write code to request an IndexedDB database instance.
* On success, log the name of the database to your console.

## üí° Hint(s)

* Use the [open](https://developer.mozilla.org/en-US/docs/Web/API/IDBFactory/open) docs to learn about the arguments it takes.
* You can `console.log` the `request` to so what attributes are available to you.

## üèÜ Bonus

* TODO
```

### 4. Instructor Do: Review Creating an IndexedDB Connection (5 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.


### 5. Instructor Do: Creating Object Stores (5 mins)

* Use the prompts and talking points below to demonstrate the following key point(s):

  * ‚úî Object stores can be thought of as a "table" where we hold data.

  * ‚úî Object stores can hold any data type.

  * ‚úî Object stores are schema-less, unlike SQL databases.

  * ‚úî We create our object stores in the `onupgradeneeded` method.

  * ‚úî If the database doesn't already exist, it is created by the `open` operation, then an `onupgradeneeded` event is triggered.

  ```js
  request.onupgradeneeded = ({ target }) => {
    const db = target.result;
    const objectStore = db.createObjectStore("toDoList");
  };
  ```

* Open [20-Ins_Creating_Object_Stores](../../../../01-Class-Content/17-nosql/01-Activities/20-Ins_Creating_Object_Stores/index.html) in your browser and open your Chrome Developer tools and navigate to `Application` then `IndexedDB`.

@TODO Screenshot of DB here.

* We navigate into the `20-Ins_Creating_Object_Stores` directory and open `index.html` from the command line. Inside the `IndexedDB` tab we see that we now have a new database connection called `toDOList`.

* When we click on the database tab, we can see that we now have an empty object store called `toDoList`.

* Ask the class the following question(s): 

  * ‚òùÔ∏è What is an object store?

  * üôã It's similar to an SQL table and where we store data in IndexedDB.

### 6. Student Do: Create an Object Store (15 mins)

* Direct students to the activity instructions found in [21-Stu_Creating_Object_Stores](../../../../01-Class-Content/17-nosql/01-Activities/21-Stu_Creating_Object_Stores/Unsolved):

```md
# Creating an Object Store

In this activity, you will create an object store for your IndexedDB database.

## Instructions

* Write code to request an IndexedDB database instance.
* On success, log the result to your console.
* Inside the `onupgradeneeded` method, create an object store for you database called `toDoList`.

## üí° Hint(s)

* Use the [open](https://developer.mozilla.org/en-US/docs/Web/API/IDBFactory/open) docs to learn about the arguments it takes.
* You can `console.log` the `request` to so what attributes are available to you.

## üèÜ Bonus

* Use the [keyPath](https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/keyPath) docs to research what a `keyPath` is and how to add it to your `objectStore`.
```

### 7. Instructor Do: Review Create an Object Store (5 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.

### 8. Instructor Do: Defining Object Store Data with Indexes (5 mins)

* Use the prompts and talking points below to demonstrate the following key point(s):

  * ‚úî Object stores are schema-less and have no native search capability.

  * ‚úî We create indexes on object store "columns" so we can query.

  * ‚úî We use the `createIndex(indexName, keyPath)` function to create indexes, it takes two arguments.

  * ‚úî The `indexName` is what you use to access the index when querying.

  * ‚úî The `keyPath` is the actual name of the "column."

  ```js
  request.onupgradeneeded = ({ target }) => {
    const db = target.result;
    const objectStore = db.createObjectStore("toDoList");
    objectStore.createIndex("timestamp", "timestamp");
  };
  ```

* Open [22-Ins_Creating_Indexes](../../../../01-Class-Content/17-nosql/01-Activities/22-Ins_Creating_Indexes/index.html) in your browser and open your Chrome Developer tools and navigate to `Application` then `IndexedDB`.

@TODO Screenshot of DB here.

* We navigate into the `22-Ins_Creating_Indexes` directory and open `index.html` from the command line. Inside the `IndexedDB` tab we see that we now have a new database connection called `toDOList`.

* When we click on the database tab, we can see that we now have an empty object store called `toDoList`. Inside our `toDoList` object store we now have a `timestamp` index that we can use to query on.

* Ask the class the following question(s): 

  * ‚òùÔ∏è What are indexes for?

  * üôã They are used to query on object store "columns" since they have no way to natively search.

### 9. Student Do: Defining Object Store Data with Indexes (10 mins)

* Direct students to the activity instructions found in [23-Stu_Creating_Indexes](../../../../01-Class-Content/17-nosql/01-Activities/23-Stu_Creating_Indexes/Unsolved):

```md
# Creating Indexes

In this activity, you will create an index on your object store that can be used to query data.

## Instructions

* Write code to request an IndexedDB database instance.
* On success, log the result to your console.
* Inside the `onupgradeneeded` method, create an object store for you database called `toDoList`. Next, create three indexes for your ToDoList called `icebox`, `inprogress` and `complete`.

## üí° Hint(s)

* Use the [createIndex](https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/createIndex) docs if you are stuck.

## üèÜ Bonus

* TODO
```

### 10. Instructor Do: Review Defining Object Store Data with Indexes (5 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.

### 11. Instructor Do: Adding and Getting Object Store Data (5 mins)
  
* Use the prompts and talking points below to demonstrate the following key point(s):

  * ‚úî We add data to our object stores with the `add` method.

  * ‚úî We can add a `keyPath` argument when we create our object stores that let's us query.

  * ‚úî We use `get` object store method to queryby `keyPath`.

  * ‚úî We use the `getAll` object store method to query by indexes.

  ```js
  request.onupgradeneeded = event => {
    const db = event.target.result;
    const toDoListStore = db.createObjectStore("toDoList", {keyPath: "listID"}); // can now query by listID
    toDoListStore.createIndex("statusIndex", "status"); // can now query by statusIndex
  }

  toDoListStore.add({ listID: "1", status: "complete" }); // adding data

  const getRequest = toDoListStore.get("1"); // querying by keyPath
  const getRequestIdx = statusIndex.getAll("complete"); // querying by index

  ```

* Open [22-Ins_Creating_Indexes](../../../../01-Class-Content/17-nosql/01-Activities/24-Ins_Adding_Getting_Data/index.html) in your browser and open your Chrome Developer tools and navigate to your console.

@TODO Screenshot of DB here.

* We navigate into the `24-Ins_Adding_Getting_Data` directory and open `index.html` from the command line. After opening our Chrome Developer tools and moving into our console we can see our data is being returned successfully.

* Ask the class the following question(s): 

  * ‚òùÔ∏è What is a keyPath?

  * üôã A keyPath gives us a way to query our column's data.

  * ‚òùÔ∏è What is an index?

  * üôã An index is another way to more efficiently and specifically query for data.

### 12. Student Do: Adding and Getting Object Store Data (15 mins)

* Direct students to the activity instructions found in [25-Stu_Adding_Getting_Data](../../../../01-Class-Content/17-nosql/01-Activities/25-Stu_Adding_Getting_Data/Unsolved):

```md
# Adding and Getting Data

In this activity, you will create add and retrieve data from an objectStore using a keyPath and index.

## Instructions

* In the `onupgradeneeded` method: 
  * Create a `toDoList` object store with a `listID` keyPath that can be used to query on.
  * Create an index for a "column" you'd like to query on. ie: due-date

* In the `onsuccess` method:
  * Create variables for a new `transaction` on your database, `objectStore` and the `index` you created.
  * Add four new items to your object store with the `add` method.
  * Using the `get` method, return an item from your object store.
  * Using the `getAll` method, query by index and return all items.


## üí° Hint(s)

* Use the following docs if you are stuck.
  * [add](https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/add) 
  * [get](https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/get)
  * [getAll](https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore/getAll)

## üèÜ Bonus

* TODO
```

### 13. Instructor Do: Review Adding and Getting Object Store Data (5 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.

### 14. Instructor Do: Updating Data With Cursors (5 mins)

* Use the prompts and talking points below to demonstrate the following key point(s):

  * ‚úî We open a `Cursor` request on our object store with `openCursor`.

  * ‚úî On success we have a result that we can iterate through.

  * ‚úî We use the `continue` key word to move through the records.

  ```js
  const getCursorRequest = toDoListStore.openCursor();
    getCursorRequest.onsuccess = e => {
      const cursor = e.target.result;
      if (cursor) {
        console.log(cursor.value);
        cursor.continue();
      } else {
        console.log("No documents left!");
      }
    };
  ```

* Open [26-Ins_Updating_Data_With_Cursors](../../../../01-Class-Content/17-nosql/01-Activities/26-Ins_Updating_Data_With_Cursors/index.html) in your browser and open your Chrome Developer tools and navigate to your console.

@TODO Screenshot of DB here.

* We navigate into the `26-Ins_Updating_Data_With_Cursors` directory and open `index.html` from the command line. Next open your Chrome Developer tools and navigate into the console to see the data being returned.

* Ask the class the following question(s): 

  * ‚òùÔ∏è What is a Cursor used for?

  * üôã It gives us a way to iterate through our object stores files.

### 15. Student Do: Updating Data With Cursors (15 mins)

* Direct students to the activity instructions found in [27-Stu_Updating_Data_With_Cursors](../../../../01-Class-Content/17-nosql/01-Activities/27-Stu_Updating_Data_With_Cursors/Unsolved):

```md
# Updating Data With Cursors

In this activity, you will be updating records in your object store using a Cursor.

## Instructions

* Inside ` getCursorRequest.onsuccess`
  * Set the `result` to a variable named `cursor`.
  * Check the status of each cursor's value and if it's equal to "in-progress", set the status to "complete".

## üí° Hint(s)

* Use the following [cursor](https://developer.mozilla.org/en-US/docs/Web/API/IDBCursor) methods.
  * `cursor.value`
  * `cursor.update`
  * `cursor.continue`

## üèÜ Bonus

* TODO
```

### 16. Instructor Do: Review Updating Data With Cursors (5 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.

### 17. BREAK (40 mins)

### 18. Intro Mini Project (5 mins)

* Overview of mini project.

### 19. Student Do: Mini Project (60 mins)

* Complete mini project.

### 20. Instructor Do: Review Mini Project (10 mins)

* Use the prompts and talking points below to review the following key point(s):

  * ‚úî Points here

  * ‚úî Points here

* Open [](@TODO) in your IDE and explain the following point(s):

  * We simply ...

  ```js
  snippet here
  ```

  * üîë Make a key connection here...

* Ask the class the following question(s):

  * ‚òùÔ∏è Question 

  * üôã Answer

* Answer any questions before proceeding to the next demo.

### 21. END (0 mins)
