# XX.1 Part-Time Lesson Plan: Model-View-Controller (MVC)

## Overview 

In today's class, students will learn about the MVC framework and the separation of concerns principle. They will practice using template engines on the front end by implementing Handlebars.js basics, like expressions and built-in helpers. After using hardcoded data, they will revisit how Models deal with data-logic on the back end by using Sequelize and MYSQL. They will also learn about how the Controller acts as an interface between the View and the Model by processing requests for data, using routes to manipulate the database, and passing data to the View. 

## Instructor Notes

* In this lesson, students will complete activities `01-Ins_MVC-Handlebars` through `10-Stu_Handlebars-FE-Logic`.

* This unit introduces students to the template engine, Handlebars.js. The intention is not so much for students to learn Handlebars.js because it will be useful in their career, but instead, it is an introduction to template engines, preparation for React.js, and a way to emphasize the MVC framework.

* You will be using MySQL for a few of today's activities. Be sure to have your MySQL server up and running. Go ahead and create the dish_db database ahead of time, or demonstrate it live in class.

* The first activities, 01-Ins_MVC-Handlebars-Intro - 06-Stu_Built-In-Helpers, include hardcoded data in Handlebars.js templates, index.html, or in the dish-routes.js file. Every subsequent activity (starting with 07-Ins_Data-Serialization) includes a seeds folder. Run `node seeds/index.js` before class, or demonstrate seeding the database live in class. 

* Starting with 07-Ins_Data-Serialization, each activity requires a .env file. Make sure you create one or rename the existing .env.EXAMPLE file before demonstrating each activity.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Explain and implement MVC modularization in a full-stack web application

* Render dynamic HTML using the Handlebars.js template engine

* Dynamically pass data to other helpers or components using built-in helpers

* Use data serialization to simplify objects in order to work with necessary properties only

* Explain separation of concerns and its benefits

## Slide Deck

* @TODO [Unit XX Slide Deck]()

## Time Tracker
@TODO ADD ACTIVITY TITLES for Instructor Demo, Student Do, and Instructor Review
| Start  | #   | Activity Name                       | Duration |
|---     |---  |---                                  |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity      | 0:10     |
| 6:40PM | 2   | Instructor Demo: MVC Handlebars Intro                   | 0:05     |
| 6:45PM | 3   | Student Do: MVC Handlebars Intro                        | 0:15     |
| 7:00PM | 4   | Instructor Review: MVC Handlebars Intro                 | 0:10     |
| 7:10PM | 5   | Instructor Demo: Handlebars Expressions                   | 0:05     |
| 7:15PM | 6   | Student Do: Handlebars Expressions                        | 0:15     |
| 7:30PM | 7   | Instructor Review: Handlebars Expressions                 | 0:10     |
| 7:40PM | 8   | Instructor Demo: Built-In Helpers                   | 0:05     |
| 7:45PM | 9   | Student Do: Built-In Helpers                        | 0:15     |
| 8:00PM | 10  | BREAK                               | 0:15     |
| 8:15PM | 11  | Instructor Review: Built-In Helpers                 | 0:10     |
| 8:25PM | 12  | Instructor Demo: Data Serialization                   | 0:05     |
| 8:30PM | 13  | Student Do: Data Serialization                         | 0:15     |
| 8:45PM | 14  | Instructor Review: Data Serialization                  | 0:10     |
| 8:55PM | 15  | Instructor Demo: Handlebars FE Logic                   | 0:05     |
| 9:00PM | 16  | Student Do: andlebars FE Logic                          | 0:15     |
| 9:15PM | 17  | Instructor Review: andlebars FE Logic                   | 0:15     |
| 9:30PM | 18  | END                                 | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Open the [slide deck]() and follow these prompts on their corresponding slides:

  * **@TODO TITLE OF SLIDE**: @TODO ADD TALKING POINTS

  * **@TODO TITLE OF SLIDE**: @TODO ELABORATE ON SLIDE CONTENT
  
  * **@TODO TITLE OF SLIDE**: @TODO TRANSITION INTO MINI-PROJECT DEMO

* Navigate to `@TODO/folder/file` in your command line and demonstrate the following:

  * @TODO { WHAT ARE WE GOING TO BE BUILD? }

  * @TODO { ISN'T THIS NEAT! A SOPHISTICATED OR MODERN APPLICATION OF A KEY TOPIC. }

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What are we learning?

  * 🙋 MVC framework, using template engines like Handlebars.js, and data serialization.

  * ☝️ How does this project build off or extend previously learned material?

  * 🙋 We will use Sequelize, MYSQL, and object-oriented programming.

  * ☝️ How does this project relate to your career goals?

  * 🙋 We will learn how to use template engines and explain the MVC framework, a popular arichitectural pattern that you will encounter as a developer. This work will also prepare us for learning React.js.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: MVC Handlebars.js Intro (5 min) 

* Run `npm install` and `npm start` from the command line. 

* Open `01-Ins_MVC-Handlebars-Intro/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * 🔑 The MVC framework includes Models, Views, and Controllers. The Controller is the interface between the View and the Model. It processes requests, uses the Model to manipulate data, and sends data to the View to render.

  * 🔑 `dish-routes.js` currently includes a GET route. Right now, the route is telling the view to render `index.html` when the user visits `/`.

 ```js
  router.get('/', async (req, res) => {
    res.sendFile(path.join(__dirname, '../views/index.html'));
    });
 ```

* Open `01-Ins_MVC-Handlebars-Intro/views/index.html` in your IDE and demonstrate the following:

  * 🔑  The view is responsible for UI/UX concerns, or what a user can 'view' in the browser.

  * 🔑 Right now, the dishes are hardcoded in `views/index.html`. Today, you will learn how to render data dynamically using Handlebars.js, Sequelize, and MYSQL.

* Visit `http://localhost:3001/` in your browser and demonstrate the following: 

  * 🔑 The view in this application shows a menu of dishes that guests plan to bring to a potluck party.

* Open `01-Ins_MVC-Handlebars-Intro/models/Dish.js` in your IDE and demonstrate the following: 

  * 🔑 `Dish.js` is a Model. Models are in charge of data-related logic, like creating a new dish object.

  * 🔑 We learned how to set up models in Unit 13. Remember, the data is hardcoded in `index.js`, so `Dish.js` is set up, but isn't actually doing anything at the moment.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What does MVC stand for?

  * 🙋 Model, View, Controller.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

### 3. Student Do: MVC Handlebars Intro (15 min) 

* Direct students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 📐 Add Comments to Implementation of MVC and Handlebars.js

Work with a partner to add comments describing the functionality of the code found in [Dish.js](./Unsolved/models/Dish.js), [main.handlebars](./Unsolved/views/layouts/main.handlebars), and [dish-routes.js](./Unsolved/controllers/dish-routes.js).

## 📝 Notes

Refer to the documentation: 

* [Express Handlebars.js](https://www.npmjs.com/package/express-handlebars)

* [MDN Docs: MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

---

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are some other template engines? 

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: MVC Handlebars Intro (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with MVC and Handlebars.js? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ Model

  * ✔️ View

  * ✔️ Controller

  * ✔️ `main.handlebars`

  * ✔️ `all.handlebars`

* Open `02-Stu_MVC-Handlebars-Intro/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * 🔑 `dish-routes.js` is the Controller.

  * `dish-routes.js` is responsible for interfacing between the View and the Model. 

  * 🔑 Now that we're using Handlebars.js, the GET route directs the View to render `all.handlebars`.

  ```js
  router.get('/', async (req, res) => {
    res.render('all');
  });
  ``` 

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/layouts/main.handlebars` in your IDE and explain the following: 

  * 🔑 `main.handlebars` is part of the View.
  
  * The file looks like standard HTML, except for `{{{ body}}}`, which is a Handlebars.js placeholder. Whatever the Controller directs the View to render will be plugged in here.

  ```html
      <main class="container container-fluid mt-5">
        {{{ body }}}
      </main>
  ``` 

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/all.handlebars` in your IDE and explain the following:

  * 🔑 `all.handlebars` is also part of the View. Currently, we are rendering hardcoded data.

* Open `02-Stu_MVC-Handlebars-Intro/Solved/models/Dish.js` in your IDE and explain the following:

  * 🔑 `Dish.js` is a Model. It isn't actually doing anything at the moment, because we are rendering hardcoded data.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is `{{{ body }}}`?

  * 🙋 It is a Handlebars.js placeholder.

  * ☝️ How does the View know what to plug into `{{{ body }}}`?

  * 🙋 The routes in the Controller will indicate which template to render.

  * ☝️ We are currently hardcoding data in the View, but where would the Controller typically get data to pass to the View?

  * 🙋 The Model is in charge of the data-logic. The Controller would retrieve and manipulate data using the Model.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Handlebars.js Docs](https://handlebarsjs.com/guide/#what-is-handlebars), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Handlebars Expressions (5 min) 

* Open `03-Ins_Handlebars-Expressions/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * 🔑  In the previous activity, we hardcoded data in the View. Now, we are beginning to pass static data (an array of objects called `dish`) to the View in the Controller.

  * 🔑  Each object includes `dish_name` and `description` keys and value pairs.

  ```js
    {
      dish_name: 'French Bread with Brie Cheese',
      description: 'French baguette with warm brie',
    },
  ```

  * 🔑  The Controller includes a GET route for one dish, that passes the static data for one dish into a Handlebars.js template.

    ```js
     router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
     });
    ```
* Navigate to `03-Ins_Handlebars-Expressions/views/dish.handlebars` in your IDE and demonstrate the following:

  * 🔑  The template for one dish uses a Handlebars.js expression to render the name of a dish. Inside of the double curly brackets, we include the `dish_name` key so that it's value will be rendered.

  ```html
  <div class="dish-card">
  <div class="dish-card-header">
    {{dish_name}}
  </div>
</div>
  ```

* Run `npm install` and `npm start` from the command line and navigate to `http://local:host3001/dish/1`: 

  * 🔑  Now, when we view the page for one dish, we see the name of that dish. 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 We would insert the key of the value we wish to render into a Handlebars.js expression in the correct template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

### 6. Student Do: Handlebars Expressions (15 min) 

* Direct students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 🏗️ Implement a GET Route for Food Item Descriptions 

Work with a partner to implement the following user story:

* As a party guest, I want to see description of one food item that will be at the potluck when I visit `http://localhost:3001/dish/:num`.

## Acceptance Criteria

* It's done when the route called `/dish/:num`  is properly configured to retrieve and return a food item and its description.

* It's done when the view displays a description for the food item, where the list number matches the the route `/dish/:num`.

## Assets

The following image demonstrates the web application's appearance and functionality:

![The view displays the name and description for one dish](images/dish-description.png)

---

## 💡 Hints

* How can you make sure that the correct Handlebars.js template is rendered?

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* How can we render an array of objects using Handlebars.js?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Handlebars Expressions (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with Handlebars.js expressions? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ GET route for `/dish/:num`

  * ✔️ `{{ description }}`

* Open `04-Stu_Handlebars-Expressions/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * 🔑 In order to render a description for a dish, we first need to build a route for `/dish/:num`.
  
  * We render the `dish` template by passing it in as an argument. Then, we use params to select the correct dish to render in the template, based on the id of the dish. Now, we have access to a dish description through a dish object.

    ```js
    router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
    });
    ```

* Open `04-Stu_Handlebars-Expressions/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * 🔑 We create a Handlebars.js expression, `{{ description }}`, passing in the `description` key name.

    ```html
      <div class="card-body">
        <p>
         Description:
         {{description}}
      </p>
     </div>
    ``` 
* Run `npm install` and `npm start` from the command line and navigate to `http://local:host3001/dish/1`: 

  * Now, when we view the page for one dish, we see the name of that dish and the dish description. 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is `{{ description }}`?

  * 🙋 A Handlebars.js expression.

  * ☝️ How do we use a Handlebars.js expression to render data?

  * 🙋 We plug the key name of the value we wish to render into the curly brackets.

  * ☝️ How does this relate to MVC?

  * 🙋 The Controller is responsible for passing data to the View via a route and the View is responsible for rendering that data in the browser.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Handlebars.js Expressions](https://handlebarsjs.com/guide/expressions.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Built-In Helpers (5 min) 

* Open `05-Ins_Built-In-Helpers/controllers/dish-routes.js` in your IDE and explain the following: 

  * 🔑 Now that `dishList` is hardcoded into `dish-routes.js`, we pass it in as an argument to `render()`.

    ```js
    router.get('/', async (req, res) => {
      res.render('all', dishList);
    });
    ``` 
  * 🔑  We can use Handlebars.js built-in helpers to conditionally render blocks of code, iterate over lists, etc. Since the Controller is passing `dishList` to the View through `render()`, we can use a built-in helper to iterate over it in the template.

* Open `05-Ins_Built-In-Helpers/views/all.handlebars` in your browser and demonstrate the following:

  * 🔑  In `all.handlebars` we are using `#each` to iterate over and render a menu for our dish data.

  * 🔑  `dishes` represents the `dishList` array that the Controller passed to the template. `dish` represents one dish object in that array.

  * 🔑  After `{{#each dishes as |dish|}}`, is the clock of code to be rendered for each dish object. We could also use the syntax, `{{#each dish}}`, and then use `this.id` and `this.dish_name` in the block of code.
  
  * 🔑  Then we close the `#each` helper with `{{/each}}`.

    ```html
      {{#each dishes as |dish|}}
        <div class="dish col-md-5">
          <p>
            {{dish.id}}.
            {{dish.dish_name}}
          </p>
        </div>
        <div class="col-md-7">
          <p>
            <!-- guest_name will eventually go here -->
          </p>
        </div>
      {{/each}}
    ```

* Run `npm install` and `npm start` from the command line then navigate to `http://local:host3001/` in your browser.

  * 🔑  Here, we see that each dish name is successfully rendered on the menu card.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ When should we use built-in helpers?

  * 🙋 If we need to iterate over data or conditionally render blocks of code.

  * ☝️ How would we include built-in helpers?

  * 🙋 Built-in helpers can be included in Handlebars.js templates.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

### 9. Student Do: { ACTIVITY NAME } (15 min) 

* Direct students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
    # 📖 Conditionally Render Food Allergens

    Work with a partner to implement the following user story:

   * As a party guest, I want to know if a food item contains nuts.

   ## Acceptance Criteria

   * It's done when the view displays the message "Contains Nuts" under the food items that contain nuts.

   ## 📝 Notes

   Refer to the documentation: 

  [Handlebars.js: Built-in Helpers](https://handlebarsjs.com/guide/builtin-helpers.html#if)

  ## 💡 Hints

   * Which built-in helper conditionally renders a block?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

    * Which built-in helper method is the inverse of #if? What is a use-case for rendering a block if an expression is a falsy value? 

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Built-In Helpers (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with built-in helpers? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `#if`

  * ✔️ @TODO { THAT }

  * ✔️ @TODO { THE OTHER }

* Open `06_Stu-Built-in-Helpers/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * When we look at our dish data, we see that it includes a boolean for `has_nuts` that is set to true for the dishes that contain nuts.

  ```js
       {
        id: 2,
        dish_name: 'Cheese Plate with Spanish Chorizo',
        description: 'Manchego, Iberico, Cabrales, fig jam, grapes, pecans, and Spanich Chorizo',
        has_nuts: true,
      },
  ```

* Open `06-Stu_Built-In-Helpers/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * 🔑 We want to make sure that the message, "Contains Nuts", is only rendered for dish objects that actually contain nuts. In order to do this, we need to conditionally render a block of code with the `#if` built-in helper.

  * 🔑  We provide `has_nuts` as the condition when we open the `#if` helper. Then we include the block of code that we wish to conditionally render followed. Finally, we close `#if`. 

    ```html
        {{#if has_nuts}}
      <p class="has-nuts">
        Contains Nuts
      </p>
    {{/if}}
    ```
* Run `npm install` and `npm start` from the command line then navigate to `http://local:host3001/dish/2` in your browser.

  * Here, we see that the message, "Contains Nuts", shows up when a dish contains nuts.

* Navigate to `http://local:host3001/dish/1` in your browser.

  * Here, we see that the message is not being rendered, because the dish does not contain nuts.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ When is it a good idea to use a Handlebars.js built-in helper?

  * 🙋 When we need to iterate over a list, conditionally render a block of code, etc.

  * ☝️ How does this relate to MVC?

  * 🙋 This is a UI/UX concern. Built-in helpers empower the View to be in charge of how and when data is displayed. 

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Handlebars.js Built-In Helpers](https://handlebarsjs.com/guide/builtin-helpers.html#each), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Data Serialization (5 min) 

* Rename the `07-Ins_Data-Serialization/.env.EXAMPLE` file to .env and fill in your credentials.

* Run `node seeds/index.js` from the command line and demonstrate the following: 

  * 🔑  Now we are going to move on to using Sequelize and MYSQL. So far, we've focused on the Controller and the View. Now that we have a seeded database, we can look at how the Model fits into the MVC framework.

* Open `07-Ins_Data-Serialization/views/dish.handlebars` in your IDE and demonstrate to following: 

  * 🔑  Nothing has changed in the View. We are still using Handlebars.js expressions and built-in helpers to render data that is passed in.

* Open `07-Ins_Data-Serialization/controllers/dish-routes.js` in your IDE and demonstrate to following: 

  * 🔑  The Controller has changed now that the Model is set up. Now, we are using `findByPk()` to locate a dish in the database. 

  * 🔑  However, the object will be returned as a Sequelize object. This object will include extra data that can be difficult to parse through on the template side. 

  * 🔑  So, we must 'serialize' the data in the route in the Controller, before passing it to the templates in the View. 

  * 🔑  We accomplish this by attaching `.get({ plain: true })` to the returned object `dishData`, and then we pass the serialized data as `dish` through to the `'dish'` template.

   ```js
    router.get('/dish/:id', async (req, res) => {
      try {
        const dishData = await Dish.findByPk(req.params.id);
        const dish = dishData.get({ plain: true });
        res.render('dish', dish);
      } catch (err) {
        res.status(500).json(err);
      }
     });
   ```

* Run `npm install` and `npm start` from the command line then navigate to `http://local:host3001/dish/1` in your browser.

  * 🔑  Here we see that the View for one dish is rendering as expected. 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we make sure that the templates in the View are able to parse the data sent by the Controller?

  * 🙋 We serialize the data in the Controller so that we are only sending the data that we need to the View.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

### 13. Student Do: Data Serialization (15 min)

* Direct students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 🐛 Main View is not Displaying Food Items 

Work with a partner to resolve the following issue(s):

* As a party guest, I would like to view a full menu of food items that other guests will bring to the party.

## Expected Behavior

* When a party guest views the page, they see a menu of food items.

## Actual Behavior

* When a party guest views the page, no food items appear on the menu.

## Steps to Reproduce the Problem

1. Run `npm install`. 

2. Make sure that mysql is turned on and run `node seeds/index.js` to seed the database.

3. Run `npm start`.

2. Navigate to http://localhost:3001/ in your browser.

## 💡 Hints

* How can you change your route so that the View is able to display the menu of food items?

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are other options that you have to serialize data down to the properties that you need? 

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Data Serialization (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with data serialization? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `map`

  * ✔️ `.get({ plain: true })`

* Open `08-Stu_Data-Serialization/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * In order to render a full menu for party guests using a GET route, we must first query the database for all dish objects using the Sequelize method, `findAll()`.

  * 🔑  Instead of recieving one object, we recieve an array of dish objects that need to be serialized before being rendered. We use `map` to add `.get({ plain: true})` to each `dish` object.

  * Finally, the Controller sends the newly serialized array of dishes to the `'all'` template in the View.

    ```js
    router.get('/', async (req, res) => {
      const dishData = await Dish.findAll().catch((err) => { 
        res.json(err);
       }); 
      const dishes = dishData.map((dish) => dish.get({ plain: true }));
      res.render('all', { dishes });
    });
    ```

  * Run `npm install` and `npm start` from the command line then navigate to `http://local:host3001/` in your browser.

  * 🔑  Here we see that the View is rendering a full menu of dishes as expected. 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Why do we need to serialize data in the Controller?

  * 🙋 Sequelize objects include extra data that the View does not need. We serialize data in the Controller so that the the templates in the View can parse and render the data from the Model.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Express Docs](http://expressjs.com/en/5x/api.html#res.get), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: Handlebars FE Logic (5 min) 

* Rename the `09-Ins_Handlebars-FE-Logic/.env.EXAMPLE` file to .env and fill in your credentials.

 * 🔑  The MVC framework follows the separation of concerns principle. For our purposes, this means that content should be separate from presentation and that data processing should also be separate from content. This helps us write clear and maintainable code.

  * 🔑  We will explore MVC and the separation of concerns principle further in this lesson by examining a form to add a dish to our database.

* Open `09-Ins_Handlebars-FE-Logic/views/all.handlebars` in your IDE and demonstrate the following:

  * 🔑  Here, we see an RSVP form to the `'all'` template that allows guests to provide information about the dish they plan to bring to the party.

* Open `09-Ins_Handlebars-FE-Logic/public/js/add-dish.js` in your IDE and demonstrate the following:

  * 🔑  We've added an event listener to the form in `add-dish.js`.

  * 🔑  On 'Submit', the form handler will capture user input from the form fields in the View. 

  * 🔑  Notice the syntax where `has_nuts` is declared. This is a ternary operator, or another type of conditional operator. `'#has_nuts:checked'` is the condition, followed by a '?'. If it is truthy, `has-nuts` will be true, otherwise, it will be false.

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked' ? true : false);
    ```

  * 🔑  `fetch()` passes the form input to the Controller in the body of the request with the POST method.

    ```js
     const response = await fetch(`/api/dish`, {
       method: 'POST',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```
* Open `09-Ins_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following: 

  * 🔑  The POST route in the Controller accepts the input, uses the Model to create a dish object in the database and then returns the data as json to `add-dish.js` to be rendered by the View.

    ```js
     router.post('/', async (req, res) => {
       try { 
         const dishData = await Dish.create({
           dish_name: req.body.dish_name,
           description: req.body.description,
           guest_name: req.body.guest_name,
           has_nuts: req.body.has_nuts,
         });
        res.status(200).json(dishData)
        } catch (err) {
          res.status(400).json(err);
        }
      });
    ```
* Run `npm install`, `node seeds/index.js`, and `npm start` from the command line. 

* Navigate to `http://localhost:3001/` and demonstrate the following in your browser:

  * 🔑  Now, when we add information into the form and click 'Submit', we can see that our dish has been added to the menu.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How do we process user input and send it to the Controller?

  * 🙋 We can use a form handler to collect form input and send it to the Controller, where the business logic will be preformed. 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

### 16. Student Do: Handlebars FE Logic (15 min) 

* Direct students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 📐 Add Comments to the Implementation of a Form to Update a Food Item

Work with a partner to add comments describing the functionality of the code found in [dish.handlebars](./Unsolved/views/dish.handlebars) [edit-dish](./Unsolved/public/js/edit-dish.js), and [dish-routes](./Unsolved/controllers/api/dish-routes.js).

## 📝 Notes

Refer to the documentation: 

* [Handlebars.js Docs](https://handlebarsjs.com/guide/#what-is-handlebars)

* [MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

---

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are the pros and cons of using a template engine like Handlebars.js?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: Handlebars FE Logic (15 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with MVC and frontend logic? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ The View

  * ✔️ The Model

  * ✔️ The Controller

  * ✔️ Front end logic

  * ✔️ Ternary operator

* Open `10-Stu_Handlebars-FE-Logic/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * We now have an edit form in the `'dish'` template that allows users to update a dish. 

  * 🔑  As a part of the View, this form is responsible for the UI/UX logic. It is not responsible for business or data-related logic.

* Open `10-Stu_Handlebars-FE-Logic/Solved/public/js/edit-dish.js` in your IDE and explain the following: 

  * We've added an event listener to the form in `edit-dish.js`.

  * 🔑  On 'Submit', the form handler will capture user input from the form fields in the View and process the data using front end logic to pass to the Controller. 

  * 🔑  We've included a ternary operator again to indicate if the checkbox for Contains Nuts has been checked or not.

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked' ? true : false);
    ```
  * We are using the URL to access the dish's id, to ensure that we send out fetch request to the correct endpoint.

    ```js
    const id = window.location.toString().split('/')[
    window.location.toString().split('/').length - 1
     ];
    ```

  * 🔑  `fetch()` passes the edit form input to the Controller in the body of the request with the PUT method.

    ```js
     const response = await fetch(`/api/dish/${id}`, {
       method: 'PUT',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```

  * Open `10-Stu_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following: 

  * 🔑  The PUT route in the Controller accepts the input, uses the Model to edit a dish object in the database and then returns the data as json to `edit-dish.js` to be rendered by the View.

  ```js
    router.put('/:id', async (req, res) => {
     try {
       const dish = await Dish.update(
         {
          dish_name: req.body.dish_name,
          description: req.body.description,
          guest_name: req.body.guest_name,
          has_nuts: req.body.has_nuts,
         },
         {
          where: {
          id: req.params.id,
         },
         });
        res.status(200).json(dish);
      } catch (err) {
        res.status(500).json(err);
       };
     });
  ```
* Run `npm install`, `node seeds/index.js`, and `npm start` from the command line. 

* Navigate to `http://localhost:3001/dish/1` and demonstrate the following in your browser:

  * 🔑  Now, when we add information into the form to edit a dish and click 'Submit', we can see that our dish info has been edited.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is the separation of concerns principle, and why is it important?

  * 🙋 The separation of concerns principle is that content should be separate from presentation and that data processing should also be separate from content. This helps us write conventional, clear, and maintainable code.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [MDN Docs: MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC), and stick around for office hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did today’s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
