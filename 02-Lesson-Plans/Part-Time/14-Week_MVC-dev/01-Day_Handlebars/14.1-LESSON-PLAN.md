# 14.1 Part-Time Lesson Plan: Model-View-Controller (MVC)

## Overview 

In today's class, students will learn about the MVC framework and the separation of concerns principle. They will practice using template engines on the front end by implementing Handlebars.js basics, like expressions and built-in helpers. After using hardcoded data, they will revisit how Models deal with data-logic on the back end by using Sequelize and MYSQL. They will also learn about how the Controller acts as an interface between the View and the Model by processing requests for data, using routes to manipulate the database, and passing serialized data to the View. 

## Instructor Notes

* In this lesson, students will complete activities `01-Ins_MVC-Handlebars` through `10-Stu_Handlebars-FE-Logic`.

* This unit introduces students to the template engine, Handlebars.js. The intention is not so much for students to learn Handlebars.js because it will be useful in their career, but instead, it is an introduction to template engines, preparation for React.js, and a way to emphasize the MVC framework.

* You will be using MySQL for a few of today's activities. Be sure to have your MySQL server up and running. Go ahead and create the `dish_db` database ahead of time, or demonstrate it live in class. 

* The first activities, `01-Ins_MVC-Handlebars-Intro` - `06-Stu_Built-In-Helpers`, include hardcoded data in Handlebars.js templates, `index.html`, or in the `dish-routes.js` file. Every subsequent activity (starting with `07-Ins_Data-Serialization`) includes a seeds folder. Run `node seeds/index.js` before class, or demonstrate seeding the database live in class. 

* Starting with `07-Ins_Data-Serialization`, each activity requires a `.env` file. Make sure you create one or rename the existing `.env.EXAMPLE` file before demonstrating each activity.

* Be prepared to remind students how to start their MySQL server and create the `dish_db` database in `08-Stu_Data-Serialization`.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Explain and implement MVC modularization in a full-stack web application

* Render dynamic HTML using the Handlebars.js template engine

* Dynamically pass data to other helpers or components using built-in helpers

* Use data serialization to simplify objects in order to work with necessary properties only

* Explain separation of concerns and its benefits

## Slide Deck

* [Unit 14 Slide Deck](https://docs.google.com/presentation/d/1rb2QnbKkUfmwqfUEpdQjV8x6S18ShB1BRdLggIVq6yU/edit?usp=sharing)

## Time Tracker
| Start  | #   | Activity Name                              | Duration |
|---     |---  |---                                         |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity             | 0:10     |
| 6:40PM | 2   | Instructor Demo: MVC Handlebars Intro      | 0:05     |
| 6:45PM | 3   | Student Do: MVC Handlebars Intro           | 0:15     |
| 7:00PM | 4   | Instructor Review: MVC Handlebars Intro    | 0:10     |
| 7:10PM | 5   | Instructor Demo: Handlebars Expressions    | 0:05     |
| 7:15PM | 6   | Student Do: Handlebars Expressions         | 0:15     |
| 7:30PM | 7   | Instructor Review: Handlebars Expressions  | 0:10     |
| 7:40PM | 8   | Instructor Demo: Built-In Helpers          | 0:05     |
| 7:45PM | 9   | Student Do: Built-In Helpers               | 0:15     |
| 8:00PM | 10  | BREAK                                      | 0:15     |
| 8:15PM | 11  | Instructor Review: Built-In Helpers        | 0:10     |
| 8:25PM | 12  | Instructor Demo: Data Serialization        | 0:05     |
| 8:30PM | 13  | Student Do: Data Serialization             | 0:15     |
| 8:45PM | 14  | Instructor Review: Data Serialization      | 0:10     |
| 8:55PM | 15  | Instructor Demo: Handlebars FE Logic       | 0:05     |
| 9:00PM | 16  | Student Do: andlebars FE Logic             | 0:15     |
| 9:15PM | 17  | Instructor Review: andlebars FE Logic      | 0:15     |
| 9:30PM | 18  | END                                        | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Open the [slide deck](https://docs.google.com/presentation/d/1rb2QnbKkUfmwqfUEpdQjV8x6S18ShB1BRdLggIVq6yU/edit?usp=sharing) and follow these prompts on their corresponding slides:

  * **MVC**
  
    * This unit is all about the architectural pattern called MVC, how it follows the separation of concerns principle, and the tools that help us follow this pattern, like the templating engine, Handlebars.js.

  * **What is the Separation of Concerns Principle?**
  
    * Separation of concerns is a design principle that each section of a program should address a separate concern

    * In a restaurant, the chefâ€™s concern is to cook the food, the serverâ€™s concern is to take orders and serve food, and a customerâ€™s concern is to order and eat.

    * We do not expect the customer to go back into the kitchen to cook food, the server to sit at a table and order, etc.

  * **What is MVC?**
  
    * The MVC Framework is an architectural pattern that uses the separation of concerns principle.

    * Model - Models are in charge of storing data and data-related logic.

    * View - Views are in charge of UI/UX concerns, or what a user will see and interact with.

    * Controller - Controllers are the interface between Models and Views. They process requests from the View, use the Model to manipulate data, and send data to the View to render.

  * **What is a Template Engine?**
  
    * A template engine is software that allows us to combine data with a static template to generate dynamic HTML. Most offer the following features:

      * Placeholder for data that we wish to include
      
      * Functions

      * Conditional rendering and looping

      * Text replacement

  * **What are advantages of using a template engine?**
  
    * They help us follow the separation of concerns principle and MVC by providing an easy, clean way to separate HTML and JS.

    * They offer tools that cut down on repetition in our code.

    * Templates are easy to create, use, and maintain.

    * They improve SEO and make fewer client-to-server requests.

  * **What is Handlebars.js?**
  
    * Handlebars.js is an extension of the templating language, Mustache. 

    * It is a logicless templating language that separates code from the View.
    
    * It compiles templates into a single resource, and then returns the HTML after replacing variables with data.

    * It is a pure rendering engine - that means it has no built-in support for event-handling, accessing back-end services, or incremental DOM updates

  * **Why are we learning Handlebars.js?**
  
    * It gives us a great introduction to template engines because it is easy to use, but offers a ton of functionality. It isnâ€™t the only one out there, but it is a great place to start!

    * It prepares us to encounter other languages that have this sort of templating built into them.

    * It helps us follow separation of concerns and MVC.

    * It is a step towards learning to use heavier frameworks, like React.js, to build single-page applications.

* Navigate to `28-Stu_Mini-Project/Main` in your command line.

* If you haven't already, rename the `.env.EXAMPLE` file and fill in your credentials. Run `seeds/seed.js` to data.

* Run `npm install` and `npm start` in the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following: 

  * The mini project for this unit uses Handlebars.js to build the View for a crowdfunding app.

  * The homepage for our crowdfunding app is rendered using Handlebars.js templates and displays all projects from the database.

* Navigate to <http://localhost:3001/login> in your browser and demonstrate the following: 

  * A user can create an account if they don't have one.

* Use the credentials `sal@hotmail.com` and `password12345` to demonstrate loggin into an account.
  
* Once logged in, navigate to <http://localhost:3001/profile> in your browser and demonstrate the following:

  * A user logged into their account can view their projects when they visit `/profile`.

  * A user logged into their account can create and delete projects when they visit `/profile`.

* Click on the `logout` button on the page to demonstrate that a user can logout of their account.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What are we learning?

  * ğŸ™‹ MVC framework, using template engines like Handlebars.js, and data serialization.

  * â˜ï¸ How does this project build off or extend previously learned material?

  * ğŸ™‹ We will use Sequelize, MYSQL, and object-oriented programming. This project will also include a front end and a back end.

  * â˜ï¸ How does this project relate to your career goals?

  * ğŸ™‹ We will learn how to use template engines and explain the MVC framework, a popular arichitectural pattern that you will encounter as a developer. This work will also prepare us for using heavier frameworks, like React.js.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: MVC Handlebars.js Intro (5 min) 

* Run `npm install` and `npm start` from the command line. 

* Open `01-Ins_MVC-Handlebars-Intro/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * ğŸ”‘  MVC is an architectural pattern that is used in most modern web applications.

  * ğŸ”‘  The MVC framework includes Models, Views, and Controllers. The Controller is the interface between the View and the Model. It processes requests, uses the Model to manipulate data, and sends data to the View to render.

  * ğŸ”‘  `dish-routes.js` currently includes a GET route. Right now, the route is telling the view to render `index.html` when the user visits `/`.

      ```js
         router.get('/', async (req, res) => {
           res.sendFile(path.join(__dirname, '../views/index.html'));
         });
      ```

* Open `01-Ins_MVC-Handlebars-Intro/views/index.html` in your IDE and demonstrate the following:

  * ğŸ”‘  The view is responsible for UI/UX concerns, or what a user can 'view' in the browser.

  * ğŸ”‘ Right now, the dishes are hardcoded in `views/index.html`. Today, you will learn how to render data dynamically using Handlebars.js, Sequelize, and MYSQL.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following: 

  * ğŸ”‘ The view in this application shows a menu of dishes that guests plan to bring to a potluck party.

* Open `01-Ins_MVC-Handlebars-Intro/models/Dish.js` in your IDE and demonstrate the following: 

  * ğŸ”‘ `Dish.js` is a Model. Models are in charge of data-related logic, like creating a new dish object.

  * ğŸ”‘ We learned how to set up models in the previous unit on ORMs. Remember, the data is hardcoded in `index.js`, so `Dish.js` is set up, but isn't actually doing anything at the moment.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What does MVC stand for?

  * ğŸ™‹ Model, View, Controller.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

### 3. Student Do: MVC Handlebars Intro (15 min) 

* Direct students to the activity instructions found in `02-Stu_MVC-Handlebars-Intro/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# ğŸ“ Add Comments to Implementation of MVC and Handlebars.js

Work with a partner to add comments describing the functionality of the code found in [Dish.js](./Unsolved/models/Dish.js), [main.handlebars](./Unsolved/views/layouts/main.handlebars), and [dish-routes.js](./Unsolved/controllers/dish-routes.js).

## ğŸ“ Notes

Refer to the documentation: 

* [Express Handlebars.js](https://www.npmjs.com/package/express-handlebars)

* [MDN Docs: MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

---

## ğŸ† Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are some other template engines? 

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: MVC Handlebars Intro (10 min) 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with MVC and Handlebars.js? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ Model

  * âœ”ï¸ View

  * âœ”ï¸ Controller

  * âœ”ï¸ Handlebars.js Static Templates

* Open `02-Stu_MVC-Handlebars-Intro/Solved/package.json` in your IDE and explain the following:  

  * We've added `express-handlebars` as a dependency in `package.json` so we need to run `npm install` to make sure all the packages are installed before working on our code.

  ```json
  "dependencies": {
    "express": "^4.16.3",
    "express-handlebars": "^3.0.0"
    }
  ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/server.js` in your IDE and explain the following:   

  * We import the `express-handlebars` library in `server.js`.

  ```js
  const exphbs = require('express-handlebars');
  const hbs = exphbs.create({});
  ```

  * We set Handlebars.js as the default template engine.

  ```js
  app.engine('handlebars', hbs.engine);
  app.set('view engine', 'handlebars');  
  ```

* Open `02-Stu_MVC-Handlebars-Intro/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * ğŸ”‘ `dish-routes.js` is the Controller.

  * `dish-routes.js` is responsible for interfacing between the View and the Model. 

  * ğŸ”‘ Now that we're using Handlebars.js, the GET route directs the View to render `all.handlebars`.

   * ğŸ”‘ The contents of `all.handlebars` will now become `{{{ body }}}` in the main layout.

  ```js
  router.get('/', async (req, res) => {
    res.render('all');
  });
  ``` 

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/layouts/main.handlebars` in your IDE and explain the following: 

  * ğŸ”‘ `main.handlebars` is part of the View.
  
  * The file looks like standard HTML, except for `{{{ body}}}`, which is a Handlebars.js placeholder. Whatever the Controller directs the View to render will be plugged in here.

  ```html
      <main class="container container-fluid mt-5">
        {{{ body }}}
      </main>
  ``` 

* Open `02-Stu_MVC-Handlebars-Intro/Solved/views/all.handlebars` in your IDE and explain the following:

  * ğŸ”‘ `all.handlebars` is also part of the View. Currently, we are rendering hardcoded data.

* Open `02-Stu_MVC-Handlebars-Intro/Solved/models/Dish.js` in your IDE and explain the following:

  * ğŸ”‘ `Dish.js` is a Model. It isn't actually doing anything at the moment, because we are rendering hardcoded data.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What is `{{{ body }}}`?

  * ğŸ™‹ It is a Handlebars.js placeholder.

  * â˜ï¸ How does the View know what to plug into `{{{ body }}}`?

  * ğŸ™‹ The routes in the Controller will indicate which template to render.

  * â˜ï¸ We are currently hardcoding data in the View, but where would the Controller typically get data to pass to the View?

  * ğŸ™‹ The Model is in charge of the data-logic. The Controller would retrieve and manipulate data using the Model.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Handlebars.js Docs](https://handlebarsjs.com/guide/#what-is-handlebars), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Handlebars Expressions (5 min) 

* Open `03-Ins_Handlebars-Expressions/controllers/dish-routes.js` in your IDE and demonstrate the following:

  * ğŸ”‘  In the previous activity, we hardcoded data in the View. Now, we are beginning to pass static data (an array of objects called `dish`) to the View in the Controller.

  * ğŸ”‘  Each object includes `dish_name` and `description` keys and value pairs.

  ```js
    {
      dish_name: 'French Bread with Brie Cheese',
      description: 'French baguette with warm brie',
    },
  ```

  * ğŸ”‘  The Controller includes a GET route for one dish, that passes the static data for one dish into a Handlebars.js template.

    ```js
     router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
     });
    ```
* Navigate to `03-Ins_Handlebars-Expressions/views/dish.handlebars` in your IDE and demonstrate the following:

  * ğŸ”‘  The template for one dish uses a Handlebars.js expression to render the name of a dish. Inside of the double curly brackets, we include the `dish_name` key so that it's value will be rendered.

  ```html
    <div class="dish-card">
      <div class="dish-card-header">
        {{dish_name}}
      </div>
    </div>
  ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/1> and demonstarte the following: 

  * ğŸ”‘  Now, when we view the page for one dish, we see the name of that dish. 

* Navigate to <http://local:host3001/dish/2> and demonstarte the following: 

  * ğŸ”‘  Now, when we view the page for another dish, we see that the template is the same, but the data has changed. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ We would insert the key of the value we wish to render into a Handlebars.js expression in the correct template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

### 6. Student Do: Handlebars Expressions (15 min) 

* Direct students to the activity instructions found in `04-Stu_Handlebars-Expressions/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# ğŸ—ï¸ Implement a GET Route for Food Item Descriptions 

Work with a partner to implement the following user story:

* As a party guest, I want to see description of one food item that will be at the potluck when I visit `http://localhost:3001/dish/:num`.

## Acceptance Criteria

* It's done when the route called `/dish/:num`  is properly configured to retrieve and return a food item and its description.

* It's done when the view displays a description for the food item, where the list number matches the the route `/dish/:num`.

## Assets

The following image demonstrates the web application's appearance and functionality:

![The view displays the name and description for one dish](images/dish-description.png)

---

## ğŸ’¡ Hints

* How can you make sure that the correct Handlebars.js template is rendered?

## ğŸ† Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* How can we render an array of objects using Handlebars.js?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Handlebars Expressions (10 min) 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with Handlebars.js expressions? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ GET route for `/dish/:num`

  * âœ”ï¸ Handlebars.js Expressions

* Open `04-Stu_Handlebars-Expressions/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * ğŸ”‘ In order to render a description for a dish, we first need to build a route for `/dish/:num`.
  
  * We render the `dish` template by passing it in as an argument. Then, we use params to select the correct dish to render in the template, based on the index of the dish. Now, we have access to a dish description through a dish object.

    ```js
    router.get('/dish/:num', async (req, res) => {
      return res.render('dish', dishes[req.params.num - 1]);
    });
    ```

* Open `04-Stu_Handlebars-Expressions/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * ğŸ”‘ We create a Handlebars.js expression, `{{ description }}`, passing in the `description` key name.

    ```html
      <div class="card-body">
        <p>
          Description:
          {{description}}
        </p>
      </div>
    ``` 
* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/1> and demonstrate the following: 

  * Now, when we view the page for one dish, we see the name of that dish and the dish description. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What is the syntax for a Handlebars.js expression?

  * ğŸ™‹ `{{ data }}` or data wrapped in double curly brackets.

  * â˜ï¸ How do we use a Handlebars.js expression to render data?

  * ğŸ™‹ We plug the key name of the value we wish to render into the curly brackets.

  * â˜ï¸ How does this relate to MVC?

  * ğŸ™‹ The Controller is responsible for passing data to the View via a route and the View is responsible for rendering that data in the browser.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Handlebars.js Expressions](https://handlebarsjs.com/guide/expressions.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Built-In Helpers (5 min) 

* Open `05-Ins_Built-In-Helpers/controllers/dish-routes.js` in your IDE and explain the following: 

  * ğŸ”‘ Now that `dishes` is hardcoded into `dish-routes.js`, we pass it in as an argument to `render()`.

    ```js
    router.get('/', async (req, res) => {
      res.render('all', { dishes });
    });
    ``` 
  * ğŸ”‘  We can use Handlebars.js built-in helpers to conditionally render blocks of code, iterate over lists, etc. Since the Controller is passing `dishes` to the View through `render()`, we can use a built-in helper to iterate over it in the template.

* Open `05-Ins_Built-In-Helpers/views/all.handlebars` in your IDE and demonstrate the following:

  * ğŸ”‘  In `all.handlebars` we are using `#each` to iterate over and render a menu for our dish data.

  * ğŸ”‘  `dishes` represents the `dishes` array that the Controller passed to the template. `dish` represents one dish object in that array.

  * ğŸ”‘  After `{{#each dishes as |dish|}}`, is the block of code to be rendered for each dish object. We could also use the syntax, `{{#each dish}}`, and then use `this.id` and `this.dish_name` in the block of code.
  
  * ğŸ”‘  Then we close the `#each` helper with `{{/each}}`.

    ```html
      {{#each dishes as |dish|}}
        <div class="dish col-md-5">
          <p>
            {{dish.id}}.
            {{dish.dish_name}}
          </p>
        </div>
        <div class="col-md-7">
          <p>
            <!-- guest_name will eventually go here -->
          </p>
        </div>
      {{/each}}
    ```

* Run `npm install` and `npm start` from the command line.

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * ğŸ”‘  Here, we see that each dish name is successfully rendered on the menu card.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ When should we use built-in helpers?

  * ğŸ™‹ If we need to iterate over data or conditionally render blocks of code.

  * â˜ï¸ Where would we include built-in helpers?

  * ğŸ™‹ Built-in helpers can be included in Handlebars.js templates.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

### 9. Student Do: Built-In Helpers (15 min) 

* Direct students to the activity instructions found in `06-Stu_Built-In-Helpers/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
    # ğŸ“– Conditionally Render Food Allergens

    Work with a partner to implement the following user story:

   * As a party guest, I want to know if a food item contains nuts.

   ## Acceptance Criteria

   * It's done when the view displays the message "Contains Nuts" under the food items that contain nuts.

   ## ğŸ“ Notes

   Refer to the documentation: 

  [Handlebars.js: Built-in Helpers](https://handlebarsjs.com/guide/builtin-helpers.html#if)

  ## ğŸ’¡ Hints

   * Which built-in helper conditionally renders a block?

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

    * Which built-in helper method is the inverse of #if? What is a use-case for rendering a block if an expression is a falsy value? 

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Built-In Helpers (10 min) 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with built-in helpers? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ `#if`

* Open `06_Stu-Built-in-Helpers/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * When we look at our dish data, we see that it includes a boolean for `has_nuts` that is set to true for the dishes that contain nuts.

  ```js
       {
        id: 2,
        dish_name: 'Cheese Plate with Spanish Chorizo',
        description: 'Manchego, Iberico, Cabrales, fig jam, grapes, pecans, and Spanich Chorizo',
        has_nuts: true,
      },
  ```

* Open `06-Stu_Built-In-Helpers/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * ğŸ”‘ We want to make sure that the message, "Contains Nuts", is only rendered for dish objects that actually contain nuts. In order to do this, we need to conditionally render a block of code with the `#if` built-in helper.

  * ğŸ”‘  We provide `has_nuts` as the condition when we open the `#if` helper. Then we include the block of code that we wish to conditionally render. Finally, we close `#if`. 

    ```html
      {{#if has_nuts}}
        <p class="has-nuts">
          Contains Nuts
        </p>
      {{/if}}
    ```
* Run `npm install` and `npm start` from the command line.

* Navigate to <http://local:host3001/dish/2> in your browser and demonstrate the following:

  * Here, we see that the message, "Contains Nuts", shows up when a dish contains nuts.

* Navigate to <http://local:host3001/dish/1> in your browser and demonstrate the following:

  * Here, we see that the message is not being rendered, because the dish does not contain nuts.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ When is it a good idea to use a Handlebars.js built-in helper?

  * ğŸ™‹ When we need to iterate over a list, conditionally render a block of code, etc.

  * â˜ï¸ How does this relate to MVC?

  * ğŸ™‹ This is a UI/UX concern. Built-in helpers empower the View to be in charge of how and when data is displayed. 

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Handlebars.js Built-In Helpers](https://handlebarsjs.com/guide/builtin-helpers.html#each), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Data Serialization (5 min) 

* Rename the `07-Ins_Data-Serialization/.env.EXAMPLE` file to .env and fill in your credentials.

* Run `node seeds/index.js` from the command line and demonstrate the following: 

  * ğŸ”‘  Now we are going to move on to using Sequelize and MYSQL. So far, we've focused on the Controller and the View. Now that we have a seeded database, we can look at how the Model fits into the MVC framework.

* Open `07-Ins_Data-Serialization/views/dish.handlebars` in your IDE and demonstrate the following: 

  * ğŸ”‘  Nothing has changed in the View. We are still using Handlebars.js expressions and built-in helpers to render data that is passed in.

* Open `07-Ins_Data-Serialization/controllers/dish-routes.js` in your IDE and demonstrate to following: 

  * ğŸ”‘  For the purpose of this Demo, the Controller includes two GET routes for one dish. The first does not serialize data, the second one (currently commented out) does serialize the data.

  * ğŸ”‘  The Controller has changed now that the Model is set up. Now, we are using `findByPk()` to locate a dish in the database. Once `dishData` is found, we are passing it to the `dish` template in the View to be rendered.

  ```js
  // get one dish without serializing data
   router.get('/dish/:id', async (req, res) => {
     try {
       const dishData = await Dish.findByPk(req.params.id);
       console.log(dishData)
       res.render('dish', dishData);
     } catch (err) {
       res.status(500).json(err);
     }
   });
  ```  
* Run `npm install`, `npm start`, navigate to <http://local:host3001/dish/1> in your browser and demonstrate the following: 

  * ğŸ”‘  However, the object will be returned as a Sequelize object that can be difficult to parse through on the template side. 
 
  * ğŸ”‘  When we look at the browser, our template is there, but the data is missing. 

  * ğŸ”‘  When we look at the terminal, we see that we are logging the Sequelize object. Look at all of that extra data! 

  ```js
     dish {
     dataValues: {
       id: 2,
       dish_name: 'Fish Tacos',
       description: 'Battered/fried fish, corn tortillas, fresh slaw with jalepenos and cilantro, pickled red onion',
       guest_name: 'Carlos',
       has_nuts: false,
       createdAt: 2020-11-17T22:33:06.000Z,
       updatedAt: 2020-11-17T22:33:06.000Z
     },
     _previousDataValues: {
       id: 2,
       dish_name: 'Fish Tacos',
       description: 'Battered/fried fish, corn tortillas, fresh slaw   with jalepenos and cilantro, pickled red onion',
       guest_name: 'Carlos',
       has_nuts: false,
       createdAt: 2020-11-17T22:33:06.000Z,
       updatedAt: 2020-11-17T22:33:06.000Z
     },
     _changed: {},
     _modelOptions: {
       timestamps: true,
       validate: {},
       freezeTableName: true,
       underscored: true,
       paranoid: false,
       rejectOnEmpty: false,
       whereCollection: { id: '2' },
       schema: null,
       schemaDelimiter: '',
       defaultScope: {},
       scopes: {},
       indexes: [],
       name: { plural: 'dishes', singular: 'dish' },
       omitNull: false,
       sequelize: Sequelize {
         options: [Object],
         config: [Object],
         dialect: [MysqlDialect],
         queryInterface: [QueryInterface],
         models: [Object],
         modelManager: [ModelManager],
         connectionManager: [ConnectionManager],
         importCache: {}
       },
       hooks: {}
     },
     _options: {
       isNewRecord: false,
       _schema: null,
       _schemaDelimiter: '',
       raw: true,
       attributes: [
         'id',
         'dish_name',
         'description',
         'guest_name',
         'has_nuts',
         'createdAt',
         'updatedAt'
       ]
     },
     isNewRecord: false
   }
  ```

  * ğŸ”‘  So, the Controller must 'serialize' the data in the route to get rid of all of that extra information, before passing it to the templates in the View. 

* In `07-Ins_Data-Serialization/controllers/dish-routes.js`, comment out the first GET route and uncomment the second GET route to demonstrate the following:

  * ğŸ”‘  Let's look at the second GET route in the Controller. This route is serializing the Sequalize object.

  * ğŸ”‘  We accomplish this by attaching `.get({ plain: true })` to the returned object `dishData`, and then we pass the serialized data as `dish` through to the `'dish'` template.

   ```js
    // get one dish with serialized data
    router.get('/dish/:id', async (req, res) => {
      try {
        const dishData = await Dish.findByPk(req.params.id);
        const dish = dishData.get({ plain: true });
        res.render('dish', dish);
      } catch (err) {
        res.status(500).json(err);
      }
     });
   ```

* Restart your server and navigate to <http://local:host3001/dish/1> in your browser and demonstrate the following:.

  * ğŸ”‘  Here we see that the View for one dish is now rendering both the template and the data. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we make sure that the templates in the View are able to parse the data sent by the Controller?

  * ğŸ™‹ We serialize the data in the Controller so that we are only sending the data that we need to the View.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

### 13. Student Do: Data Serialization (15 min)

* Direct students to the activity instructions found in `08-Stu_Data-Serialization/README.md`.

* Break your students into pairs that will work together on this activity.

* Remind students to set up their `dish_db` database and seed it before starting on the activity. 

* Students should also modify the `.env.EXAMPLE` file to include their MySQL user/password information and run `npm install` before **every following activity**. 

```md
# ğŸ› Main View is not Displaying Food Items 

Work with a partner to resolve the following issue(s):

* As a party guest, I would like to view a full menu of food items that other guests will bring to the party.

## Expected Behavior

* When a party guest views the page, they see a menu of food items.

## Actual Behavior

* When a party guest views the page, no food items appear on the menu.

## Steps to Reproduce the Problem

1. Run `npm install`. 

2. Make sure that the MySQL server is turned on.

3. Run `CREATE DATABASE dish_db;` to create a new database.

4. Return to your console and run `node seeds/index.js` to seed the database.

5. Run `npm start`.

6. Navigate to http://localhost:3001/ in your browser.

## Assets

The following image demonstrates the web application's appearance and functionality:

![The View displays a full menu of dishes and the name of the guest who will bring each dish.](images/Full-Menu.png)

---

## ğŸ’¡ Hints

* How can you change your route so that the View is able to display the menu of food items?

## ğŸ† Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are other options that you have to serialize data down to the properties that you need? 

Use [Google](https://www.google.com) or another search engine to research this.

```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Data Serialization (10 min) 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with data serialization? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ `map()`

  * âœ”ï¸ Data Serialization

* Open `08-Stu_Data-Serialization/Solved/controllers/dish-routes.js` in your IDE and explain the following: 

  * In order to render a full menu for party guests using a GET route, we must first query the database for all dish objects using the Sequelize method, `findAll()`.

  * ğŸ”‘  Instead of recieving one object, we recieve an array of dish objects that need to be serialized before being rendered. We are using `map()` to return a new array of serialized objects by adding `.get({ plain: true})` to each `dish` object.

  * Finally, the Controller sends the newly serialized array of dishes to the `'all'` template in the View.

    ```js
    router.get('/', async (req, res) => {
      const dishData = await Dish.findAll().catch((err) => { 
        res.json(err);
       }); 
      const dishes = dishData.map((dish) => dish.get({ plain: true }));
      res.render('all', { dishes });
    });
    ```

  * Run `npm install` and `npm start` from the command line then navigate to <http://localhost:3001/> in your browser.

  * ğŸ”‘  Here we see that the View is rendering a full menu of dishes as expected. 

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ Why do we need to serialize data in the Controller?

  * ğŸ™‹ Sequelize objects include extra data that the View does not need. We serialize data in the Controller so that the the templates in the View can parse and render the data from the Model.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Sequelize Docs](https://sequelize.org/master/class/lib/model.js~Model.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: Handlebars FE Logic (5 min) 

* Rename the `09-Ins_Handlebars-FE-Logic/.env.EXAMPLE` file to .env and fill in your credentials.

 * ğŸ”‘  The MVC framework follows the separation of concerns principle. For our purposes, this means that content should be separate from presentation and that data processing should also be separate from content. This helps us write clear and maintainable code.

  * ğŸ”‘  We will explore MVC and the separation of concerns principle further in this lesson by examining a form to add a dish to our database.

* Open `09-Ins_Handlebars-FE-Logic/views/all.handlebars` in your IDE and demonstrate the following:

  * ğŸ”‘  Here, we see an RSVP form to the `'all'` template that allows guests to provide information about the dish they plan to bring to the party.

  * ğŸ”‘  In order to add an event listener, we need to connect the template in `'all'` to the JS in `add-dish.js` by adding a `<script>` tag.

    ```handlebars
      <script src="/js/add-dish.js"></script>
    ```

* Open `09-Ins_Handlebars-FE-Logic/public/js/add-dish.js` in your IDE and demonstrate the following:

  * ğŸ”‘  Since our template is connected to the JS in the `public` folder, we can add an event listener for the form in `add-dish.js`.

  * ğŸ”‘  On 'Submit', the form handler will capture user input from the form fields in the View. 

   ```js
    document.querySelector('.new-dish-form').addEventListener('submit', newFormHandler);
  ```

  * ğŸ”‘  Notice the syntax where `has_nuts` is declared. This is a ternary operator, or another type of conditional operator. `'#has_nuts:checked'` is the condition, followed by a '?'. If it is truthy, `has-nuts` will be true, otherwise, it will be false.

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked') ? true : false;
    ```

  * ğŸ”‘  `fetch()` passes the form input to the Controller in the body of the request with the POST method.

    ```js
     const response = await fetch(`/api/dish`, {
       method: 'POST',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```
* Open `09-Ins_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following: 

  * ğŸ”‘  The POST route in the Controller accepts the input, uses the Model to create a dish object in the database and then returns the data. 

    ```js
     router.post('/', async (req, res) => {
       try { 
         const dishData = await Dish.create({
           dish_name: req.body.dish_name,
           description: req.body.description,
           guest_name: req.body.guest_name,
           has_nuts: req.body.has_nuts,
         });
        res.status(200).json(dishData)
        } catch (err) {
          res.status(400).json(err);
        }
      });
    ```

  * When the dish is added and a successful response is sent to `add-dish.js`, the `all` template is rerendered by the View.

* Run `npm install` and `npm start` from the command line. 

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * ğŸ”‘  Now, when we add information into the form and click 'Submit', we can see that our dish has been added to the menu.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How do we process user input and send it to the Controller?

  * ğŸ™‹ We can use a form handler to collect form input and send it to the Controller, where the business logic will be preformed. 

  * â˜ï¸ How do we connect the form handlers in the `js` folder to the templates in the View?

  * ğŸ™‹ We can add a `<script>` tag with `src="<our-file-name>"` at the bottom of the template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

### 16. Student Do: Handlebars FE Logic (15 min) 

* Direct students to the activity instructions found in `10-Stu_Handlebars-FE-Logic/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# ğŸ“ Add Comments to the Implementation of a Form to Update a Food Item

Work with a partner to add comments describing the functionality of the code found in [dish.handlebars](./Unsolved/views/dish.handlebars) [edit-dish](./Unsolved/public/js/edit-dish.js), and [dish-routes](./Unsolved/controllers/api/dish-routes.js).

## ğŸ“ Notes

Refer to the documentation: 

* [Handlebars.js Docs](https://handlebarsjs.com/guide/#what-is-handlebars)

* [MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC)

---

## ğŸ† Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are the pros and cons of using a template engine like Handlebars.js?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: Handlebars FE Logic (15 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with MVC and frontend logic? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ View

  * âœ”ï¸ Model

  * âœ”ï¸ Controller

  * âœ”ï¸ Front End Logic

  * âœ”ï¸ Ternary Operator

* Open `10-Stu_Handlebars-FE-Logic/Solved/views/dish.handlebars` in your IDE and explain the following: 

  * We now have an edit form in the `'dish'` template that allows users to update a dish. 

  * ğŸ”‘  As a part of the View, this form is responsible for the UI/UX logic. It is not responsible for business or data-related logic.

* Open `10-Stu_Handlebars-FE-Logic/Solved/public/js/edit-dish.js` in your IDE and explain the following: 

  * We've added an event listener to the form in `edit-dish.js`.

  * ğŸ”‘  On 'Submit', the form handler will capture user input from the form fields in the View and process the data using front end logic to pass to the Controller. 

    ```js
      document.querySelector('.edit-dish-form').addEventListener('submit', editFormHandler);
    ```

  * ğŸ”‘  We've included a ternary operator again to indicate if the checkbox for Contains Nuts has been checked or not.

    ```js
    const has_nuts = document.querySelector('#has_nuts:checked') ? true : false;
    ```
  * We are using the URL to access the dish's id, to ensure that we send out fetch request to the correct endpoint.

    ```js
    const id = window.location.toString().split('/')[
    window.location.toString().split('/').length - 1
     ];
    ```

  * ğŸ”‘  `fetch()` passes the edit form input to the Controller in the body of the request with the PUT method.

    ```js
     const response = await fetch(`/api/dish/${id}`, {
       method: 'PUT',
       body: JSON.stringify({
        dish_name,
        description,
        guest_name,
        has_nuts,
       }),
       headers: {
        'Content-Type': 'application/json',
      },
     });
    ```

  * Open `10-Stu_Handlebars-FE-Logic/controllers/api/dish-routes.js` in your IDE and demonstrate the following: 

  * ğŸ”‘  The PUT route in the Controller accepts the input, uses the Model to edit a dish object in the database and then returns a response to `edit-dish.js`. If the response is ok, `dish` will be rendered by the View.

  ```js
    router.put('/:id', async (req, res) => {
     try {
       const dish = await Dish.update(
         {
          dish_name: req.body.dish_name,
          description: req.body.description,
          guest_name: req.body.guest_name,
          has_nuts: req.body.has_nuts,
         },
         {
          where: {
          id: req.params.id,
         },
         });
        res.status(200).json(dish);
      } catch (err) {
        res.status(500).json(err);
       };
     });
  ```
  
* Run `npm install` and `npm start` from the command line. 

* Navigate to <http://localhost:3001/> in your browser and demonstrate the following:

  * ğŸ”‘  Now, when we add information into the form to edit a dish and click 'Submit', we can see that our dish info has been edited.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What is the separation of concerns principle, and why is it important?

  * ğŸ™‹ The separation of concerns principle is that content should be separate from presentation and that data processing should also be separate from content. This helps us write conventional, clear, and maintainable code.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [MDN Docs: MVC](https://developer.mozilla.org/en-US/docs/Glossary/MVC), and stick around for office hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did todayâ€™s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
Â© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
