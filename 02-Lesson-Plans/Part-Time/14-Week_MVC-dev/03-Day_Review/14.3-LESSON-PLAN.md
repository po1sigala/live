# 14.3 Part-Time Lesson Plan: Model-View-Controller (MVC)

## Overview 

In today's class, students will have a chance to review MVC architecture, Handlebars.js, user authentication, and ESLint. Students will also be introduced to Prettier prior to starting on the mini project.

## Instructor Notes

* In this lesson, students will complete activities `21-Ins_MVC-Review` through `28-Stu_Mini-Project`.

* Be sure to have your MySQL server up and running. Go ahead and create the `user_db` and `crowdfund_db` databases ahead of time, or demonstrate it live in class.

* The first two activities and the mini project use a `.env` file. Make sure you create one or rename the existing `.env.EXAMPLE` file before demonstrating these activities.

* The activities also include a seeds script that can be executed with `npm run seed`.

* You'll need to install the ESLint and Prettier VS Code extensions to properly demonstrate both libraries.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

* If the students struggle with the `Everyone Do: Prettier` activity, walk through it with the students using the talking points provided. Otherwise, support the students as they do the activity and do a brief review at the end. 

## Learning Objectives

By the end of class, students will be able to:

* Explain the interactions between the Model, View, and Controller

* Implement user authentication in a Node.js app

* Explain the purpose of ESLint

* Explain and add Prettier to an existing project

## Time Tracker
| Start  | #   | Activity Name                      | Duration |
|---     |---  |---                                 |---       |
| 10:00AM| 1   | Instructor Do: Stoke Curiosity     | 0:10     |
| 10:10AM| 2   | Instructor Demo: MVC Review        | 0:05     |
| 10:15AM| 3   | Student Do: MVC Review             | 0:15     |
| 10:30AM| 4   | Instructor Review: MVC Review      | 0:10     |
| 10:40AM| 5   | Instructor Demo: Auth Review       | 0:05     |
| 10:45AM| 6   | Student Do: Auth Review            | 0:15     |
| 11:00AM| 7   | Instructor Review: Auth Review     | 0:10     |
| 11:10AM| 8   | Instructor Demo: Lint Review       | 0:05     |
| 11:15AM| 9   | Student Do: Lint Review            | 0:15     |
| 11:30AM| 10  | Instructor Review: Lint Review     | 0:10     |
| 11:40AM| 11  | Everyone Do: Prettier              | 0:20     |
| 12:00PM| 12  | BREAK                              | 0:40     |
| 12:40PM| 13  | Instructor Demo: Mini Project      | 0:05     |
| 12:45PM| 14  | Student Do: Mini Project           | 0:60     |
| 1:45PM | 15  | Instructor Review: Mini Project    | 0:10     |
| 1:55PM | 16  | Introduce Homework                 | 0:05     |
| 2:00PM | 17  | END                                | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Congratulate the class on learning new back-end skills to complement their front-end skills. They now have everything they need to build full-stack applications!

* Remind students that the upcoming group project will involve putting all of these skills together to make something of their own choosing.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What are some apps that would require a database?

  * ğŸ™‹ An app for scheduling appointments, tracking fitness/financial progress, shopping, anything that requires users to create an account

  * â˜ï¸ What's the benefit of having an app where users can create accounts?

  * ğŸ™‹ Their information is saved indefinitely and can be accessed across multiple devices (as opposed to `localStorage`)

  * â˜ï¸ What content or features would you want to restrict to only logged in users?

  * ğŸ™‹ Your own dashboard/profile page, the ability to create public posts, the ability to interact with other users, etc.

  * â˜ï¸ Thinking about your personal interests, what kind of account-based app would aid those interests?

  * ğŸ™‹ An app where you can share/favorite recipes, schedule meet-ups, discuss/review movies, trade collectibles, plan a trip, etc.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: MVC Review (5 min) 

* Navigate to `21-Ins_MVC-Review` and explain the following:

  * This is a full-stack application that follows MVC architecture.

  * There are folders labeled `models`, `views`, and `controllers` that contain the three main pieces of the application.

* Open `21-Ins_MVC-Review/models/User.js` in your IDE and explain the following:

  * The Model is in charge of data-related logic. This particular model maps to a `user` table in the database.

* Open `21-Ins_MVC-Review/controllers/homeRoutes.js` in your IDE and explain the following:

  * The Controller processes requests. In this case, our controller is an Express.js route that renders a Handlebars.js template.

* Open `21-Ins_MVC-Review/views/homepage.handlebars` in your IDE and explain the following:

  * The View represents what the user sees in the browser. Our views are built with Handlebars.js. However, they are currently rendering hardcoded test data.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this with real data?

  * ğŸ™‹ Run a Sequelize `findAll()` method in the controller and send the returned data to the Handlebars.js template.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `22-Stu_MVC-Review/README.md`.

### 3. Student Do: MVC Review (15 min) 

* Direct students to the activity instructions found in `22-Stu_MVC-Review/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ—ï¸ Populate User Registry with Database Data

  Work with a partner to implement the following user story:

  * As a user, I want to see a list of other users who are registered with the app.

  ## Acceptance Criteria

  * It's done when the homepage displays the user data from the database instead of the hardcoded values.

  * It's done when the user data is rendered as part of a Handlebars.js template.

  * It's done when the users are sorted alphabetically by name.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![The homepage displays a list of users and their e-mail addresses](./Images/01-user-registry.png)

  ---

  ## ğŸ’¡ Hints

  * Without a signup form, how can you quickly add new users to the database?

  * What needs to happen with the Sequelize data before it can be passed into the Handlebars.js template?

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What are some other paradigms besides MVC?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: MVC Review (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with MVC and Handlebars.js? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ Sequelize serialization

  * âœ”ï¸ Handlebar.js expressions

* Open `21-Ins_MVC-Review/controllers/homeRoutes.js` in your IDE and explain the following: 

  * We perform a Sequelize `findAll()` to get the user data, excluding the users' passwords but ordering them by name.

    ```js
    const userData = await User.findAll({
      attributes: { exclude: ['password'] },
      order: [['name', 'ASC']],
    });
    ```

  * ğŸ”‘ We serialize the data to remove extraneous properties that Handlebars.js doesn't need.

    ```js
    const users = userData.map((project) => project.get({ plain: true }));
    ```

  * ğŸ”‘ We pass the serialized array of users into the `homepage.handlebars` template.

    ```js
    res.render('homepage', { users });
    ```

* Open `21-Ins_MVC-Review/views/homepage.handlebars` in your IDE and explain the following:

  * ğŸ”‘ We use a Handlebars.js `#each` helper to loop over the users and render a `<div>` element for each one.

    ```hbs
    {{#each users as |user| }}
    <div class="row align-center mb-5">
      <div class="col-md-6">
        <h2>{{{get_emoji}}} {{user.name}}</h2>
      </div>
      <div class="col-md-6">
        <h3><a href="mailto:{{user.email}}">{{user.email}}</a></h3>
      </div>
    </div>
    {{/each}}
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What is another built-in helper that you can use with Handlebars.js?

  * ğŸ™‹ The `#if` helper.

  * â˜ï¸ What is the difference between double and triple bracket expressions in Handlebars.js?

  * ğŸ™‹ Double brackets render text; triple brackets render HTML.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [Sequelize Models documentation](https://sequelize.org/master/class/lib/model.js~Model.html) and the [Express Handlebars documentation](https://www.npmjs.com/package/express-handlebars), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Auth Review (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED

* Open `@TODO/folder/file` in your browser and demonstrate the following:

* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

  * ğŸ”‘ @TODO { WHEN WE DO THIS, IT DOES THAT. }

  * ğŸ”‘ @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ @TODO { YES, HOW? } 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `@TODO/folder/file`.

### 6. Student Do: Auth Review (15 min) 

* Direct students to the activity instructions found in `@TODO/folder/file`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ“ Add Comments to Implementation of a Login Route

  Work with a partner to add comments describing the functionality of the code found in the following files:

  * [Unsolved/server.js](./Unsolved/server.js)

  * [Unsolved/controllers/api/userRoutes.js](./Unsolved/controllers/api/userRoutes.js)

  * [Unsolved/utils/auth.js](./Unsolved/utils/auth.js)

  * [Unsolved/controllers/homeRoutes.js](./Unsolved/controllers/homeRoutes.js)

  * [Unsolved/views/layouts/main.handlebars](./Unsolved/views/layouts/main.handlebars)

  * [Unsolved/public/js/login.js](./Unsolved/public/js/login.js)

  * [Unsolved/public/js/logout.js](./Unsolved/public/js/logout.js)

  ---

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What other tools can be used to handle user authentication in a Node.js application?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Auth Review (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with `@TODO TOPIC`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ @TODO { THIS }

  * âœ”ï¸ @TODO { THAT }

  * âœ”ï¸ @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

  * ğŸ”‘ @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

  * ğŸ™‹ @TODO { YES, WE DO! }

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ @TODO We can refer to supplemental material, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Lint Review (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED

* Open `@TODO/folder/file` in your browser and demonstrate the following:

* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

  * ğŸ”‘ @TODO { WHEN WE DO THIS, IT DOES THAT. }

  * ğŸ”‘ @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ @TODO { YES, HOW? } 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `@TODO/folder/file`.

### 9. Student Do: Lint Review (15 min) 

* Direct students to the activity instructions found in `@TODO/folder/file`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ› Fix Project's ESLint Rules

  Work with a partner to resolve the following issue(s):

  * As a developer, I don't want to see warnings when I use the `**` exponentiation operator.

  * As a developer, I want to discourage other team members from explicitly assigning variables to `undefined`.

  ## Expected Behavior

  The project's ESLint rules allow the use of `**` operators. 

  ESLint displays an error when variables are assigned to `undefined`. For example: `let x = undefined;` is unnecessary, because `let x;` on its own is sufficient.

  ## Actual Behavior

  ESLint displays an error when developers use `**` operators. For example: `let x = 5 ** 2;`.

  Developers are able to assign variables to `undefined` without any warning from ESLint.

  ## Steps to Reproduce the Problem

  1. Run `npm install` to install the ESLint dependencies.

  2. Open `index.js` in VS Code.

  3. Note the underlined error on line 6.

  ---

  ## ğŸ’¡ Hints

  * How do you adjust the rules for an ESLint configuration?

  * In which version of JavaScript were `**` exponentiation operators introduced?

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What are some other options you can add to your ESLint config file?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. Instructor Review: Lint Review (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with `@TODO TOPIC`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ @TODO { THIS }

  * âœ”ï¸ @TODO { THAT }

  * âœ”ï¸ @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

  ```
  @TODO ADD CODE SNIPPET, TABBED
  ```

  * ğŸ”‘ @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

  * ğŸ™‹ @TODO { YES, WE DO! }

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ @TODO We can refer to supplemental material, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `@TODO/folder/file`.

### 11. Everyone Do: Prettier (20 min)

* @TODO Open [Git docs](https://git-scm.com/docs/{TITLE}) in your browser and explain the following:

  * @TODO GIVE A SHORT EXPLANATION OF THIS GIT CONCEPT/COMMAND.

* Direct students to the activity instructions found in `@TODO/folder/file`.

* While everyone is working on the activity, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

* Open your command line and demonstrate the following:

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

  ```
  @TODO ADD CODE SNIPPET, TABBED
  ```

  * ğŸ”‘ @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Answer any questions before students go on break.

### 12. BREAK (40 min)

### 13. Instructor Demo: Mini Project (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED

* Open `@TODO/folder/file` in your browser and demonstrate the following:

* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following:

  * ğŸ”‘ @TODO { WHEN WE DO THIS, IT DOES THAT. }

  * ğŸ”‘ @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How would we build this?

  * ğŸ™‹ @TODO { YES, HOW? } 

* Answer any questions before allowing students to start the mini project.

### 14. Student Do: Mini Project (60 min)

* Direct students to the activity instructions found in `@TODO/folder/file`.

* Break your students into groups that will work together on this activity.

  ```md
  # Unit 14 Mini Project: Crowdfunding App

  In this mini project, you will work with a group to build a full-stack crowdfunding app using Node.js, Express.js, Sequelize, Handlebars.js, and MVC architecture.

  ## User Stories

  * As a user, I want to see a list of current projects seeking funding.

  * As a user, I want to be able to create an account.

  * As a registered user, I want to post my own projects to ask for funding.

  ### Acceptance Criteria

  * It's done when the `/` homepage route renders a list of all projects from the database.

  * It's done when the `/project/:id` route renders an individual project's details based on the route parameter ID.

  * It's done when the `/login` route renders a form to log in and a form to create a new account.

  * It's done when an existing user can enter their credentials on the login page to create a session on the server.

  * It's done when a new user can create an account on the login page and then be immediately logged in with a session.

  * It's done when the `/profile` route renders the logged in user's projects and a form to create a new project.

  * It's done when only a logged in user can visit the `/profile` route.

  * It's done when a logged in user is redirected to `/profile` when they try to visit `/login` again.

  * It's done when a user on the profile page can use the form to create a new project in the database.

  * It's done when a user on the profile page can select a "Delete" button to remove their project from the database.

  * It's done when a logged in user can select a "Logout" button to remove their session.

  * It's done when the API routes to create and delete posts are auth guarded from non logged in users.

  * It's done when the code is organized using MVC architecture.

  * It's done when the views are rendered with Handlebars.js templates.

  ## Specifications 

  * The database models have the following fields and associations:

    * `User`
      * `id`: primary key
      * `name`
      * `email`
      * `password`

    * `Project`
      * `id`: primary key
      * `name`
      * `description`
      * `date_created`
      * `needed_funding`
      * `user_id`: foreign key that references `User.id`

    * Users have many Projects and Projects belong to a User.

      * If a User is deleted, all associated Projects are also deleted.

  ---

  ## ğŸ’¡ Hints

  * What tools can you use to test the existing API routes if you don't yet have a front end?

  * Where would you place the client-side JavaScript for capturing form data?

  * How can middleware help protect routes from non logged in users?

  * How can Handlebars.js helpers (both built-in and custom) be used to render the desired results?

  ## ğŸ† Bonus

  If you have fully completed the above tasks, here is something you and your group can work through as an added challenge to further your knowledge:

    * Add an `/edit/:id` route for logged in users to update their projects' details.

    * Deploy the app to Heroku!
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 15. Instructor Review: Mini Project  (10 min)  

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with this mini-project? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ @TODO { THIS }

  * âœ”ï¸ @TODO { THAT }

  * âœ”ï¸ @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

  * ğŸ”‘ @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

  * ğŸ™‹ @TODO { YES, WE DO! }

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ @TODO We can refer to supplemental material, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 16. Instructor Demo: Introduce Homework (5 min)

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED

* Open `@TODO/folder/file` in your browser and demonstrate the following:

* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following:

  * @TODO { WHAT ARE WE GOING TO BE BUILD? }

  * @TODO { ISN'T THIS NEAT! A SOPHISTICATED OR MODERN APPLICATION OF A KEY TOPIC. }

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What are we learning?

  * ğŸ™‹ @TODO { YES, WHAT? }.

  * â˜ï¸ How does this project build off or extend previously learned material?

  * ğŸ™‹ @TODO {YES, WHAT? }.

  * â˜ï¸ How does this project relate to your career goals?

  * ğŸ™‹ @TODO { HOW DO COMPANIES USE IT IN INTERESTING WAYS? HOW POPULAR OR IN-DEMAND IS IT? WHY IS THE PROJECT ENTICING TO EMPLOYERS? }

* Ask TAs to direct students to the Homework Requirements found in `@TODO/folder/file`.

* Answer any questions before ending the class.

### 17. END (0 min)

How did todayâ€™s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
Â© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
