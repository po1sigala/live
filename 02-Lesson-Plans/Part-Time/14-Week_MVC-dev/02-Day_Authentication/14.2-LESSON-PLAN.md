# 14.2 Part-Time Lesson Plan: Model-View-Controller (MVC)

## Overview 

In today's class, students will continue to practice using Handlebars.js, including using partials and custom helpers. Students will also incorporate sessions and cookies using the Sequelize store. Lastly, students will create their own custom middleware for user authentication. 

## Instructor Notes

* In this lesson, students will complete activities `11-Ins_Partials` through `20-Stu_Middleware`.

* Be sure to prepare and read over the activities before your class begins. Try to anticipate any questions students may have.

* You will be using MySQL for today's activities. Be sure to have your MySQL server up and running. Demonstrate creating the database `museum_db` live in class during the first "Instructor Demo" of this class.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code. 

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Implement Handlebars.js partials to reuse a Handlebars.js template.

* Utilize custom helper functions to format data in a Handlebars.js template.

* Create and read a session on a server using `express-sessions`. 

* Explain how cookies and sessions work together.

* Implement middleware function in Express.js. 

## Time Tracker
| Start  | #   | Activity Name                       | Duration |
|---     |---  |---                                  |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity      | 0:10     |
| 6:40PM | 2   | Instructor Demo: Partials           | 0:05     |
| 6:45PM | 3   | Student Do: Partials                | 0:15     |
| 7:00PM | 4   | Instructor Review: Partials         | 0:10     |
| 7:10PM | 5   | Instructor Demo: Custom Helpers     | 0:05     |
| 7:15PM | 6   | Student Do: Custom Helpers          | 0:15     |
| 7:30PM | 7   | Instructor Review: Custom Helpers   | 0:10     |
| 7:40PM | 8   | Instructor Demo: Sessions           | 0:05     |
| 7:45PM | 9   | Student Do: Sessions                | 0:15     |
| 8:00PM | 10  | BREAK                               | 0:15     |
| 8:15PM | 11  | Instructor Review: Sessions         | 0:10     |
| 8:25PM | 12  | Instructor Demo: Cookies            | 0:05     |
| 8:30PM | 13  | Student Do: Cookies                 | 0:15     |
| 8:45PM | 14  | Instructor Review: Cookies          | 0:10     |
| 8:55PM | 15  | Instructor Demo: Middleware         | 0:05     |
| 9:00PM | 16  | Student Do: Middleware              | 0:15     |
| 9:15PM | 17  | Instructor Review: Middleware       | 0:15     |
| 9:30PM | 18  | END                                 | 0:00     |

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* One of the topics for today is cookies. Using the prompts below, have a discussion about how sessions and cookies work hand-in-hand.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * Today we are going to talk about cookies! Not the cookies that we eat, but the cookies that are saved whenever we visit a website. 

  * You've probably seen these messages whenever you visit a website:

  > This website stores cookies on your computer. These cookies are used to collect information about how you interact with our website and allow us to remember you. 
  We use this information in order to improve and customize your browsing experience and for analytics and metrics about our visitors both on this website and other media. 
  To find out more about the cookies we use, see our Privacy Policy.
  If you decline, your information won’t be tracked when you visit this website. A single cookie will be used in your browser to remember your preference not to be tracked.

  * ☝️ How many of you have seen this kind of message before? Most likely, everyone has! What do you think this means? What is your understanding of cookies?

  * 🙋 Cookies are used to remember the website visitor. A cookie is a small text file. It is stored in your browser.

  * ☝️ Can you think of examples of when cookies would be useful?

  * 🙋 The most common example is a shopping cart. When we visit an online store and select some items to put them in your shopping cart, the cookie will remember those items.  When you are ready to checkout, the items are still in your shopping cart.

  * ☝️ It looks like cookies are very useful and even crucial to a good user experience when visiting websites. So why do websites ask for your permission to store cookies?

  * 🙋 Companies need to get your explicit consent to collect your data because most cookies identify you through your device. Cookies are pieces of information saved about you when you’re online, and they track you as you browse. So it can be a privacy issue.

  * ☝️ We also learned to use localStorage to store data. How are cookies different from localStorage?

  * 🙋 Cookies are mainly for reading server-side, but local storage can only be read by the client-side. Basically, cookies allow the server to deliver a page tailored to the user. Local storage allows a much larger amount of data to be stored on the user's computer and reduces the amount of traffic between the client and server. When trying to decide which one to use, think about who needs this data, is it the client or the server?

  * ☝️ How will we use cookies in our applications today?

  * 🙋 We will use cookies to remember our logged in status so we can navigate from page to page and have access to all the content.

* Answer any questions before proceeding to the next activity. 

### 2. Instructor Demo: Partials (5 min) 

* Remind students to start their MySQL Server.

* Go over how to create the `museum_db` database, run `npm install`, and modify the `.env.EXAMPLE` file to include their MySQL user/password information with the class.

* Demonstrate how to seed the database by running `npm run seed` in your command line.

* Navigate to `11-Ins_Partials` and run `npm start` from the command line. 

* Open <localhost:3001> in your browser and demonstrate the following:

  * Today all of our activities will use this museum application. 

  * We see four galleries named after the four seasons in different languages.

  * 🔑 When we click a gallery, we see the paintings (photos) that belong in that gallery.

  * 🔑 When we click on a painting, we see it in a larger format with the title and artist name.

* Open `11-Ins_Partials/views/homepage.handlebars` in your IDE and explain the following:

  * 🔑 Here is the homepage. Instead of rendering the four galleries here, we use a partial instead.

  ```handlebars
  {{#each galleries as |gallery|}}
  {{> gallery-details}}
  {{/each}}
  ```

* Open `11-Ins_Partials/views/partials/gallery-details.handlebars` in your IDE and explain the following:

  * 🔑 We create a new folder in the `views` directory called `partials` and put our partials there.

  * We see a card that links to the specific gallery when clicked on. 

  * The card consists of a header with the name of the gallery and the first painting of the gallery. 

  * 🙋 How are they getting all this data about the galleries?

* Open `11-Ins_Partials/controllers/home-routes.js` in your IDE and explain the following:

  * If we take a look at the routes, notice we are getting all of the galleries as well as the paintings in each gallery.

  ```js
  const dbGalleryData = await Gallery.findAll({
    include: [
      {
        model: Painting,
        attributes: ['filename', 'description'],
      },
    ],
  });
  ```

  * Then we map through the data and serialize it.

  ```js
  const galleries = dbGalleryData.map((gallery) =>
    gallery.get({ plain: true })
  );
  ```

  * When we render the `homepage` template, we pass in the `galleries` data for the templates to use.

  ```js
  res.render('homepage', {
    galleries,
  });
  ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 We will use partials to reuse a template that renders details about the painting.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `12-Stu_Partials/README.md`.

### 3. Student Do: Partials (15 min) 

* Direct students to the activity instructions found in `12-Stu_Partials/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 🏗️ Use Handlebars.js partials to reuse a template

Work with a partner to implement the following user story:

* As a developer, I want to be able to render details of a painting by reusing the same Handlebars.js template.

## Acceptance Criteria

* It's done when the details for the paintings that are associated with the gallery are rendered using a Handlebars.js partial in the [gallery.handlebars](./Unsolved/views/gallery.handlebars) file.

* It's done when the `painting-details.handlebars` partial renders a card that links to that painting's page.

* It's done when the card includes a header with the painting's title.

* It's done when the card includes a body with the painting and the artist's name.

## Assets

The following image demonstrates how the painting's details should be rendered onto the page:

![On a museum page, one card has an image of a sandy beach with the title and artist name underneath it](./Images/01-painting-details.jpg)

---

## 💡 Hints

* How do we set up the database?

* What command do we use to seed the database?

* What is the syntax for Handlebars.js partials?

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What are some other ways we can use Handlebars.js partials? How else can partials be useful?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Partials (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with `Handlebars.js partials`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `{{> painting-details}}`

  * ✔️ Link to painting's page

  * ✔️ Painting's title

  * ✔️ Painting's image and artist name

* Open `12-Stu_Partials/Solved/views/gallery.handlebars` in your IDE and explain the following: 

  * This is the gallery page that displays the paintings that belong to this gallery. There are 2-3 paintings for each gallery so we use the built-in helper function `{{#each}}` to iterate through each painting.

  ```handlebars
  {{#each gallery.paintings as |painting|}}

  {{/each}}
  ```

  * 🔑 The details for each painting will be rendered by using the partial `painting-details`. 

  ```handlebars
  {{> painting-details}}
  ```

* Open `12-Stu_Partials/Solved/views/partials/painting-details.handlebars` in your IDE and explain the following: 

  * We are given a card for each painting. We need to include a link to the painting's page, the title, the image, and the artist name.

  * 🔑 First, we will use the entire contents of the card as a link to the painting's page, so we encapsulate everything in a `<a>` tag. Notice we are using the `id` of the painting and we use the `{{ }}` handlebars syntax.

  ```handlebars
  <a href="/painting/{{id}}">

  </a>
  ```

  * 🔑 Next, we create the card header by using the `<header>` tag with the painting's `title`.

  ```handlebars
  <header>{{title}}</header>
  ```

  * 🔑 Lastly, in the body of the card, we render the actual image of the painting. Notice we use the painting's `filename` in the `<img src>` and the painting's `description` as the alt text.

  ```handlebars
  <img src="/images/{{filename}}" alt="{{description}}">
  ```

  * 🔑 Also in the card body, we include the artist's name.

  ```handlebars
  <p>By: {{artist}}</p>
  ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ If we want to specify what data gets sent over to the partials to be rendered, where can we do that?

  * 🙋 That will be handled in our controllers! As part of the MVC framework, the templates (View) only focus on the rendering of content. The routes (Controller) are responsible for getting the data from the database (Model) and handle all the logic behind which data is needed to be rendered.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Handlebars.js Docs on Partials](https://handlebarsjs.com/guide/partials.html#basic-partials), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Custom Helpers (5 min) 

* Navigate to `13-Ins_Custom-Helpers` and run `npm start` in your command line to demonstrate the following:

  * 🔑 When we navigate to <localhost:3001/> in our browser and click on one of the galleries, we see the Opening Hour and Closing Hour.

  * 🔑 But the Opening Hour is formatted as the original timestamp from the database, whereas the Closing Hour has been formatted to a clean `H:M:S` format.

* Open `13-Ins_Custom-Helpers/views/gallery.handlebars` in your IDE and explain the following:

  * We see how the Opening Hour uses the gallery's `starting_date` as is.

  ```handlebars
  <h4>Opening Hour: {{gallery.starting_date}}</h4>
  ```

  * 🔑 But we see how Closing Hour uses a custom helper function called `format_time` along with the gallery's `ending_date` to only display the time formatted in cleanly.

  ```handlebars
  <h4>Closing Hour: {{format_time gallery.ending_date}}</h4>
  ```

* Open `13-Ins_Custom-Helpers/utils/helpers.js` in your IDE and explain the following:

  * 🔑 To create our own custom helper functions, we create a folder called `utils` and a new file named `helpers.js`.

  * 🔑 For our `format_time` custom helper, we will take in a `date` and then use the `toLocaleTimeString()` method to format the time as `H:MM:SS AM/PM`.

  ```js
  module.exports = {
    format_time: (date) => {
      return date.toLocaleTimeString();
    },
  };
  ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 We will need to create a helper function and use JavaScript Date methods that allow us to get the month, date, and year of a timestamp.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `14-Stu_Custom-Helpers/README.md`.

### 6. Student Do: Custom Helpers (15 min) 

* Direct students to the activity instructions found in `14-Stu_Custom-Helpers/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 🐛 Date is not formatted correctly

Work with a partner to resolve the following issue(s):

* Museum visitors should be able to see the end date of each painting on the painting page.

## Expected Behavior

When a museum visitor visits the painting page, it should clearly and accurately show the date of when the exhibition will end:

* The end date is calculated by adding five years to the painting's `exhibition_date`.

* The end date should be formatted as `M/D/YYYY`.

## Actual Behavior

When a museum visitor visits the exhibition page, it shows the painting's `exhibition_date` in the original long timestamp format.

## Assets

The following image demonstrates the correct formatting of the end date for each painting:

![On a museum page, one card has an image of a blossoming apricot with the title, artist name, and end date underneath it](./Images/01-painting-end-date.jpg)

---

## 💡 Hints

* Which JavaScript Date methods allow you to return the month, date, and year of a specified date?

* How do you correctly render the month, since it is returned as a zero-based value?

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What other data can be formatted by custom helpers?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Custom Helpers (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with `custom helpers`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `.getMonth() + 1`

  * ✔️ `.getFullYear() + 5`

  * ✔️ `{{ format_date painting.exhibition_date }}`

* Open `14-Stu_Custom-Helpers/Solved/utils/helpers.js` in your IDE and explain the following: 

  * Under the `format_time` helper function, we create another custom helper named `format_date` that takes in a date.

  ```js
  format_date: (date) =>>  {

  }
  ```

  * 🔑 In order to format the date, we use template literals! First we need to get the month, but notice how `.getMonth()` will return the month as a zero-based value. For example, January will be `0`. In order to format it correctly, we need to add one to value returned.

  ```js
  return `${new Date(date).getMonth() +1}
  ```

  * Then we add the `/` slash and the date value.

  ```js
  /${new Date(date).getDate()}
  ```

  * 🔑 Lastly, we get the year but we need to add five years to calculate the end date.

  ```js
  /${new Date(date).getFullYear() + 5}`;
  ```

* Open `14-Stu_Custom-Helpers/Solved/views/painting.handlebars` in your IDE and explain the following: 

  * 🔑 On our painting template, we need to include the helper function `format_date` along with the `painting.exhibition_date` in order for the end date to be rendered correctly.

  ```handlebars
  <p>Exhibition open until: {{ format_date painting.exhibition_date}}</p>
  ```

* Navigate to <localhost:3001> in your browser and demonstrate the following:

  * When we click on a gallery and then a painting, we see that the exhibition end date is formatted correctly.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How are custom helper functions helpful when using Handlebars.js

  * 🙋 In order to keep the templates logic-free and only concerned with rendering data, we can separate this kind of logic and place them in helper functions instead.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Express Handlebars Docs on Helpers](https://www.npmjs.com/package/express-handlebars#helpers), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Sessions (5 min) 

* Navigate to `15-Ins_Sessions` in your command line and run `npm install express-session` to demonstrate the following:

  * Sessions allow our Express.js server to keep track of which user is making a request, and store useful data about them in memory.

  * 🔑 In order to incorporate sessions into our application, we need to install `express-session`.

  * The `express-session` library allows us to connect to the back end.

* Open `15-Ins_Sessions/server.js` in your IDE and demonstrate the following:

  * 🔑 We need to import `express-session` into our application.

  ```js
  const session = require('express-session');
  ```

  * 🔑 Then we set up an Express.js session with the following options: `secret`, `resave`, and `saveUninitialized`. `Secret` is required and can be either a string for a single secret or an array of multiple secrets. This is used to sign the session ID cookie. 

  * The `resave` option forces the session to be saved back to the session store. In most cases, we will want to use `false`.

  * The `saveUninitialized` option forces a session that is "uninitialized" to be saved to the store. A session is uninitialized when it is new but not modified. Choosing `false` is useful for implementing login sessions. 

  ```js
  const sess = {
    secret: 'Super secret secret',
    resave: false,
    saveUninitialized: false,
  };
  ```

* Open `15-Ins_Sessions/controllers/home-routes.js` in your IDE and explain the following:

  * We are going to set up a session variable to count how many times we visit the homepage, and **only** the homepage. We can visit the gallery and painting pages, but that will not get counted.

  * 🔑 In the `/` route, which is our homepage, we set up a session variable called `countVisit`. If that session variable already exists, we increment it by one. But if this is the first time visiting the homepage, meaning there isn't a session variable yet, then we create it and set it to one.

  ```js
  if (req.session.countVisit) {
    req.session.countVisit++;
  } else {
    req.session.countVisit = 1;
  }
  ```

  * Then we will render the `homepage` template and send over the `galleries` data and the `countVisit` session variable.

  ```js
  res.render('homepage', {
    galleries,
    countVisit: req.session.countVisit,
  });
  ```

  * We want to make sure the session is created before we send the response back, so we're wrapping the variables in a callback. The `req.session.save()` method will initiate the creation of the session and then run the callback function once complete. 

  ```js
  req.session.save(() => {
    if (req.session.countVisit) {
      req.session.countVisit++;
    } else {
      req.session.countVisit = 1;
    }

    res.render('homepage', {
      galleries,
      countVisit: req.session.countVisit,
    });
  });
  ```

* Open <localhost:3001> in your browser and demonstrate the following:

  * When we first visit the homepage, it says "Number of times you've visited this homepage: 1".

  * If we click on a gallery, it says "Number of times you've visited the homepage: 1" because we are not counting anything else but how many times we visit the main homepage.

  * If we go back to the homepage, now it will say "Number of times you've visited this homepage: 2".

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 Using sessions to check if a user is logged in or not, we will allow the user to access the gallery's paintings. Otherwise we will redirect the user to the login page.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `16-Stu_Sessions/README.me`.

### 9. Student Do: { ACTIVITY NAME } (15 min) 

* Direct students to the activity instructions found in `16-Stu_Sessions/README.me`.

* Break your students into pairs that will work together on this activity.

```md
# 🏗️ Add sessions to the login route

Work with a partner to implement the following user story:

* As a museum director, I want to allow visitors to view the gallery's paintings only after logging in.

* As a museum visitor, I want to be able to view multiple pages while maintaining my logged in status.

## Acceptance Criteria

* It's done when only after I am logged in, I am able to view the gallery's paintings. Otherwise I am directed to login.

* It's done when only after I am logged in, I am able to view the individual painting page. Otherwise I am directed to login.

* It's done when I can navigate from the gallery page to a painting's detail page without losing my logged in status.

## Assets

The following image demonstrates what the museum visitor sees if they try to access the gallery page without logging in:

![On a museum page, under the gallery name and operating hours, there is a message to login.](./Images/01-Unauthorized-Gallery.jpg)

---

## 💡 Hints

* You will need to create a user to test out the routes. Feel free to create your own user, or use these credentials to sign up: 

  * `username`: "Sam", `email`: "sam@email.com", `password`: "password1234"

* If the session variables are set up when the user is created or logged in, which file would hold that info?

* How can the templates know if the user is logged in or not?

* What built-in helper method will help us render specific content depending on whether the user is logged in or not?

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What is the lifecycle of a session?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Sessions (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with `sessions`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `req.session.loggedIn`

  * ✔️ `{{#if loggedIn}}`

  * ✔️ `{{else}}`

* Open `16-Stu_Sessions/Solved/controllers/api/user-routes.js` in your IDE and explain the following: 

  * We have been provided with `user-routes` to handle creating a new user, logging in, and logging out functionality.

  * 🔑 When a new user is created, we want them to be logged in right away. So we set up a session variable `loggedIn` and set it to `true` as soon a user is created.

  ```js
  req.session.save(() => {
    req.session.loggedIn = true;
    res.status(200).json(dbUserData);
  });
  ```

  * 🔑 For the `/login` route, after we find the user in our database using their email address and check their password against the hashed password, we set up the session.

  ```js
  req.session.save(() => {
    req.session.loggedIn = true;
    res
      .status(200)
      .json({ user: dbUserData, message: 'You are now logged in!' });
  });
  ```

  * This isn't something you had to code, but notice how we destroy the session once the user logs out.

  ```js
  router.post('/logout', (req, res) => {
    if (req.session.loggedIn) {
      req.session.destroy(() => {
        res.status(204).end();
      });
    } else {
      res.status(404).end();
    }
  });
  ```

* Open `16-Stu_Sessions/Solved/views/gallery.handlebars` in your IDE and explain the following: 

  * 🔑 We want to prevent unauthorized access to our paintings in the gallery page. So on the `gallery.handlebars` template, we use the built-in helper method `{{#if}}` to determine if the session variable `loggedIn` is set to `true`. Only then can they access the `painting-details`.

  ```handlebars
  {{#if loggedIn}}
    <section class="flex-row justify-center">
      {{#each gallery.paintings as |painting|}}
      {{> painting-details}}
      {{/each}}
    </section>
  </section>
  ```

  * 🔑 Else, if the session variable `loggedIn` does not exist or is set to `false`, then we provide a link for them to log in.

  ```handlebars
  {{else}}
  <a href="/login">You must login first to view the paintings</a>
  {{/if}}
  ```

* Open `16-Stu_Sessions/Solved/views/painting.handlebars` in your IDE and explain the following: 

  * We need to do the same thing to the `painting.handlebars` template to restrict access.

  * Here we wrap the entire contents of the template in the `{{#if}}` helper method.

  ```handlebars
  {{#if loggedIn}}
  <section class="painting">
    ...
  </section>
  {{else}}
  <a href="/login">You must login first to view this painting</a>
  {{/if}}
  ```

* Navigate to <localhost:3001> in your browser and demonstrate the following:

  * If we try to access the paintings without logging in, we are directed to log in first. 

  * Let's create a user using the provided credentials: `username`: "Sam", `email`: "sam@email.com", `password`: "password1234"

  * After we are logged in, we can access everything on the museum website.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Did you notice where else we used the `loggedIn` session variable to change the view?

  * 🙋 On the `main.handlebars` template, once the user logged in, the link to login was replaced by a button to logout in the navbar!

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [npm Docs on express-session](https://www.npmjs.com/package/express-session), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Cookies (5 min) 

* Run `npm start` from your command line and open <localhost:3001> in your browser to demonstrate the following:

  * 🔑 Let's log in using the credentials of the user we just created: `email`: "sam@email.com", `password`: "password1234".

  * 🔑 Now let's try closing the browser, opening a new tab or window, and navigating to <localhost:3001> without logging out first.

  * We are still logged in!! This is possible through sessions and cookies.

  * 🔑 Let's open the Application tab in Chrome DevTools to inspect the cookie. If we select the `Cookies` dropdown on the left-hand menu, we can see the `value` of the cookie.

  ![Cookie in Application DevTools tab](./Images/01-Cookies-Browser.jpg)

  * 🔑 If we open up MySQL Workbench, we can see a `Session` table in our `museum_db` and notice the `sid` matches the cookie in our browser.

  ![Cookie in MySQL Workbench](./Images/02-Cookies-MySQL-Workbench.jpg)

  * You can also see it printed in your terminal.

  ```sh
  Executing (default): SELECT `sid`, `expires`, `data`, `createdAt`, `updatedAt` FROM `Session` AS `Session` WHERE `Session`.`sid` = 'jmIObjIijpBKfOv4MkVPh_Ri5G_SI7_o';
  ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 We will need to set up sessions with cookies and the Sequelize store.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `18-Stu_Cookies/README.md`.

### 13. Student Do: Cookies (15 min)

* Direct students to the activity instructions found in `18-Stu_Cookies/README.md`.

* Break your students into pairs that will work together on this activity.

```md
# 📐 Add Comments to Implementation of the Sequelize Store and cookies

Work with a partner to add comments describing the functionality of the code found in [Unsolved/server.js](./Unsolved/server.js).

## 📝 Notes

Refer to the documentation: 

[Connect Session Store using Sequelize](https://www.npmjs.com/package/connect-session-sequelize)

---

## 🏆 Bonus

If you have completed this activity, work through the following challenge with your partner to further your knowledge:

* What is the difference between sessions and cookies?

Use [Google](https://www.google.com) or another search engine to research this.
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Cookies (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with `@TODO TOPIC`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ @TODO { THIS }

  * ✔️ @TODO { THAT }

  * ✔️ @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

  * 🔑 @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

  * 🙋 @TODO { YES, WE DO! }

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 @TODO We can refer to supplemental material, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: { ACTIVITY NAME } (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED

* Open `@TODO/folder/file` in your browser and demonstrate the following:

* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

  * 🔑 @TODO { WHEN WE DO THIS, IT DOES THAT. }

  * 🔑 @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How would we build this?

  * 🙋 @TODO { YES, HOW? } 

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `@TODO/folder/file`.

### 16. Student Do: { ACTIVITY NAME } (15 min) 

* Direct students to the activity instructions found in `@TODO/folder/file`.

* Break your students into pairs that will work together on this activity.

```md
@TODO ADD INSTRUCTIONS
```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: { ACTIVITY NAME } (15 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with `@TODO TOPIC`? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ @TODO { THIS }

  * ✔️ @TODO { THAT }

  * ✔️ @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

  * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

  * 🔑 @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

  * 🙋 @TODO { YES, WE DO! }

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 @TODO We can refer to supplemental material, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did today’s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
@TODO © YEAR Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.