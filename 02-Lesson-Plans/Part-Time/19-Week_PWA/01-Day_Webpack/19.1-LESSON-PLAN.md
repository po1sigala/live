# 19.1 Part-Time Lesson Plan: Webpage Performance and Webpack

## Overview

In this class, you will introduce the concept of bundling an application using webpack and its impact on webpage performance. You'll also demonstrate how to configure webpack to incorporate even more performance improvements, lazy loading, and development-process improvements.

## Instructor Notes

* In this lesson, students will complete activities `01-Ins_Lighthouse` through `10-Stu_Webpack-Plugin` in `19-PWA`.

* You will use webpack for the majority of today's activities. The activities only use the front end; there is no back end in any of the activities.

* If you haven't used webpack much previously, take a look at `webpack.config` and the `scripts` in the `package.json` files. This should prime you for the lecture.

* The first activity, `01-Ins_Lighthouse`, generates a Lighthouse report. Only performance is stressed, but it would be a good idea to mention accessibility, SEO, and best practices for further student investigation.

* The student activity `06-Stu_Webpack-Bundle` is a debugging activity that contains two errors. To fix the app, students must import the `path` module and add `name` in the output of the `webpack.config.js`.

* The `08-Stu_Webpack-Loader` activity uses ES modules to further demonstrate the use of Babel. All the other activities use CommonJS for modularization.

* The `08-Stu_Webpack-Loader` activity contains a mock API request. The interest rate is fake data; make a point to tell students that.

* If students ask why they are learning webpack, let them know that since the web is moving towards more advanced front-end applications, a compiler -- webpack -- is needed to process the code into a more performant format that can take advantage of modules, modern JavaScript, and bundles.

* Remind students to do a `git pull` of the class repo and to have today's activities ready and open in VS Code.

* If you are comfortable doing so, live code the solutions to the activities. If not, use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Recognize which metrics in a Lighthouse audit affect page load times.

* Identify the main purpose of a module bundler such as webpack.

* Set up webpack’s dependencies in an application with npm scripts.

* Create a bundle and use it to provide interaction for a webpage.

* Compare webpack in development vs. production mode.

* Extend webpack’s functionality for non-JavaScript files, transpiling modern JavaScript for older browsers, and automate bundle output file names.

* Create an `index.html` file using a template with a webpack plugin to automate bundle insertion.

## Slide Deck

* [Unit 19 Slide Deck](https://docs.google.com/presentation/d/1mkVX8q7pIQM6giW6ArxB2pjAYFCp2BpjIu1x7MDR6dE/edit?usp=sharing)

## Time Tracker

| Start  | #   | Activity Name                       | Duration |
|---     |---  |---                                  |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity      | 0:10     |
| 6:40PM | 2   | Instructor Demo: Lighthouse         | 0:05     |
| 6:45PM | 3   | Student Do: Lighthouse              | 0:15     |
| 7:00PM | 4   | Instructor Review: Lighthouse       | 0:10     |
| 7:10PM | 5   | Instructor Demo: Webpack Intro      | 0:05     |
| 7:15PM | 6   | Student Do: Webpack Intro           | 0:15     |
| 7:30PM | 7   | Instructor Review: Webpack Intro    | 0:10     |
| 7:40PM | 8   | Instructor Demo: Webpack Bundle     | 0:05     |
| 7:45PM | 9   | Student Do: Webpack Bundle          | 0:15     |
| 8:00PM | 10  | BREAK                               | 0:15     |
| 8:15PM | 11  | Instructor Review: Webpack Bundle   | 0:10     |
| 8:25PM | 12  | Instructor Demo: Webpack Loader     | 0:05     |
| 8:30PM | 13  | Student Do: Webpack Loader          | 0:15     |
| 8:45PM | 14  | Instructor Review: Webpack Loader   | 0:10     |
| 8:55PM | 15  | Instructor Demo: Webpack Plugin     | 0:05     |
| 9:00PM | 16  | Student Do: Webpack Plugin          | 0:15     |
| 9:15PM | 17  | Instructor Review: Webpack Plugin   | 0:15     |
| 9:30PM | 18  | END                                 | 0:00     |

> **Important**: If this lesson occurs on a Saturday, make sure to adjust the activities to accommodate for the extra hour of class time. Feel free to take your time as you go through the activities; for example, you can add 5 minutes to the `Student Do` and `Instructor Review` sections as you see fit. Remember to take a 40-minute break at noon!

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Open the [slide deck](https://docs.google.com/presentation/d/1mkVX8q7pIQM6giW6ArxB2pjAYFCp2BpjIu1x7MDR6dE/edit?usp=sharing) and follow these prompts on their corresponding slides:

  * **What is a PWA?**: PWA is a design pattern.

    * A Progressive Web App (PWA) is a design pattern that uses web technologies to build a fast, flexible web application that will perform like a native app on any device.

  * **Are PWAs dependent on a specific technology?**

  * **PWAs are focused on optimizations, not specific tech.**

    * PWAs do not rely on a single, specific technology. Instead, they use a variety of tools to build and optimize web applications to take advantage of features already available on the user’s device and browser.

  * **A PWA Is an Optimized Web App**

    * A PWA is simply a web app built using standard technologies that works in a browser and is optimized to improve performance and user experience.

  * **What makes an app a PWA?**

  * **PWA Design Pattern Optimizations**

    * PWA are optimized to be fast.

    * PWAs are optimized to work offline.

    * PWAs are installable by users directly on their devices.

    * PWAs are secure.

  * **PWAs Are Fast**

    * To give the user the look and feel of a native app, assets are bundled. This gives users a faster, more performant app.

  * **PWAs Work Offline**

    * A PWA also uses a service worker, which allows a user to access visited pages even if the app is offline.

  * **PWAs Are Installable**

    * A PWA uses a special set of instructions for the browser called a manifest.json, which adds a splash screen and makes the app installable directly on the user’s device.

  * **PWAs Are Secure**

    * A PWA works on a secure connection to help keep users and their data safe.

  * **What are the key benefits of PWAs?**

  * **Key Benefits of PWAs**

    * PWA is an adaptable design pattern with principles that can be applied to any web application.

    * PWAs focus on optimizing web applications to be faster and more performant.

    * PWAs enhance web applications by taking advantage of the user’s browser capability to provide a native app experience on any device.

    * PWAs are cost effective! With PWAs, there is no need to build a separate mobile and desktop application. A single app works for all devices.

    * PWAs can be directly installed by the user. There is no need for costly app stores!

    * PWAs deliver the speed and features that users expect in a modern app.

  * **Mini-Project**: The mini-project for this unit will be a contact directory app that uses service workers, IndexedDB, webpack, and has PWA functionality. We will also deploy the app to Heroku.

* Navigate to `28-Stu_Mini-Project/Main` in your command line and demonstrate the following:

  * We are going to build a contact directory that can work offline.

  * Run `npm install` from the command line to install the dependencies.

  * Run `npm start` from the command line to start the Express.js server.

  * Open the browser at http://localhost:3000/

  * Create two fake people to populate the contact cards.

  * In the DevTools/Network tab, set the Throttling option to Offline. Then refresh the page to see the contact cards persist on the webpage.

  * Install the PWA to display the app as a PWA.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What are we learning?

  * 🙋 We are learning about webpack, bundlers, workbox, service workers, IndexedDB, PWAs, and offline functionality.

  * ☝️ How does this project build on or extend previously learned material?

  * 🙋 We will be using CRUD operations to persist and delete data. We will set up an Express.js server to display the user interface.

  * ☝️ How does this project relate to your career goals?

  * 🙋 Not only do apps need to look impressive, they must also have low latency and load quickly. In the real world, connectivity can be unstable, so provisions must be made to preserve the app's functionality in order to retain users.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: Lighthouse (5 min)

* In your browser, open the [Make My Trip website](https://www.makemytrip.com/).

* Open the DevTools and click on the `>>` on the menu at the right. Select `Lighthouse` from the drop-down.

* Select the `Performance`, `Progressive Web App`, `Best Practices`, `Accessibility` and `SEO` categories. For device, leave the default `mobile.` Leave any other options unchecked and click on `Generate Report'.

  * To get started, we'll focus on the main driver for high bounce rates, which are slow page loads.

* Briefly show some of the categories Lighthouse will audit for you. Scroll down to the **Performance** section and note that the overall score is rated very bad.

* Select the slide button to display the longer descriptions of the performance metrics.

* Examine "First Contentful Paint," "Time to Interactive," "Total Blocking Time," and "Speed Index."

* Follow the link in the [Time to Interactive](https://developer.mozilla.org/en-US/docs/Glossary/Time_to_interactive) to show students how to obtain more information on the metric as well as information on any corrective actions they may wish to take to improve the metric.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How do we generate an audit report?

  * 🙋 Open the Lighthouse tab in DevTools, select the categories, then select the "Generate report" button.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `02-Stu_Lighthouse/README.md`.

### 3. Student Do: Lighthouse (15 min)

* Direct students to the activity instructions found in `02-Stu_Lighthouse/README.md`, which are also shown below.

* Break your students into pairs that will work together on this activity.

  ```md
  # 📐 Analyze the Lighthouse Audit

  Work with a partner to identify the key metrics that need improvement using a Lighthouse audit.

  ## 📝 Notes

  1. Review the [Lighthouse audit](./Unsolved/assets/audit.png).

  2. Identify which metrics must be modified to improve the loading time of the website.

  3. Add comments to [audit.md](./Unsolved/audit.md).

  Refer to the documentation:

  * [Google docs on Lighthouse audits](https://developers.google.com/web/tools/lighthouse)

  ---

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What other ways can you run a Lighthouse audit besides from the browser?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Lighthouse (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with Lighthouse? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use Office Hours to get extra help.

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ Largest Contentful Paint

  * ✔️ Time to Interactive

* Open the [Lighthouse audit report for weather.com](./assets/audit.png) and note that the score can vary from report to report because the measurements are calculated in milliseconds and often depend on external factors such as third-party APIs, server load capacity, and internet connectivity.

* Open the `02-Stu_Lighthouse/Solved/audit.md`. Examine and explain the following questions and answers.

  * Which metrics are failing and what do they measure?

    * 🔑 **Time to Interactive:** Measures how much time until the webpage is fully functional.

    * 🔑 **Total Blocking Time:** Sum of all time periods between First Contentful Paint(FCP) and Time to Interactive. FCP marks the time at which the first text or image is painted.

    * **Speed Index:** Shows how quickly the contents of the page are visibly populated.

    * **Cumulative Layout Shift:** Measures the movement of visible elements within the viewport.

    * 🔑 **Largest Contentful Paint:** Marks the time at which the largest text or image is painted.

* List a corrective measure for each metric selected above.

  * 🔑 Time to Interactive: Defer or remove unneeded JavaScript.

  * 🔑 Total Blocking Time: Optimize JavaScript to reduce the amount that is loaded, parsed, and executed.

  * Speed Index: Reduce load on the call stack or the main thread.

  * 🔑 Largest Contentful Paint: Reduce render blocking JavaScript.

  * Cumulative Layout Shift: Always include size attributes on your images and video elements.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Are these metrics weighted equally in the performance score?

  * 🙋 No, certain metrics like Largest Contentful Paint and Total Blocking Time are weighted more heavily and have a more significant impact on the performance score.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Google docs on Lighthouse performance scoring](https://developers.google.com/web/tools/lighthouse), and attend Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Webpack Intro (5 min)

* Open `03-Ins_Webpack-Intro/package.json` in your IDE and demonstrate the following:

  * The `devDependencies` webpack and `webpack-cli` enable webpack to compile the bundles.

  * 🔑 To create the devDependencies, use the command `npm install -D webpack webpack-cli`. When they are installed, they will appear in the `package.json` as the following shows:

  * 🔑 It is also important that we add the scripts to enable webpack to run in development mode and production mode, as the following shows:

    ```json
    "scripts": {
      "watch": "webpack --watch",
      "build": "webpack --mode production"
    },
    ```

  * The `watch` script enables automatic rebundling when changes in the JavaScript files are detected.

  * The `build` script launches webpack in production mode. This mode is meant to run the app on client machines so it minifies and optimizes the assets on the application as well as much more.

* Open `03-Ins_Webpack-Intro/webpack.config.js` and note the following:

  ```js
  const config = {
    // Entry point for initial bundle for page load
    entry: './assets/app.js',
    output: {
      path: `${__dirname}/dist`,
      filename: 'bundle.js',
    },
    // Production mode is the default
    mode: 'development',
  };
  ```

* Note that the `config` object defines the entry point as our main JavaScript file.

* The output point is in the `dist/` folder that will contain the JavaScript bundle.

* The mode is set to development, allowing auto bundling with the watch option.

* Navigate to `03-Ins_Webpack-Intro` directory and run the following command to create a bundle:

  ```bash
  npm run watch
  ```

* Open the `03-Ins_Webpack-Intro/index.html` file in your IDE to show the following script element at the bottom of the `<body>`:

  ```html
  <script type="text/javascript" src="dist/bundle.js"></script>
  ```

* Open `03-Ins_Webpack-Intro/index.html` in the browser and explain the markup is using the bundle to handle user interactivity for the webpage.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is the significance of the `--watch` flag?

  * 🙋 Enables a background process that watches for JavaScript changes and creates a new bundle to persist changes to the bundle.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `04-Stu_Webpack-Intro/README.md`.

### 6. Student Do: Webpack Intro (15 min)

* Direct students to the activity instructions found in `04-Stu_Webpack-Intro/README.md`, which are also shown below.

* Break your students into pairs that will work together on this activity.

  ```md
  # 📖 Add NPM Scripts to Implementation of Webpack

  Work with a partner to implement the following user story:

  * As a developer, I want to bundle the JavaScript file from the command line.

  * As a developer, I want to start webpack's watch mode from the command line.

  ## Acceptance Criteria

  * It is done when a production-ready bundle is created in the `dist/` folder from the command line using the command `npm run build`.

  * It is done when watch mode is initiated from the command line using the command `npm run watch`, as indicated in the screenshot below.

  ## 📝 Notes

  Refer to the documentation:

  * [Webpack docs on Watch mode](https://webpack.js.org/guides/development/#using-watch-mode)

  * [Webpack docs on NPM scripts](https://webpack.js.org/guides/getting-started/#npm-scripts)

  ## Assets

  The following image demonstrates that watch mode is currently on:

  ![The command line displays the watch webpack watch command.](./Assets/watch-terminal.png)

  ---

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can we implement watch mode in production?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Webpack Intro (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with webpack installation and creating bundles?

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use Office Hours to get extra help.

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ webpack.config.js

  * ✔️ webpack and webpack-cli packages

  * ✔️ npm scripts for production and development modes

* Open `04-Stu_Models/Solved/package.json` in your IDE and explain the following:

  * 🔑 The webpack and webpack-cli are installed as `devDependencies`.

    ```sh
    npm install -D webpack webpack-cli
    ```

  * 🔑 Add the npm scripts to run either the development mode or production mode of webpack from the terminal.

    ```sh
    "scripts": {
      "watch": "webpack --watch",
      "build": "webpack --mode production"
    },
    ```

  * The `--watch` flag enables auto bundling when JavaScript files are modified. This is useful in development mode, but not useful in production.

  * In the `build` script, selecting production mode for webpack minifies and optimizes the bundle in order to maximize performance, but is not useful when trying to debug in development mode.

  * Navigate to the `04-Stu_Webpack-Intro` directory in the terminal and run the following command to initiate the watch command.

    ```sh
    npm run watch
    ```

  * Verification that the watch mode is currently on can be found in the terminal.

  * Navigate to the `04-Stu_Webpack-Intro` directory in the terminal and run the following command to create a production-ready bundle.

    ```sh
    npm run build
    ```

  * Verification that the bundle has been minified for production mode can be seen in the terminal.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is the difference between production and development modes in webpack?

  * 🙋 Development mode allows for more legible code for debugging and auto bundling with the watch option. Production's priority is to optimize the bundle with minification along with a few more size saving measures.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋  We can refer to supplemental material, read the [webpack documentation on webpack modes](https://webpack.js.org/configuration/mode/#mode-production), and attend Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Webpack Bundle (5 min)

* Open `05-Ins_Webpack-Bundle/webpack.config.js` in your IDE and demonstrate the following:

  * 🔑 We are importing a core Node.js module, `path`, at the top of the file to enable the absolute path reference to be used for the current working directory.

    ```js
    const path = require('path');
    ```

  * 🔑 The `config` object has multiple entry points for a multi-page application and enables lazy loading.

    ```js
    entry: {
      main: './assets/app.js',
      weekly: './assets/weekly.js',
    },
    ```

  * We use multiple entry points to accommodate the `index.html` and `weekly-expense.html` files.

  * 🔑 A dynamic variable, `name`, is used to create multiple bundle names in the `output` property of the `config` object.

    ```js
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
    ```

    * The `name` variable will be replaced with the `main` and `weekly` keys assigned to the entry points.

  * Navigate to the `05-Ins_Webpack-Bundle` directory in the terminal and run the following command to install the webpack dependencies.

    ```bash
    npm install
    ```

  * Remain in the same directory and run the following command to create the bundles.

    ```bash
    npm run watch
    ```

  * Verify that multiple bundles with their respective names were created.

  * Open the `05-Ins_Webpack-Bundle/dist` directory to verify the bundles were created.

  * Open `index.html` in the IDE and identify the following:

    ```html
    <script type="text/javascript" src="dist/main.bundle.js"></script>
    ```

  * Open the `weekly-expense.html` in the IDE and identify the following:

    ```html
    <script type="text/javascript" src="dist/weekly.bundle.js"></script>
    ```

  * Point out that the bundle names in the `dist/` comply with the bundles we created.

  * Open the `index.html` in the browser and perform a basic transaction to demonstrate that this page is functioning properly.

  * Navigate to the `weekly-expense.html` to verify that this page also works.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Why would we want multiple bundles?

  * 🙋 This allows the browser to only load and execute the JavaScript necessary for each webpage, which greatly reduce the page loading time.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `06-Stu_Webpack-Bundle/README.md`.

### 9. Student Do: Webpack Bundle (15 min)

* Direct students to the activity instructions found in `06-Stu_Webpack-Bundle/README.md`, which are also shown below.

* Break your students into pairs that will work together on this activity.

  ```md
  # 🐛 The Bundle Command Fails

  Work with a partner to resolve the following issue:

  * As a developer, I should be able to create a bundle from the command line.

  ## Expected Behavior

  When a developer executes the build command from the command line, a bundle is created in the `dist/` folder.

  ## Actual Behavior

  When a developer executes the build command, an error message is displayed in the terminal.

  ## Steps to Reproduce the Problem

  To reproduce the problem, follow these steps:

  1. At the command line, execute the command `npm install` to download the web app's dependencies.

  2. At the command line, execute the command `npm run build` to create a bundle.

  3. Instead of a success message that states a bundle is created, an error message indicates the bundle process failed.

  ## Assets

  The following image confirms that a bundle was created by displaying a success message in the terminal:

  ![Command line successfully compiling our web application.](./Assets/chunks.png)

  ---

  ## 💡 Hints

  How are the bundles being generated?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What does chunking do for us?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Webpack Bundle (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with creating multiple webpack bundles? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use Office Hours to get extra help.

  * Navigate to `06-Stu_Webpack-Bundle/Unsolved` in the terminal and run the following command to create the bundles.

    ```sh
    npm run watch
    ```

  * Webpack will now successfully create two bundles, as noted in the terminal message.

  * Point out that a number of module dependencies are bound together to create the bundles.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Why is it important for `name` to be used to dynamically output bundle file names?

  * 🙋 Name is a reserve key word that tells webpack to use the property names in the `entry` property to create unique bundle file names.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [webpack docs on output file names](https://webpack.js.org/configuration/output/), and attend Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Webpack Loader (5 min)

* Open `07-Ins_Webpack-Loader/assets/js/app.js` in your IDE and demonstrate the following:

  * We are using async/await to retrieve the subtract calculation in the `submit` function.

    ```js
    async function submit(e) {
      e.preventDefault();
      const total = await subtract(Number(balanceEl.innerText), priceEl.value);
      balanceEl.innerText = total;
      addToList(expenseEl.value, priceEl.value);
    }
    ```

  * 🔑 In order to maintain functionality of this code on older browsers such as Internet Explorer or Chrome version 57, we must use Babel to transpile our code to an older version of JavaScript that these older browsers can understand.

  * Open `07-Ins_Webpack-Loader/webpack.config.js` in your IDE to reveal the following.

    ```js
    entry: {...
    output: {...
    mode: {...
    module: {
      // Loaders
    }
    ```
  * A new property named `module` has been created.

  * Within the `module` property, we will add the `rules` array, which will contain a collection of loaders.

  * Loaders will extend webpack's bundling ability beyond JavaScript to other static assets such as style sheets.

    ```js
    module: {
      rules: [
        {
          test: /\.css$/i,
          use: ['style-loader', 'css-loader'],
        },
    ```

  * Notice in the `test` property, a regex is used to find the style sheets in the application.

  * Navigate to `07-Ins_Webpack-Loader` in the terminal to install these two loaders as `devDependencies`.

    ```sh
    npm install -D css-loader style-loader
    ```

  * Open `07-Ins_Webpack-Loader/assets/js/app.js` and examine the following at the top of the file.

    ```js
    import '../css/style.css';
    ```

  * Note that there is no `<link>` element in the `index.html` to connect the `style.css` file.

  * The `css-loader` and `style-loader` now link the style sheet through the bundle import statement.

  * Navigate to `07-Ins_Webpack-Loader` in the terminal and run `npm i && npm run watch` to create the bundles.

  * Open `07-Ins_Webpack-Loader/index.html` in the browser to demonstrate that webpack is still styled through the webpack bundle.

  * We will add another loader to allow Babel to transpile modern JavaScript into an older version of JavaScript for older browsers.

    ```js
    rules: [
      {
        test: /\.css$/i,
        use: ['style-loader', 'css-loader'],
      },
      {
        test: /\.m?js$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env'],
            plugins: ['@babel/transform-runtime'],
          },
        },
      },
    ```

  * Note in the configuration above that the `node_modules` are excluded.

  * 🔑 The `babel-loader` uses a preset and a plugin option in order to transpile the modern JavaScript into an older-browser-friendly JavaScript version.

  * Install the following packages as `devDependencies` in the `07-Ins_Webpack-Loader` directory.

    * `@babel/plugin-transform-runtime`

    * `@babel/core`

    * `@babel/preset-env`

    * `@babel/runtime`

    * `babel-loader`

  * 🔑 These packages support `babel-loader` and the preset and plugin options to transpile at runtime.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How does webpack know which files need to be loaded for the style sheets?

  * 🙋 In the `test` property, a regex is used to find the file extensions `.css`.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `08-Stu_Webpack-Loader/README.md`.

### 13. Student Do: Webpack Loader (15 min)

* Direct students to the activity instructions found in `08-Stu_Webpack-Loader/README.md`, which are also shown below.

* Break your students into pairs that will work together on this activity.

  ```md
  # 🐛 "Get the Latest Interest" Button Does Not Work

  Work with a partner to resolve the following issues:

  * As a developer, I want to be able to use async/await with webpack.

  * As a user, I want to be able to get the latest interest rate when I click the appropriate button.

  ## Expected Behavior

  When I click the "Get the latest interest rate" button, an up-to-date interest rate should appear.

  ## Actual Behavior

  When a user clicks the "Get the latest interest rate" button, an error appears in the console.

  ## Steps to Reproduce the Problem

  To reproduce the problem, follow these steps:

  1. At the command line, execute the command `npm install` to download the web app's dependencies.

  2. At the command line, execute the command `npm run watch` to create a bundle.

  3. Note the illegal operation error.

  ## Assets

  The following image confirms that a bundle was created by displaying a success message in the terminal:

  ![Get the latest interest rate button in the web application.](./Assets/interest-button.png)

  ![The latest interest rate is displayed on the web application.](./Assets/interest.png)

  ---

  ## 💡 Hints

  Which plugins do we need for async/await to work in our browser?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What Babel plugin would allow object rest and spread operators to be used?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Webpack Loader (10 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with webpack loaders? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use Office Hours to get extra help.

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `path.resolve()`

  * ✔️ `dist`

* In the terminal, navigate to `08-Stu_Webpack-Loader/Unsolved` and run `npm i && npm run watch` to create the error. Examine the error to reveal the first bug.

  * The error message in the terminal indicates that the error is an illegal operation on a directory.  .

    ```sh
    [Error: EISDIR: illegal operation on a directory, mkdir '/'] {
      errno: -21,
      code: 'EISDIR',
      syscall: 'mkdir',
      path: '/'
    }
    ```

* 🔑 Navigate to the `08-Stu_Webpack-Loader/Solved/webpack.config.js` file and open in your IDE:

  * When we create a bundle, a directory is added to our code, the `dist` directory. We use `path.resolve()` to generate a `dist` folder that will hold our `index.html` and bundles. To run our app using the bundles, we will use the `index.html` inside the `dist` folder.

    ```js
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
    ```

  * Also notice that we need to properly configue Babel due to the async/await dependency:

    ```js
    {
      test: /\.m?js$/,
      exclude: /node_modules/,
      use: {
        loader: 'babel-loader',
        options: {
          presets: ['@babel/preset-env'],
          plugins: ['@babel/transform-runtime'], //insert the runtime
        },
      },
    },
    ```

* 🔑 Navigate to `08-Stu_Webpack-Loader/Solved/` in the terminal and run `npm install` and `npm run watch` to demonstrate that the error is now gone and the app is bundling as expected.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ Do we need Babel to transpile our code in our current versions of Chrome?

  * 🙋 No, we don't, but companies whose customers use legacy systems might.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [Babel docs on plugins](https://babeljs.io/docs/en/plugins), and attend Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: Webpack Plugin (5 min)

* Navigate to `09-Ins_Webpack-Plugin` and run the commands `npm i && npm run watch`.

* Open `09-Ins_Webpack-Plugin/index.html` in your browser and demonstrate the following:

  * Create an expense and submit it to see that this functionality is broken.

* Open `09-Ins_Webpack-Plugin/dist/index.html` in the browser and create another expense.

  * Now it works! But how?

* Open `09-Ins_Webpack-Plugin/webpack.config.js` and examine the following:

  * A new `plugin` property contains a new instance of the `HtmlWebpackPlugin` class configured to use the `index.html` file as a template.

  * It's also configured to use the title `Webpack Demo`.

    ```js
    mode: 'development',
    plugins: [
      new HtmlWebpackPlugin({
        template: './index.html',
        title: 'Webpack Demo'
      }),
    ],
    ```

  * 🔑 Note that the `HtmlWebpackPlugin` module is imported at the top of the `webpack.config.js` file.

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    ```

* 🔑 Open the `09-Ins_Webpack-Plugin/package.json` and show that in the `devDependency` is the `html-webpack-plugin` package.

* Open the `09-Ins_Webpack-Plugin/index.html` file in the IDE and show that there is no `<script>` element to import the bundle.

  * The `title` is inserted through the `htmlWebpackPlugin` object.

    ```html
    <title><%= htmlWebpackPlugin.options.title %></title>
    ```

* Open the `09-Ins_Webpack-Plugin/dist/index.html` and examine the following:

  * Webpack has output an `index.html` file in the `dist/` folder using the `./index.html` in the root directory with the title from the `webpack.config.js` file and the dynamically named bundle.

  ```html
  <title>Webpack Demo</title>
  <script defer src="main.bundle.js"></script>
  ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ When would the `HtmlWebpackPlugin` be highly useful?

  * 🙋 When there are many pages with lots of entry points and bundle names.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `10-Stu_Webpack-Plugin`.

### 16. Student Do: Webpack Plugin (15 min)

* Direct students to the activity instructions found in `10-Stu_Webpack-Plugin/README.md`, which are also shown below.

* Break your students into pairs that will work together on this activity.

  ```md
  # 🏗️ Generate an HTML file to Serve Webpack Bundles

  Work with a partner to implement the following user story:

  * As a developer, I want to generate HTML files that contain references to the webpack bundles.

  ## Acceptance Criteria

  * It is done when I have successfully installed the `HtmlWebpackPlugin` to generate an HTML file.

  * It is done when the generated HTML file follows the template, `index.html`.

  * It is done when the generated HTML file has a generated page title.

  * It is done when I can generate an HTML file that contains the references to the webpack bundle.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![The output of the loan calculator with a 300k loan.](./Assets/loan-calculator.png)

  ---

  ## 💡 Hints

  How do we ensure that the format of the HTML file that's generated follows our template, `index.html`?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * Why must we use the `new` syntax with webpack plugins?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: Webpack Plugin (15 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with webpack plugins? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use Office Hours to get extra help.

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `HtmlWebpackPlugin`

  * ✔️ `htmlWebpackPlugin.options.title`

  * ✔️ `template: ./index.html`

* Open `10-Stu_Webpack-Plugin/Solved/package.json` in your IDE and explain the following:

  * 🔑 In order to use the plugin, we must install the package `html-webpack-plugin` as a `devDependency`.

* Open `10-Stu_Webpack-Plugin/Solved/webpack.config.js` in your IDE and explain the following:

  * We must import the package into the `webpack.config.js` file.

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    ```

  * 🔑 We must add the `plugin` property to the `config` object.

    ```js
    plugins: [
    ],
    ```

  * 🔑 Add the `HtmlWebpackPlugin`.

    ```js
    plugins: [
      new HtmlWebpackPlugin({
    }),
    ],
    ```

  * 🔑 Configure the `HtmlWebpackPlugin` with the template and the title.

    ```js
    plugins: [
      new HtmlWebpackPlugin({
        template: './index.html',
        title: 'Loan Calculator'
      }),
    ],
    ```

* Open `10-Stu_Webpack-Plugin/Solved/index.html` in your IDE and add the title using the plugin to the HTML template.

  ```html
  <title><%= htmlWebpackPlugin.options.title %></title>
  ```

* Navigate to `10-Stu_Webpack-Plugin/Solved` and run the command `npm run watch` to create a new bundle.

* Open `10-Stu_Webpack-Plugin/Solved/dist/index.html` in the IDE to see that the `index.html` file was created with the title and bundle.

* Open `10-Stu_Webpack-Plugin/Solved/dist/index.html` in the browser and check that the app functions properly.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How does webpack know where to insert the title in the `index.html` template?

  * 🙋 The `<%= %>` syntax with the reference to the `htmlWebpackPlugin.options.title` inserts the value into the correct location in the `index.html` template.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [webpack docs on HtmlWebpackPlugin](https://webpack.js.org/plugins/html-webpack-plugin/), and attend Office Hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did today’s lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
© 2021 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
