# 19.1 Part-Time Lesson Plan: Webpage Performance and Webpack

## Overview

In this class, you will introduce the concept of bundling an application with webpack, its impact on webpage performance, and then demonstrate how to configure webpack to incorporate more performance improvements, lazy loading, and how webpack can improve the development processes.

## Instructor Notes

* In this lesson, students will complete activities `01-Ins_Lighthouse` through `10-Stu_Webpack-Plugin` in `19-PWA`.

* You will use webpack for a majority of today's activities. Most of the activities only use the front end - there is no backend in any of the activities.

* If you haven't used webpack much in the past, take a look at the `webpack.config` and the `scripts` in the `package.json` files. This should prime you for the lecture.

* The first activity, `01-Ins_Lighthouse` generates a Lighthouse report. Only performance is stressed however accessibility, SEO, and best practices should be noted for further student investigation.

* Activity `08-Stu_Webpack-Loader` uses ES modules to further demonstrate the use of Babel. All the other activities use CommonJS for modularization.

* The student activity `06-Stu_Webpack-Bundle` is a debugging activity contains two errors. Import the `path` module and add `name` in the output of the `webpack.config.js` to fix the app.

* The `08-Stu_Webpack-Loader` contains a mock API request. The interest rate is fake data and should be noted as such.

* If students question why they are learning webpack, let them know that since the web is moving towards more advanced front end applications, a compiler is needed to process the code into a more performant format that can take advantage of modules, modern JavaScript, and bundles.

* Remind students to do a `git pull` of the class repo to have today's activities ready and open in VS Code.

* If you are comfortable doing so, live-code the solutions to the activities. If not, just use the solutions provided and follow the prompts and talking points for review.

* Let students know that the Bonus at the end of each activity is not meant to be extra coding practice, but instead is a self-study on topics beyond the scope of this unit for those who want to further their knowledge.

## Learning Objectives

By the end of class, students will be able to:

* Recognize which metrics in a Lighthouse audit affect page load times.

* Identify the main purpose of a module bundler like webpack.

* Set up webpack‚Äôs dependencies in an application with npm scripts.

* Create a bundle and use it to provide interaction for a webpage.

* Compare webpack in development vs production mode.

* Extend webpack‚Äôs functionality for non-JavaScript files, transpiling modern JavaScript for older browsers, and automate bundle output file names.

* Create an `index.html` file using a template with a webpack plugin to automate bundle insertion.

## Slide Deck

* [Unit 19 Slide Deck](https://docs.google.com/presentation/d/1mkVX8q7pIQM6giW6ArxB2pjAYFCp2BpjIu1x7MDR6dE/edit?usp=sharing)

## Time Tracker

| Start  | #   | Activity Name                       | Duration |
|---     |---  |---                                  |---       |
| 6:30PM | 1   | Instructor Do: Stoke Curiosity      | 0:10     |
| 6:40PM | 2   | Instructor Demo: Lighthouse         | 0:05     |
| 6:45PM | 3   | Student Do: Lighthouse              | 0:15     |
| 7:00PM | 4   | Instructor Review: Lighthouse       | 0:10     |
| 7:10PM | 5   | Instructor Demo: Webpack Intro      | 0:05     |
| 7:15PM | 3   | Student Do: Webpack Intro           | 0:15     |
| 7:30PM | 4   | Instructor Review: Webpack Intro    | 0:10     |
| 7:40PM | 8   | Instructor Demo: Webpack Bundle     | 0:05     |
| 7:45PM | 9   | Student Do: Webpack Bundle          | 0:15     |
| 8:00PM | 10  | BREAK                               | 0:15     |
| 8:15PM | 11  | Instructor Review: Webpack Bundle   | 0:10     |
| 8:25PM | 12  | Instructor Demo: Webpack Loader     | 0:05     |
| 8:30PM | 13  | Student Do: Webpack Loader          | 0:15     |
| 8:45PM | 14  | Instructor Review: Webpack Loader   | 0:10     |
| 8:55PM | 15  | Instructor Demo: Webpack Plugin     | 0:05     |
| 9:00PM | 16  | Student Do: Webpack Plugin          | 0:15     |
| 9:15PM | 17  | Instructor Review: Webpack Plugin   | 0:15     |
| 9:30PM | 18  | END                                 | 0:00     |

> **Important**: If this lesson occurs on a Saturday, make sure to adjust the activities to accommodate for the extra hour of class time. Feel free to take your time as you go through the activities; for example, you can add 5 minutes to the `Student Do` and `Instructor Review` sections as you see fit. Remember to take a 40-minute break at noon!

---

## Class Instruction

### 1. Instructor Do: Stoke Curiosity (10 min)

* Welcome students to class.

* Open the [slide deck](https://docs.google.com/presentation/d/1mkVX8q7pIQM6giW6ArxB2pjAYFCp2BpjIu1x7MDR6dE/edit?usp=sharing) and follow these prompts on their corresponding slides:

  * **What is a PWA?**: PWA is a design pattern

    * Progressive Web App (PWA) is shorthand for a design patter that uses only web technologies to build a fast, flexible web application that performs like a native app on any device.

  * **Are PWAs dependent on a specific technology?**: No, PWAs are focused on optimizations, not specific tech

    * PWAs are not reliant on a single, specific technology. Instead, PWAs use a variety of tools to build and optimize web applications to take advantage of the features already available on the user‚Äôs device and browser.

    * A PWA is really just a web app built with standard technologies that works in a browser and is optimized to improve performance and user experience.

  * **What makes an app a PWA?**: PWA design pattern optimizations.

    * PWA are optimized to be fast! To give the user the look and feel of a native app, assets are bundled. This gives users a faster, more performant app.

    * PWAs are optimized to work offline. A PWA also uses a service worker which allows a user to access visited pages even if the app is offline.

    * PWAs are installable by users directly on their devices. A PWA uses a special set of instructions for the browser called a `manifest.json` that adds a splash screen and makes the app installable directly on the user‚Äôs device.

    * PWAs are secure. A PWA works on a secure connection to help keep users and their data safe.

  * **What are the key benefits of PWAs?**

    * PWA is an adaptable design pattern with principles that can be applied to any web application.

    * PWAs focus on optimizing web applications to be faster and more performant.

    * PWAs enhance web applications by taking advantage of user‚Äôs browser capability to provide a native app experience on any device.

    * PWAs are cost effective! With PWAs there is no need to build a separate mobile and desktop application. A single app works for all devices.

    * PWAs can be directly installed by user. No need for costly app stores!

    * PWAs deliver the speed and features users expect in a modern app.

  * **Mini-Project**: The mini-project for this unit will be a contact directory app that uses service workers, IndexedDB, webpack, and has PWA functionality. We will also deploy the app to Heroku.

* Navigate to `28-Stu_Mini-Project/Main` in your command line and demonstrate the following:

  * We are going to build a contact directory that can work offline.

  * Run `npm install` from the command line to install the dependencies.

  * Run `npm start` from the command line to start the Express.js server.

  * Open the browser at http://localhost:3000/

  * Create a two fake people to populate the contact cards.

  * In DevTools/Network tab set the Throttling option to Offline. Then refresh the page to see the contact cards persist on the webpage.

  * Install the PWA to display the app as a PWA.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What are we learning?

  * üôã We are learning Webpack, bundlers, Workbox, service workers, IndexedDB, PWAs, offline functionality to name a few.

  * ‚òùÔ∏è How does this project build off or extend previously learned material?

  * üôã We will be using CRUD operations to persist and delete data. We will set up an Express.js server to display the user interface.

  * ‚òùÔ∏è How does this project relate to your career goals?

  * üôã Not only do apps need to look impressive, they must also have low latency and load quickly. In the real world connectivity can be unstable, so provisions must be made to preserve the app's functionality to retain users.

* Answer any questions before proceeding to the next activity.

### 2. Instructor Demo: Lighthouse (5 min)

* Open [the Wikipedia page related to information technology](https://en.wikipedia.org/wiki/Information_technology) in your browser.

* Open the DevTools/Lighthouse tab.

* Generate a report with all the categories checked, and explain the following:

  * To get started, we'll focus on the main driver for high bounce rates - slow page loads.

* Briefly show some of the categories Lighthouse will audit for you. Scroll down to the **Performance** section and note the overall score is rated very bad.

* Select the slide button to display the longer descriptions of the performance metrics.

* Examine First Contentful Paint, Time to Interactive, Total Blocking Time, and Speed Index.

* Follow the link in the [Time To Interactive](https://developer.mozilla.org/en-US/docs/Glossary/Time_to_interactive) metric to obtain more details on the metric and the corrective measures to improve this metric.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How do we generate an audit report?

  * üôã Open the Lighthouse tab in DevTools, select the categories, then select the "Generate report" button.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `02-Stu_Lighthouse/README.md`.

### 3. Student Do: Lighthouse (15 min)

* Direct students to the activity instructions found in `02-Stu_Lighthouse/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìê Analyze the Lighthouse Audit

  Work with a partner to identify which key metrics need improvement using a Lighthouse audit.

  ## üìù Notes

  1. Navigate to [weather.com](https://weather.com/).

  2. Generate a Lighthouse report on performance.

  3. Select the proper categories that would return an audit based on performance.

  4. Find which metrics must be modified to improve the loading time of the website.

  5. Add comments to the markdown file in the [audit.md] for the metrics that are most problematic for performance. Also describe the process of how to improve the metrics.(./Unsolved/audit.md)

  Refer to the documentation:

  * [Google Docs on Lighthouse Audits](https://developers.google.com/web/tools/lighthouse)

  ---

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What other ways can you run a Lighthouse audit besides from the browser?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 4. Instructor Review: Lighthouse (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with Lighthouse? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è Largest Contentful Paint

  * ‚úîÔ∏è Time to Interactive

* Open the [Lighthouse audit report for weather.com](./Images/weather-report.png) and note that the score can vary from report to report since the measurements are calculated in milliseconds and are often dependent on external factors such as third party APIs, server load capacity, and internet connectivity.

* Open the `02-Stu_Lighthouse/Solved/audit.md`. Examine and explain the following questions and answers.

  * Which metrics are failing and what do they measure?

    * üîë **Time to interactive:** measures how much time until the webpage is fully functional.

    * üîë **Total Blocking Time:** Sum of all time periods between **First Contentful Paint**(FCP) and Time to Interactive. FCP marks the time which the first text or image is painted.

    * **Speed Index:** Speed index shows how quickly the contents of the page are visibly populated.

    * **Cumulative Layout Shift:** Measures the movement of visible elements within the viewport

    * üîë **Largest Contentful Paint:** Marks the time at which the largest text or image is painted.

* List a corrective measure for each metric selected above.

  * üîë Time to interactive: Defer or remove unneeded JavaScript.

  * üîë Total Blocking Time: Optimize JavaScript to reduce the amount it is loaded, parsed, and executed.

  * Speed Index: Reduce load on the call stack or the main thread.

  * üîë Largest Contentful Paint: Reduce render blocking JavaScript.

  * Cumulative Layout Shift: Always include size attributes on your images and video elements.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Are these metrics weighted equally in the performance score?

  * üôã No, certain metrics like Largest Contentful Paint and Total Blocking Time are weighted more heavily and have a more significant impact on the performance score

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [docs on Lighthouse performance scoring from Google](https://developers.google.com/web/tools/lighthouse), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 5. Instructor Demo: Webpack Intro (5 min)

* Open `03-Ins_Webpack-Intro/package.json` in your IDE and demonstrate the following:

  * The devDependencies webpack and webpack-cli enable webpack to compile the bundles.

  * üîë To create the devDependencies use the command `npm install -D webpack webpack-cli`

  * üîë Add the scripts to enable webpack to run in development mode and production mode.

    ```json
    "scripts": {
      "watch": "webpack --watch",
      "build": "webpack --mode production"
    },
    ```

  * The `watch` script enables automatic rebundling when changes in the JavaScript files are detected.

  * The `build` script launches webpack in production mode. This mode is meant to run the app on client machines so it take each measures to minify and optimize the assets on the application as well as much more.

* Open `03-Ins_Webpack-Intro/webpack.config.js` and note the following:

  ```js
  const config = {
    // Entry point for initial bundle for page load
    entry: './assets/app.js',
    output: {
      path: `${__dirname}/dist`,
      filename: 'bundle.js',
    },
    // Production mode is the default
    mode: 'development',
  };
  ```

* Note that the `config` object defines the entry point as our main JavaScript file.

* The output point is in the `dist/` folder that will contain the JavaScript bundle.

* The mode is set to development, allowing auto bundling with the watch option.

* Navigate to `03-Ins_Webpack-Intro` directory and run the following command to create a bundle:

  ```bash
  npm run watch
  ```

* Open the `03-Ins_Webpack-Intro/index.html` file in your IDE to show the following script element at the bottom of the `<body>`:

  ```html
  <script type="text/javascript" src="dist/bundle.js"></script>
  ```

  * Open `04-Stu_Webpack-Intro/index.html` in the browser to show the markup is using the bundle to handle user interactivity for the webpage.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What is the significance of the `--watch` flag?

  * üôã Enables a background process that watches for JavaScript changes and creates a new bundle to persist changes to the bundle.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `04-Stu_Webpack-Intro/README.md`.

### 6. Student Do: Webpack Intro (15 min)

* Direct students to the activity instructions found in `04-Stu_Webpack-Intro/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üìñ Add NPM Scripts to Implementation of Webpack

  Work with a partner to implement the following user story:

  * As a developer, I want to bundle the JavaScript file from the command line.

  * As a developer, I want to start webpack's Watch Mode from the command line.

  ## Acceptance Criteria

  * It's done when a production ready bundle is created in the `dist/` folder from the command line using the command `npm run build`.

  * It's done when watch mode is initiated from the command line using the command, `npm run watch`, as indicated in the following screenshot.

  ## üìù Notes

  Refer to the documentation:

  * [Webpack Docs on Watch mode](https://webpack.js.org/guides/development/#using-watch-mode)

  * [Webpack Doc on NPM scripts](https://webpack.js.org/guides/getting-started/#npm-scripts)

  ## Assets

  The following image demonstrates Watch mode is currently on:

  ![The command line displays the watch webpack watch command.](./Assets/watch-terminal.png)

  ---

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * How can we implement Watch mode in production?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 7. Instructor Review: Webpack Intro (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with webpack installation and creating bundles?

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è webpack.config.js

  * ‚úîÔ∏è webpack and webpack-cli packages

  * ‚úîÔ∏è npm scripts for production and development modes

* Open `04-Stu_Models/Solved/package.json` in your IDE and explain the following:

  * üîë The webpack and webpack-cli are installed as `devDependencies`.

    ```sh
    npm install -D webpack wepack-cli
    ```

  * üîë Add the npm scripts to run either the development mode or production mode of webpack from the terminal.

    ```sh
    "scripts": {
      "watch": "webpack --watch",
      "build": "webpack --mode production"
    },
    ```

  * The `--watch` flag enables auto bundling when JavaScript files are modified. Handy in development mode, but not useful in production.

  * In the `build` script, selecting production mode for webpack minifies and optimizes the bundle to maximize performance, but is not useful when trying to debug in development mode.

  * Navigate to the `04-Stu_Webpack-Intro` directory in the terminal and run the following command to initiate the watch command:

    ```sh
    npm run watch
    ```

  * Verification that the watch mode is currently on can be found in the terminal.

  * Navigate to the `04-Stu_Webpack-Intro` directory in the terminal and run the following command to create a production ready bundle:

    ```sh
    npm run build
    ```

  * Verification that the bundle has been minified for production mode can be seen in the terminal.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è What is the difference between production and development modes in webpack?

  * üôã Development mode allows for more legible code for debugging and auto bundling with the watch option. Production's priority is to optimize the bundle with minification along with a few more size saving measures.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã  We can refer to supplemental material, read the [webpack documentation on webpack modes](https://webpack.js.org/configuration/mode/#mode-production), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 8. Instructor Demo: Webpack Bundle (5 min)

* Open `05-Ins_Webpack-Bundle/webpack.config.js` in your IDE and demonstrate the following:

  * üîë We are importing a core Node.js module, `path`, at the top of the file to enable the absolute path reference to be used for the current working directory:

    ```js
    const path = require('path');
    ```

  * üîë The `config` object has multiple entry points for a multi-page application enables lazy loading.

    ```js
    entry: {
      main: './assets/app.js',
      weekly: './assets/weekly.js',
    },
    ```

  * We use multiple entry points to accommodate the `index.html` and `weekly-expense.html` files.

  * üîë A dynamic variable, `name`, is used to create multiple bundle names in the `output` property of the `config` object.

    ```js
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
    ```

    * The `name` variable will be replaced with the `main` and `weekly` keys assigned to the entry points.

  * Navigate to the `05-Ins_Webpack-Bundle` directory in the terminal and run the following command to install the webpack dependencies:

    ```bash
    npm install
    ```

  * Remain in the same directory to run the following command to create the bundles:

    ```bash
    npm run watch
    ```

  * Verify that multiple bundles with their respective names were created.

  * Open the `04-Ins_Webpack-Bundle/dist` directory to verify the bundles were created.

  * Open the `index.html` in the IDE and identify the following:

    ```html
    <script type="text/javascript" src="dist/main.bundle.js"></script>
    ```

  * Open the `weekly-expense.html` in the IDE and identify the following:

    ```html
    <script type="text/javascript" src="dist/weekly.bundle.js"></script>
    ```

  * Point out that the bundle names in the `dist/` comply with the bundles we created.

  * Open the `index.html` in the browser and perform a basic transaction to demonstrate that this page is functioning properly.

  * Navigate to the `weekly-expense.html` to verify this page also works.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Why would we want multiple bundles?

  * üôã This allows the browser to only load and execute the JavaScript necessary for each webpage, which greatly reduce the page loading time.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `06-Stu_Webpack-Bundle/README.md`.

### 9. Student Do: Webpack Bundle (15 min)

* Direct students to the activity instructions found in `06-Stu_Webpack-Bundle/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üêõ The Bundle Command Fails

  Work with a partner to resolve the following issue(s):

  * As a developer, I should be able to create multiple bundles from the command line.

  ## Expected Behavior

  When a developer executes the webpack command from the command line, multiple bundles are created in the `dist/` folder.

  ## Actual Behavior

  When a developer executes the build command, an error message is displayed in the terminal.

  ## Steps to Reproduce the Problem

  1. Execute the command `npm install`, to download the web app's dependencies.

  2. Execute the command, `npm run build`, from the command line to create the bundles.

  3. Instead of a success message that states the bundles are created, an error message indicates the bundle process failed.

  ## Assets

  The following image confirms that a bundle was created by displaying a success message in the terminal:

  ![Command line successfully compiling our web application.](./Assets/chunks.png)

  ---

  ## üí° Hints

  How are the bundles being generated?

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What does lazy loading do for us?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 10. BREAK (15 min)

### 11. Instructor Review: Webpack Bundle (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with creating multiple webpack bundles? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `[name]`

  * ‚úîÔ∏è `path.resolve()`

* Navigate to `06-Stu_Webpack/Unsolved` and run `npm i && npm run watch` to create the error in the terminal. Examine the error to reveal the first bug.

  * The error message in the terminal indicates the error is in the `webpack.config.js` file as shown below:

    ```sh
    Failed to load `06-Stu_Webpack-Bundle/Unsolved/webpack.config.js`

    ReferenceError: path is not defined
    ```

  * üîë Import the `path` module at the top of the `06-Stu_Unsolved/webpack.config.js` file.

    ```js
    const path = require('path');
    ```

  * üîë Make sure to save the changes then navigate to `06-Stu_Webpack-Bundle/Unsolved` in the terminal and execute the following command to create the second error:

    ```sh
    npm run watch
    ```

  * The next error indicated in the terminal alerts that multiple bundles are being output to the same file name:

    ```sh
    [webpack-cli] Error Conflict: Multiple chunks emit assets to the same filename [entry].bundle.js (chunks main and cost)
    ```

  * üîë Open the `06-Stu_Webpack-Bundle/Unsolved/webpack.config.js` file and notice the error is in the `output` property. The output file name `entry` must be `name` in order to create multiple file names.

    ```js
    output: {
      filename: '[name].bundle.js',
      path: path.resolve(__dirname, 'dist'),
    },
    ```

  * Navigate to `06-Stu_Webpack-Bundle/Unsolved` in the terminal and run the following command to create the bundles:

    ```sh
    npm run watch
    ```

  * Webpack will now successfully create two bundles as noted in the terminal message.

  * Point out that a number of modules dependencies are bound together to create the bundles.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Why is it important for `name` to be used to dynamically output bundle file names?

  * üôã Name is a reserve key word that tells webpack to use the property names in the `entry` property to create unique bundle file names.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [webpack documentation on output file names](https://webpack.js.org/configuration/output/), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 12. Instructor Demo: Webpack Loader (5 min)

* Open `07-Ins_Webpack-Loader/assets/js/app.js` in your IDE and demonstrate the following:

  * We are using async/await to retrieve the subtract calculation in the `submit` function.

    ```js
    async function submit(e) {
      e.preventDefault();
      const total = await subtract(Number(balanceEl.innerText), priceEl.value);
      balanceEl.innerText = total;
      addToList(expenseEl.value, priceEl.value);
    }
    ```

  * üîë In order to maintain functionality of this code on older browsers such as Internet Explorer or Chrome version 57, we must use Babel to transpile our code to an older version of JavaScript that these older browsers can understand.

  * Open `07-Ins_Webpack-Loader/webpack.config.js` in your IDE to reveal the following:

    ```js
    entry: {...
    output: {...
    mode: {...
    module: {
      // Loaders
    }
    ```
  * A new property named `module` has been created.

  * Within the `module` property, we will add the `rules` array which will contain a collection of loaders.

  * Loaders will extend webpack's bundling ability beyond JavaScript to other static assets such as style sheets.

    ```js
    module: {
      rules: [
        {
          test: /\.css$/i,
          use: ['style-loader', 'css-loader'],
        },
    ```

  * Notice in the `test` property, a regex is used to find the style sheets in the application.

  * Navigate to `07-Ins_Webpack-Loader` in the terminal to install these two loaders as `devDependencies`.

    ```sh
    npm install -D css-loader style-loader
    ```

  * Open `07-Ins_Webpack-Loader/assets/js/app.js` and examine the following at the top of the file:

    ```js
    import '../css/style.css';
    ```

  * Note that there is no `<link>` element in the `index.html` to connect the `style.css` file.

  * The `css-loader` and `style-loader` now link the style sheet through the bundle import statement.

  * Navigate to `07-Ins_Webpack-Loader` in the terminal and `npm i && npm run watch` to create the bundles.

  * Open `07-Ins_Webpack-Loader/index.html` in the browser to demonstrate the webpack is still styled through the webpack bundle.

  * We will add another loader to allow Babel to transpile modern JavaScript into older an version of JavaScript for older browsers.

    ```js
    rules: [
      {
        test: /\.css$/i,
        use: ['style-loader', 'css-loader'],
      },
      {
        test: /\.m?js$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env'],
            plugins: ['@babel/transform-runtime'],
          },
        },
      },
    ```

  * Note in the configuration above, the `node_modules` are excluded.

  * üîë The `babel-loader` uses a preset and a plugin option in order to transpile the modern JavaScript into an older browser friendly JavaScript version.

  * Install the following packages as `devDependencies` in the `07-Ins_Webpack-Loader` directory.

    * `@babel/plugin-transform-runtime`

    * `@babel/core`

    * `@babel/preset-env`

    * `@babel/runtime`

    * `babel-loader`

  * üîë These packages support `babel-loader` and the preset and plugin options to transpile at runtime.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How does webpack know which files need to be loaded for the style sheets?

  * üôã In the `test` property, a regex is used to find the file extensions `.css`.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `08-Stu_Webpack-Loader/README.md`.

### 13. Student Do: Webpack Loader (15 min)

* Direct students to the activity instructions found in `08-Stu_Webpack-Loader/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üêõ Get the Latest Interest Button Does Not Work

  Work with a partner to resolve the following issue(s):

  * As a developer, I want to be able to use Async / Await with webpack.

  * As a user, I want to be able to get the latest interest rate when I click the appropriate button.

  ## Expected Behavior

  When I click the `Get the latest interest rate` button, an up to date interest rate should appear.

  ## Actual Behavior

  When a user clicks the `Get the latest interest rate` button, the interest rate doesn't appear.

  ## Steps to Reproduce the Problem

  1. Execute the command `npm install`, to download the web app's dependencies.

  2. Execute the command, `npm run watch`, from the command line to create a bundle.

  3. Open up the `index.html` file with live server.

  4. Click on the `Get the latest interest rate` button and check the console in Chrome DevTools.

  ## Assets

  The following image confirms that a bundle was created by displaying a success message in the terminal:

  ![Get the latest interest rate button on the web application.](./Assets/interest-button.png)

  ![The latest interest rate being displayed on the web application.](./Assets/interest.png)

  ---

  ## üí° Hints

  Which plugins do we need for Async / Await to work in our browser?

  To see the error in the console, open the console window in DevTools and select the Settings button (‚öôÔ∏è). Then select the Preserve log checkbox so the error persists in the console.

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * What Babel plugin would allow object rest and spread operators to be used?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 14. Instructor Review: Webpack Loader (10 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with webpack loaders? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `babel-loader`

  * ‚úîÔ∏è `plugin`

  * ‚úîÔ∏è `@babel/transform-runtime`

* Navigate to `08-Stu_Webpack-Loader/Unsolved` in your terminal and run the commands `npm i && npm run watch` to install the dependencies and create the bundle.

* Open `08-Stu_Webpack-Loader/index.html` in the browser and open the console window in DevTools.

* Select the Settings button in the console and select the checkbox for "Preserve log".

* Click on the `Get the latest interest rate` button and observe the following error message.

  ```sh
  Uncaught ReferenceError: regeneratorRuntime is not defined
  ```

* Open the `08-Stu_Webpack-Loader/assets/js/app.js` file in the IDE in search of the "Get latest interest rate" button click handler function which contains the runtime error and examine the following:

  ```js
  async function getRate() {
    // Call to Mock API
    const currentRate = await getData(6.11);
    console.log(currentRate);
    return currentRate;
  }
  ```

* Open the `08-Stu_Webpack-Loader/webpack.config.js` file in the IDE to see if Babel was properly configured due to the async/await dependency and examine the following.

  ```js
  {
    test: /\.m?js$/,
    exclude: /node_modules/,
    use: {
      loader: 'babel-loader',
      options: {
        presets: ['@babel/preset-env'],
        plugins: ['@babel/transform-runtime'], //insert the runtime
      },
    },
  },
  ```

  * üîë The plugin was missing from the `options` property, causing a bug to surface at runtime.

  * Navigate to `08-Stu_Webpack-Loader` in the terminal to run the command, `npm run watch` to create a new bundle.

  * Open `08-Stu_Webpack-Loader/index.html` in the browser and click on the "Get latest interest rate" button to reveal the function is how operational.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è Do we need Babel to transpile our code in our current versions of Chrome?

  * üôã No, we don't, but companies whose customers use with legacy systems may.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [Babel documentation regarding plugins](https://babeljs.io/docs/en/plugins), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 15. Instructor Demo: Webpack Plugin (5 min)

* Navigate to `09-Ins_Webpack-Plugin` and run the commands `npm i && npm run watch`.

* Open `09-Ins_Webpack-Plugin/index.html` in your browser and demonstrate the following:

  * Create an expense and submit it to see that this functionality is broken.

* Open `09-Ins_Webpack-Plugin/dist/index.html` in the browser and create another expense.

* Now it works! But how?

* Open `09-Ins_Webpack-Plugin/webpack.config.js` and examine the following:

    ```js
    mode: 'development',
    plugins: [
      new HtmlWebpackPlugin({
        template: './index.html',
        title: 'Webpack Demo'
      }),
    ],
    ```

  * A new `plugin` property contains a new instance of the `HtmlWebpackPlugin` class configured to use the `index.html` file as a template.

  * It's also configured to use the title `Webpack Demo`.

  * üîë Note the `HtmlWebpackPlugin` module is imported at the top of the `webpack.config.js` file.

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    ```

* üîë Open the `09-Ins_Webpack-Plugin/package.json` and show that in the `devDependency` is the `html-webpack-plugin` package.

* Open the `09-Ins_Webpack-Plugin/index.html` file in the IDE and show that there is no `<script>` element to import the bundle and exam the following:

  ```html
  <title><%= htmlWebpackPlugin.options.title %></title>
  ```

  * The `title` is inserted through the `htmlWebpackPlugin` object.

* Open the `09-Ins_Webpack-Plugin/dist/index.html` and examine the following:

  ```html
  <title>Webpack Demo</title>
  <script defer src="main.bundle.js"></script>
  ```

  * Webpack has output an `index.html` file in the `dist/` folder using the `./index.html` in the root directory with the title from the `webpack.config.js` file and the dynamically named bundle.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è When would the `HtmlWebpackPlugin` be highly useful?

  * üôã When there are many pages with lots of entry points and bundle names.

* Answer any questions before proceeding to the next activity.

* In preparation for the activity, ask TAs to start directing students to the activity instructions found in `10-Stu_Webpack-Plugin`.

### 16. Student Do: Webpack Plugin (15 min)

* Direct students to the activity instructions found in `10-Stu_Webpack-Plugin`.

* Break your students into pairs that will work together on this activity.

  ```md
  # üèóÔ∏è Generate an HTML file that References a Webpack Bundle

  Work with a partner to implement the following user story:

  * As a developer, I want to generate an HTML file that contain a reference to a dynamically named webpack bundle.

  ## Acceptance Criteria

  * It's done when I have successfully installed the `HtmlWebpackPlugin` to generate an HTML file.

  * It's done when the generated HTML file follows the template, `index.html`.

  * It's done when the generated HTML file has a generated page title, Loan Calculator.

  * It's done when I can generate an HTML file that contains a reference to the webpack bundle.

  ## Assets

  The following image demonstrates the web application's appearance and functionality:

  ![The output of the loan calculator with 300k loan.](./Assets/loan-calculator.png)

  ---

  ## üí° Hints

  How do we ensure the format of the HTML file that's generated follows with our template, `index.html`?

  ## üèÜ Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * Why do we have to use the `new` syntax with webpack plugins?

  Use [Google](https://www.google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 17. Instructor Review: Webpack Plugin (15 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How comfortable do you feel with webpack plugins? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (üîë) below to review the following key points:

  * ‚úîÔ∏è `HtmlWebpackPlugin`

  * ‚úîÔ∏è `htmlWebpackPlugin.options.title`

  * ‚úîÔ∏è `template: ./index.html`

* Open `10-Stu_Webpack-Plugin/Solved/package.json` in your IDE and explain the following:

  * üîë In order to use the plugin, we must install the package, `html-webpack-plugin` as a `devDependency`.

* Open `10-Stu_Webpack-Plugin/Solved/webpack.config.js` in your IDE and explain the following:

  * We must import the package into the `webpack.config.js` file as follows:

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin');
    ```

  * üîë We must add the `plugin` property to the `config` object as follows:

    ```js
    plugins: [
    ],
    ```

  * üîë Add the `HtmlWebpackPlugin` as follows:

    ```js
    plugins: [
      new HtmlWebpackPlugin({
    }),
    ],
    ```

  * üîë Configure the `HtmlWebpackPlugin` with the template and the title as follows:

    ```js
    plugins: [
      new HtmlWebpackPlugin({
        template: './index.html',
        title: 'Loan Calculator'
      }),
    ],
    ```

* Open `10-Stu_Webpack-Plugin/Solved/index.html` in your IDE and add the title using the plugin as follows to the html template:

  ```html
  <title><%= htmlWebpackPlugin.options.title %></title>
  ```

* Navigate to `10-Stu_Webpack-Plugin` and run the command `npm run watch` to create a new bundle.

* Open `10-Stu_Webpack-Plugin/dist/index.html` in the IDE to see that the `index.html` file was been created with the title and bundle.

* Open `10-Stu_Webpack-Plugin/dist/index.html` in the browser and check that the app functions properly.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

  * ‚òùÔ∏è How does webpack know where to insert the title in the `index.html` template?

  * üôã The `<%= %>` syntax with the reference to the `htmlWebpackPlugin.options.title` inserts the value into the correct location in the `index.html` template.

  * ‚òùÔ∏è What can we do if we don't completely understand this?

  * üôã We can refer to supplemental material, read the [webpack documentation on HtmlWebpackPlugin](https://webpack.js.org/plugins/html-webpack-plugin/), and stick around for office hours to ask for help.

* Answer any questions before ending the class.

### 18. END (0 min)

How did today‚Äôs lesson go? Your feedback is important. Please take 5 minutes to complete this [anonymous survey](https://forms.gle/RfcVyXiMmZQut6aJ6).

---
¬© 2021 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
